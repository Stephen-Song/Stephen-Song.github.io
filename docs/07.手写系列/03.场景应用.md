---
title: åœºæ™¯åº”ç”¨
date: 2021-11-28 10:22:49
permalink: /pages/54fba0/
---
# åœºæ™¯åº”ç”¨

## å®ç°`add(1)(2)(3)`

```javascript
// ä¸å®šå‚æ•°ä¸ªæ•°
function add(...args) {
  //æ±‚å’Œ
  return args.reduce((a, b) => a + b);
}
function curry(fn) {
  let args = [];
  return function temp(...newArgs) {
    if (newArgs.length) {
      args = [...args, ...newArgs];
      return temp;
    } else {
      let val = fn.apply(this, args);
      args = []; //ä¿è¯å†æ¬¡è°ƒç”¨æ—¶æ¸…ç©º
      return val;
    }
  };
}
let addCurry = curry(add);
console.log(addCurry(1)(2)(3)(4, 5)()); //15
console.log(addCurry(1)(2)(3, 4, 5)()); //15
console.log(addCurry(1)(2, 3, 4, 5)()); //15
// è¿™ä¸ªå¿…é¡»è¦åŠ ä¸€ä¸ªè°ƒç”¨çš„()
// å®šå‚æ•°ä¸ªæ•°
function add(x, y, z) {
  //æ±‚å’Œ
  return x + y + z;
}
function curry(fn, args) {
  var length = fn.length;
  var args = args || [];
  return function () {
    newArgs = args.concat(Array.prototype.slice.call(arguments));
    if (newArgs.length < length) {
      return curry.call(this, fn, newArgs);
    } else {
      return fn.apply(this, newArgs);
    }
  };
}

// es6å†™æ³•
function curry(fn, ...args) {
  // ç»§ç»­æ¥å—å‚æ•°ç„¶åæŸ¯é‡ŒåŒ–
  return args.length < fn.length
    ? (...params) => {
        return curry(fn, ...args, ...params);
      }
    : fn(...args);
}

let addCurry = curry(add);
console.log(addCurry(1, 2, 3)); //15
console.log(addCurry(1)(2, 3)); //15
console.log(addCurry(1)(2)(3)); //15
// toStringå†™æ³•
function add(...args) {
	function fn(...fn_args) {
		return add.apply(null, [...args, ...fn_args])
	}
	fn.toString = function() {
		return args.reduce((total, num) => total + num)
	}
	return fn
}
console.log(add(1)) //1
console.log(add(1)(2,3)) //6
console.log(add(1)(2,3)(4,5,6)) //21



// é¢˜ç›®
var foo = function(...args) { 
    // è¦æ±‚å®ç°å‡½æ•°ä½“
}

var f1 = foo(1,2,3); f1.getValue(); 
// 6 è¾“å‡ºæ˜¯å‚æ•°çš„å’Œ

var f2 = foo(1)(2,3); f2.getValue(); 
// 6

var f3 = foo(1)(2)(3)(4); f3.getValue(); 
// 10

function foo(...args) {
  const target = (...arg1s) => foo(...[...args, ...arg1s])
  target.getValue = () => args.reduce((p, n) => p+ n, 0)
  return target
}
```

## å®ç°ä¸€ä¸ªäº‹ä»¶å§”æ‰˜<badge text="æ˜“é”™" vertical-align="top" />

```js
ul.addEventListener('click', function (e) {
            console.log(e,e.target)
            if (e.target.tagName.toLowerCase() === 'li') {
                console.log('æ‰“å°')  // æ¨¡æ‹Ÿfn
            }
})
```

**ã€Œæœ‰ä¸ªå°bugï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»çš„æ˜¯ li é‡Œé¢çš„ spanï¼Œå°±æ²¡æ³•è§¦å‘ fnï¼Œè¿™æ˜¾ç„¶ä¸å¯¹ã€**ğŸ‘‡

```
<ul id="xxx">ä¸‹é¢çš„å†…å®¹æ˜¯å­å…ƒç´ 1
        <li>liå†…å®¹>>> <span> è¿™æ˜¯spanå†…å®¹123</span></li>
        ä¸‹é¢çš„å†…å®¹æ˜¯å­å…ƒç´ 2
        <li>liå†…å®¹>>> <span> è¿™æ˜¯spanå†…å®¹123</span></li>
        ä¸‹é¢çš„å†…å®¹æ˜¯å­å…ƒç´ 3
        <li>liå†…å®¹>>> <span> è¿™æ˜¯spanå†…å®¹123</span></li>
</ul>
å¤åˆ¶ä»£ç 
```

è¿™æ ·å­çš„åœºæ™¯å°±æ˜¯ä¸å¯¹çš„ï¼Œé‚£æˆ‘ä»¬çœ‹çœ‹é«˜çº§ç‰ˆæœ¬ğŸ‘‡

```js
function delegate(element, eventType, selector, fn) {
  element.addEventListener(
    eventType,
    (e) => {
      let el = e.target;
      while (!el.matches(selector)) {
        if (element === el) {
          el = null;
          break;
        }
        el = el.parentNode;
      }
      el && fn.call(el, e, el);
    },
    true
  );
  return element;
}
```

## å®ç°åè¿›åˆ¶è½¬ä¸º`36`è¿›åˆ¶

```js
function getNums36() {
  var nums36 = [];
  for(var i = 0; i < 36 ; i++) {
    if(i >= 0 && i <= 9) {
      nums36.push(i)
    } else {
      nums36.push(String.fromCharCode(i + 55));
    }
  }
  return nums36;
}
function scale36(n) {
  // å•ç‹¬çš„åŠŸèƒ½å‡½æ•°
  // 16è¿›åˆ¶æ•°ï¼š 0-9  A-F    36è¿›åˆ¶æ•°ï¼š 0-9  A-Z 
  const arr = [];
  var nums36 = getNums36();
  // 36 10
  if(!Number.isInteger(n)){//æµ®ç‚¹æ•°åˆ¤æ–­ï¼Œç›®å‰ä¸æ”¯æŒå°é¼ 
    console.warn('ä¸æ”¯æŒå°æ•°è½¬æ¢');
    return n;
  } 
  var neg = '';
  if(n < 0){//å¯¹è´Ÿæ•°çš„å¤„ç†
      neg = '-';
      n = Math.abs(n)
  }
  while(n) {
    var res = n % 36;
    console.log(res,'+++++++');
    arr.unshift(nums36[res]);
    // è¿›ä½
    n = parseInt(n/36);
    console.log(n,'---------');
  }
  arr.unshift(neg)
  return arr.join("");

}

console.log(scale36(20)); // 10
```

## å®ç°åè¿›åˆ¶è½¬ä¸ƒè¿›åˆ¶

```js

function getNums7() {
  var nums7 = [];
  for(var i = 0; i < 7 ; i++) {
      nums7.push(i)
  }
  return nums7;
}
var convertToBase7 = function(num) {
  // å•ç‹¬çš„åŠŸèƒ½å‡½æ•°
  const arr = [];
  var nums7 = getNums7();
  var neg = '';
  if(num < 0){//å¯¹è´Ÿæ•°çš„å¤„ç†
      neg = '-';
      num = Math.abs(num)
  }
  if(num == 0) {
      return  num + "";
  }
  
  while(num) {
    var res = num % 7;  // å¯¹é«˜ä½æ•°æ®è¿›è¡Œæˆªå–
    arr.unshift(nums7[res]);  
    // è¿›ä½
    num = parseInt(num/7); 
  }
  arr.unshift(neg);
  return arr.join("");
}
```

## è§£æ`URLparams`ä¸ºå¯¹è±¡

```javascript
function getParams(u) {
  const s = new URLSearchParams(u.search)
  const obj = {}
  s.forEach((v, k) => (obj[k] = v))
  return obj
}

const url = 'http://sample.com/?a=1&b=2&c=xx&d=2#hash';
getParams(new URL(url))
// {a: "1", b: "2", c: "xx", d: "2"}
const dismantle = (url) => {
     const aimUrl = url.split('?').pop().split('#').shift().split('&');
     const res = {};
     aimUrl.forEach(item => {
          const [key, val] = item.split('=');
          res[key] = val;
     });
     return res;
}
dismantle('http://sample.com/?a=1&b=2&c=xx&d=2#hash')
// {a: "1", b: "2", c: "xx", d: "2"}
```

## æ–æ³¢é‚£å¥‘æ•°åˆ—

```js
// é€’å½’ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(2^n)
function fibSequence(n) {
    if (n === 1 || n === 2) return n - 1;
    return fib(n - 1) + fib(n - 2)	
}

// æˆ–è€…ä½¿ç”¨è¿­ä»£ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œæ¨èï¼
function fibSequence(n) {
  let a = 0, b = 1, c = a + b
  for (let i = 3; i < n; i++) {
    a = b
    b = c
    c = a + b
  }
  return c
}

// ä½¿ç”¨es6ä¼˜åŒ–è¿­ä»£å½¢å¼
function fibonacci(n) {
  let cur = 0;
  let next = 1;
  for (let i = 0; i < n; i++) {
    [cur, next] = [next, cur + next]
  }
  return cur;
}
```

**å°¾é€’å½’è°ƒç”¨**

å¦‚ä¸‹å›¾ï¼šç”±äºå°¾è°ƒç”¨ï¼Œç†è®ºä¸Šå¯ä»¥ä¸è®°ä½ä½ç½®`2`ï¼Œè€Œä»å‡½æ•°`g`ç›´æ¥å¸¦ç€è¿”å›å€¼è¿”å›åˆ°ä½ç½®`1`ï¼ˆå³å‡½æ•°`f`çš„è¿”å›ä½ç½®ï¼‰

![img](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202203011546180.png)

ç”±äºå°¾è°ƒç”¨ä¹‹å‰çš„å·¥ä½œå·²ç»å®Œæˆäº†ï¼Œæ‰€ä»¥å½“å‰å‡½æ•°å¸§ï¼ˆå³è°ƒç”¨æ—¶åˆ›å»ºçš„æ ˆå¸§ï¼‰ä¸ŠåŒ…å«å±€éƒ¨å˜é‡ç­‰ç­‰å¤§éƒ¨åˆ†çš„ä¸œè¥¿éƒ½ä¸éœ€è¦äº†ï¼Œå½“å‰çš„å‡½æ•°å¸§ç»è¿‡é€‚å½“çš„å˜åŠ¨ä»¥åå¯ä»¥ç›´æ¥å½“åšå°¾è°ƒç”¨çš„å‡½æ•°çš„å¸§ä½¿ç”¨ï¼Œç„¶åç¨‹åºå°±å¯ä»¥è·³åˆ°è¢«å°¾è°ƒç”¨çš„å‡½æ•°ã€‚

ç”¨ä¸Šå›¾ä¸­çš„ä¾‹å­æ¥è§£é‡Šå°±æ˜¯ï¼Œå‡½æ•°`f`å°¾è°ƒç”¨å‡½æ•°`g `ä¹‹å‰çš„å·¥ä½œå·²ç»å®Œæˆäº†ï¼Œæ‰€ä»¥è°ƒç”¨å‡½æ•°`f`æ—¶åˆ›å»ºçš„å‡½æ•°å¸§ç›´æ¥ç»™å‡½æ•°`g`ç”¨äº†ï¼Œå°±ä¸éœ€è¦é‡æ–°ç»™å‡½æ•°`g`åˆ›å»ºæ ˆå¸§ã€‚

è¿™ç§å‡½æ•°å¸§å˜åŠ¨é‡å¤ä½¿ç”¨çš„è¿‡ç¨‹å°±å«åš**å°¾è°ƒç”¨æ¶ˆé™¤**æˆ–**å°¾è°ƒç”¨ä¼˜åŒ–**

```js
function fibSequence(n, pre = 0, cur = 1) {
	if(n === 0) return n
  if(n === 1) return cur
  
  return fibSequence(n - 1, cur, pre + cur)
}

fibSequence(10)
```



## æ‰‘å…‹ç‰Œç®—æ³•<badge text="å­—èŠ‚" />

é­”æœ¯å¸ˆæ‰‹ä¸­æœ‰ä¸€å †æ‰‘å…‹ç‰Œï¼Œè§‚ä¼—ä¸çŸ¥é“å®ƒçš„é¡ºåºï¼Œæ¥ä¸‹æ¥é­”æœ¯å¸ˆï¼š

- ä»ç‰Œé¡¶æ‹¿å‡ºä¸€å¼ ç‰Œï¼Œ æ”¾åˆ°æ¡Œå­ä¸Š
- å†ä»ç‰Œé¡¶æ‹¿ä¸€å¼ ç‰Œï¼Œ æ”¾åœ¨æ‰‹ä¸Šç‰Œçš„åº•éƒ¨

å¦‚æ­¤å¾€å¤ï¼ˆä¸æ–­é‡å¤ä»¥ä¸Šä¸¤æ­¥ï¼‰ï¼Œç›´åˆ°é­”æœ¯å¸ˆæ‰‹ä¸Šçš„ç‰Œå…¨éƒ¨éƒ½æ”¾åˆ°äº†æ¡Œå­ä¸Šã€‚

æ­¤æ—¶ï¼Œæ¡Œå­ä¸Šçš„ç‰Œé¡ºåºä¸ºï¼š (ç‰Œé¡¶) `1,2,3,4,5,6,7,8,9,10,11,12,13` (ç‰Œåº•)ã€‚

é—®ï¼šåŸæ¥é­”æœ¯å¸ˆæ‰‹ä¸Šç‰Œçš„é¡ºåºï¼Œç”¨å‡½æ•°å®ç°ã€‚

```js
const calc = (arr) => {
    const origin = [];
    for (let i = 0; i < arr.length; i++) {
        if (origin.length) {
            const item = origin.pop();
            origin.unshift(item);
        }
        origin.unshift(result[i])
    }
    return origin;
}
// æˆ–è€…ï¼ˆæˆ‘è‡ªå·±å†™çš„ï¼‰
function sort(nums) {
  const res = [];
  while (nums.length) {
    if (res.length) res.unshift(res.pop());
    let card = nums.shift();
    res.unshift(card);
  }
  return res;
}

// æµ‹è¯•
const result = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13]
// åŸæœ‰é¡ºåº
calc(result)
// [13, 2, 12, 6, 11, 3, 10, 5, 9, 1, 8, 4, 7]
```



## çº¦ç‘Ÿå¤«ç¯é—®é¢˜

[çº¦ç‘Ÿå¤«ç¯](https://leetcode-cn.com/problems/yuan-quan-zhong-zui-hou-sheng-xia-de-shu-zi-lcof/)

```javascript
var lastRemaining = function(n, m) {
    let result = 0;
    for(let i = 2; i <= n; i++) {
        result = (m + result) % i;
    }
    return result
};
```

![img](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/1636036693(1).png)

## å®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼

```javascript
// once å‚æ•°è¡¨ç¤ºæ˜¯å¦åªæ˜¯è§¦å‘ä¸€æ¬¡
const wrapCallback = (fn, once=false) => ({ callback: fn, once })
class EventEmitter {
    constructor() {
        this.events = new Map()
    }
    on(type, fn, once=false) { // ç›‘å¬è®¢é˜…
        let handler = this.events.get(type)
        if (!handler) {
            this.events.set(type, wrapCallback(fn, once)) // ç»‘å®šå›è°ƒ
        } else if (handler && typeof handler.callback === 'function') {
            this.events.set(type, [handler, wrapCallback(fn, once)]) // è¶…è¿‡ä¸€ä¸ªè½¬ä¸ºæ•°ç»„
        } else {
            handler.push(wrapCallback(fn, once))
        }
    }
    off(type, fn) { // åˆ é™¤æŸä¸ªäº‹ä»¶çš„å›è°ƒï¼Œå‡å¦‚å›è°ƒ <= 1ï¼Œåˆ™ç­‰åŒ allOff æ–¹æ³•
        let handler = this.events.get(type)
        if (!handler) return;
        // åªæœ‰ä¸€ä¸ªå›è°ƒäº‹ä»¶ç›´æ¥åˆ é™¤è¯¥è®¢é˜…
        if (!Array.isArray(handler) && 
        handler.callback === fn.callback) this.events.delete(type)
        for (let i=0; i<handler.length; i++) {
            let item = handler[i]
            if (item.callback === fn.callback) {
                handler.splice(i, 1)
                i-- // æ•°ç»„å¡Œé™·ï¼Œi å¾€å‰ä¸€ä½
                if (handler.length === 1) this.events.set(type, handler[0])
            }
        }
    }
    // onceï¼šè¯¥è®¢é˜…äº‹ä»¶ type åªè§¦å‘ä¸€æ¬¡ï¼Œä¹‹åè‡ªåŠ¨ç§»é™¤
    once(type, fn) {
        this.on(type, fn, true)
    }
    emit(type, ...args) {
        let handler = this.events.get(type)
        if (!handler) return;
        if (Array.isArray(handler)) {
            handler.map(item => {
                item.callback.apply(this, args) // args å‚æ•°å°‘ï¼Œå¯ä»¥æ¢æˆ call
                if (item.once) this.off(type, item) // å¤„ç† once çš„æƒ…å†µï¼Œoff ç§»é™¤
            })
        } else {
            handler.callback.apply(this, args) // å¤„ç†éæ•°ç»„
        }
    }
    allOff(type) {
        let handler = this.events.get(type)
        if (!handler) return;
        this.events.delete(type)
    }
}

let e = new EventEmitter()
e.on('eventA', () => {
  console.log('eventA äº‹ä»¶è§¦å‘')
})
e.on('eventA', () => {
  console.log('âœ¨ eventA äº‹ä»¶åˆè§¦å‘äº† âœ¨')
})

function f() { 
  console.log('eventA äº‹ä»¶æˆ‘åªè§¦å‘ä¸€æ¬¡');
}
e.once('type', f)
e.emit('type')
e.emit('type')
e.allOff('type')
e.emit('type')

// eventA äº‹ä»¶è§¦å‘
// âœ¨ eventA äº‹ä»¶åˆè§¦å‘äº† âœ¨
// eventA äº‹ä»¶æˆ‘åªè§¦å‘ä¸€æ¬¡
// eventA äº‹ä»¶è§¦å‘
// âœ¨ eventA äº‹ä»¶åˆè§¦å‘äº† âœ¨
```

- **å‘å¸ƒ/è®¢é˜…æ¨¡å¼**ç”±ç»Ÿä¸€è°ƒåº¦ä¸­å¿ƒè°ƒç”¨ï¼Œå› æ­¤å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸éœ€è¦çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨

## å®ç°è§‚å¯Ÿè€…æ¨¡å¼

```javascript
class Subject {
  constructor(name = "xiaoSong") {
    this.state = name;
    this.observer = [];
  }
  attach(o) {
    this.observer.push(o);
  }
  setState(newVal) {
    this.state = newVal;
    this.observer.forEach((o) => o.update(this));
  }
}

class Observer {
  constructor(sex = "male") {
    this.sex = sex;
  }
  update(student) {
    console.log(`${this.sex}, ${student.state}`);
  }
}

const student = new Subject();

const parent = new Observer();
const teacher = new Observer("female");

student.attach(parent);
student.attach(teacher);

student.setState("xiaoming");
```

![](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201092155678.png)

## å®ç°ä¸€ä¸ªå¼‚æ­¥åŠ æ³•<badge text="å­—èŠ‚" />

```js
// å­—èŠ‚é¢è¯•é¢˜ï¼Œå®ç°ä¸€ä¸ªå¼‚æ­¥åŠ æ³•
function asyncAdd(a, b, callback) {
  setTimeout(function () {
    callback(null, a + b);
  }, 500);
}
```



```js
function asyncAdd(a, b, callback) {
  setTimeout(function () {
    callback(null, a + b);
  }, 500);
}

// è§£å†³æ–¹æ¡ˆ
// 1. promisify
const promiseAdd = (a, b) =>
  new Promise((resolve, reject) => {
    asyncAdd(a, b, (err, res) => {
      if (err) {
        reject(err);
      } else {
        resolve(res);
      }
    });
  });

// 2. ä¸²è¡Œå¤„ç†
async function serialSum(...args) {
  return args.reduce(
    (task, now) => task.then((res) => promiseAdd(res, now)),
    Promise.resolve(0)
  );


// 3. å¹¶è¡Œå¤„ç†
async function parallelSum(...args) {
  if (args.length === 1) return args[0];
  const tasks = [];
  for (let i = 0; i < args.length; i += 2) {
    tasks.push(promiseAdd(args[i], args[i + 1] || 0));
  }
  const results = await Promise.all(tasks);
  return parallelSum(...results);
}

// æµ‹è¯•
(async () => {
  console.log("Running...");
  const res1 = await serialSum(1, 2, 3, 4, 5, 8, 9, 10, 11, 12);
  console.log(res1);
  const res2 = await parallelSum(1, 2, 3, 4, 5, 8, 9, 10, 11, 12);
  console.log(res2);
  console.log("Done");
})();
```

## å®ç°`JSON.stringify`



## ç»Ÿè®¡`DOM`ä¸ªæ•°

```html
/**
 * 2.DOM çš„ä½“ç§¯è¿‡å¤§ä¼šå½±å“é¡µé¢æ€§èƒ½ï¼Œå‡å¦‚ä½ æƒ³åœ¨ç”¨æˆ·å…³é—­é¡µé¢æ—¶ç»Ÿè®¡ï¼ˆè®¡ç®—å¹¶åé¦ˆç»™æœåŠ¡å™¨ï¼‰
 å½“å‰é¡µé¢ä¸­å…ƒç´ èŠ‚ç‚¹çš„æ•°é‡æ€»å’Œã€å…ƒç´ èŠ‚ç‚¹çš„æœ€å¤§åµŒå¥—æ·±åº¦ä»¥åŠæœ€å¤§å­å…ƒç´ ä¸ªæ•°ï¼Œè¯·ç”¨ JS é…åˆ
 åŸç”Ÿ DOM API å®ç°è¯¥éœ€æ±‚ï¼ˆä¸ç”¨è€ƒè™‘é™ˆæ—§æµè§ˆå™¨ä»¥åŠåœ¨ç°ä»£æµè§ˆå™¨ä¸­çš„å…¼å®¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„
 æµè§ˆå™¨çš„æœ€æ–°ç‰¹æ€§ï¼›ä¸ç”¨è€ƒè™‘ shadow DOMï¼‰ã€‚æ¯”å¦‚åœ¨å¦‚ä¸‹é¡µé¢ä¸­è¿è¡Œåï¼š
 */
<html>
  <head></head>
  <body>
    <div>
      <span>f</span>
      <span>o</span>
      <span>o</span>
    </div>
  </body>
</html>
// ä¼šè¾“å‡ºï¼š

{
  totalElementsCount: 7,
  maxDOMTreeDepth: 4,
  maxChildrenCount: 3
}
```

```js
const obj = {};
class Ele {
  constructor(ele) {
    this.ele = ele;
    // ç»Ÿè®¡çš„æ·±åº¦
    this.funum = 1;
  }
  //å–å½“å‰èŠ‚ç‚¹çš„å…ƒç´ æ·±åº¦
  getEleDepth() {
    let fuele = this.ele.parentNode;
    if (fuele !== document) {
      this.funum++;
      this.ele = fuele;
      return this.getEleDepth();
    } else {
      return this.funum;
    }
  }
  //å»å½“å‰èŠ‚ç‚¹çš„å­å…ƒç´ ä¸ªæ•°
  getEleSubNum() {
    let zieles = this.ele.childNodes,
      zinum = 0;
    for (let i = 0; i < zieles.length; i++) {
      if (zieles[i].nodeName !== "#text") {
        zinum++;
      }
    }
    return zinum;
  }
}
const totalElements = document.getElementsByTagName("*");
obj.totalElementsCount = totalElements.length; //domä¸­çš„æ‰€æœ‰èŠ‚ç‚¹æ•°é‡

let eleDepthArr = [];
let eleSubArr = [];
for (let i = 0; i < totalElements.length; i++) {
  eleDepthArr.push(new Ele(totalElements[i]).getEleDepth());
  eleSubArr.push(new Ele(totalElements[i]).getEleSubNum());
}
eleDepthArr = eleDepthArr.sort((a, b) => b - a);
eleSubArr = eleSubArr.sort((a, b) => b - a);
obj.maxDOMTreeDepth = eleDepthArr[0]; //å…ƒç´ èŠ‚ç‚¹çš„æœ€å¤§åµŒå¥—æ·±åº¦
obj.maxChildrenCount = eleSubArr[0]; //æœ€å¤§å­å…ƒç´ ä¸ªæ•°

console.log(obj);
```

## å°†æ•°ç»„è½¬æ¢ä¸ºæ ‘

```js
// input 
let arr = [
    {id: 1, name: 'éƒ¨é—¨1', pid: 0},
    {id: 2, name: 'éƒ¨é—¨2', pid: 1},
    {id: 3, name: 'éƒ¨é—¨3', pid: 1},
    {id: 4, name: 'éƒ¨é—¨4', pid: 3},
    {id: 5, name: 'éƒ¨é—¨5', pid: 4},
]

// output
[
  {
    id: 1,
    name: "éƒ¨é—¨1",
    pid: 0,
    children: [
      {
        id: 2,
        name: "éƒ¨é—¨2",
        pid: 1,
        children: [],
      },
      {
        id: 3,
        name: "éƒ¨é—¨3",
        pid: 1,
        children: [
          // ç»“æœ ,,,
        ],
      },
    ],
  },
];

```

```js
function arrayToTree(items) {
  const result = []; // å­˜æ”¾ç»“æœé›†
  const itemMap = {}; //
  for (const item of items) {
    const id = item.id;
    const pid = item.pid;

    if (!itemMap[id]) {
      itemMap[id] = {
        children: [],
      };
    }

    itemMap[id] = {
      ...item,
      children: itemMap[id]["children"],
    };

    const treeItem = itemMap[id];

    if (pid === 0) {
      result.push(treeItem);
    } else {
      if (!itemMap[pid]) {
        itemMap[pid] = {
          children: [],
        };
      }
      itemMap[pid].children.push(treeItem);
    }
  }
  return result;
}
```



## å®ç°ä¸€ä¸ª`sleep`å‡½æ•°

```js
//Promise
const sleep = time => {
  return new Promise(resolve => setTimeout(resolve,time))
}
sleep(1000).then(()=>{
  console.log(1)
})

//async
function sleep(time) {
  return new Promise(resolve => setTimeout(resolve,time))
}
async function output() {
  let out = await sleep(1000);
  console.log(1);
  return out;
}
output();

//ES5
function sleep(callback,time) {
  if(typeof callback === 'function')
    setTimeout(callback,time)
}

function output(){
  console.log(1);
}
sleep(output,1000);
```

## å®ç°`es6`çš„`extends`

```js
function B(name){
  this.name = name;
};
function A(name,age){
  //1.å°†Açš„åŸå‹æŒ‡å‘B
  Object.setPrototypeOf(A,B);
  //2.ç”¨Açš„å®ä¾‹ä½œä¸ºthisè°ƒç”¨B,å¾—åˆ°ç»§æ‰¿Bä¹‹åçš„å®ä¾‹ï¼Œè¿™ä¸€æ­¥ç›¸å½“äºè°ƒç”¨super
  Object.getPrototypeOf(A).call(this, name)
  //3.å°†AåŸæœ‰çš„å±æ€§æ·»åŠ åˆ°æ–°å®ä¾‹ä¸Š
  this.age = age; 
  //4.è¿”å›æ–°å®ä¾‹å¯¹è±¡
  return this;
};
var a = new A('poetry',22);
console.log(a);
```



## å®ç°ä¸€ä¸ªå¯ä»¥æ‹–æ‹½çš„`div`

```js
<div id="xxx"></div>

var dragging = false
var position = null

xxx.addEventListener('mousedown',function(e){
  dragging = true
  position = [e.clientX, e.clientY]
})


document.addEventListener('mousemove', function(e){
  if(dragging === false) return null
  const x = e.clientX
  const y = e.clientY
  const deltaX = x - position[0]
  const deltaY = y - position[1]
  const left = parseInt(xxx.style.left || 0)
  const top = parseInt(xxx.style.top || 0)
  xxx.style.left = left + deltaX + 'px'
  xxx.style.top = top + deltaY + 'px'
  position = [x, y]
})
document.addEventListener('mouseup', function(e){
  dragging = false
})
```



## æ ¹æ®å­—ç¬¦å‡ºç°é¢‘ç‡æ’åº

è¾“å…¥`tree` è¾“å‡º`eert`æˆ–`eetr`

```javascript
var frequencySort = function(s) {
  let map = new Map()
  const res = []
  for(let i of s) {
    if(map.has(i)) {
      map.set(i, map.get(i) + 1)
    } else {
      map.set(i, 1)
    }
  }
  const arr = Array.from(map)
  arr.sort((a, b) => a[1] === b[1] ? b[0] - a[0] : b[1] - a[1])

  for(let i in arr) {
    for(let j = 0; j < arr[i][1]; j++) {
      res.push(arr[i][0])
    }
  }
  // return res
  return res.join('')
};
```

- **è§‚å¯Ÿè€…æ¨¡å¼**æ˜¯ç”±å…·ä½“ç›®æ ‡è°ƒåº¦ï¼Œæ¯”å¦‚å½“äº‹ä»¶è§¦å‘ï¼Œ`Dep` å°±ä¼šå»è°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼Œæ‰€ä»¥è§‚å¯Ÿè€…æ¨¡ å¼çš„è®¢é˜…è€…ä¸å‘å¸ƒè€…ä¹‹é—´æ˜¯å­˜åœ¨ä¾èµ–çš„

## å®ç°`prototype`çš„ç»§æ‰¿

```javascript
function Sup() {
  this.name = "xiaosong";
}

function Sub() {
  this.sex = "mal";
}

let father = new Sup();
Sub.prototype = father;

let son = new Sub();

console.log(son.name);
console.log(son.sex);
```

## å®ç°ä¸€ä¸ª`JSON.stringify`

```js
JSON.stringify(value[, replacer [, space]])ï¼š
```

- `Boolean | Number| String`ç±»å‹ä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„åŸå§‹å€¼ã€‚
- `undefined`ã€ä»»æ„å‡½æ•°ä»¥åŠ`symbol`ï¼Œä¼šè¢«å¿½ç•¥ï¼ˆå‡ºç°åœ¨éæ•°ç»„å¯¹è±¡çš„å±æ€§å€¼ä¸­æ—¶ï¼‰ï¼Œæˆ–è€…è¢«è½¬æ¢æˆ `null`ï¼ˆå‡ºç°åœ¨æ•°ç»„ä¸­æ—¶ï¼‰ã€‚
- ä¸å¯æšä¸¾çš„å±æ€§ä¼šè¢«å¿½ç•¥å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§å€¼é€šè¿‡æŸç§é—´æ¥çš„æ–¹å¼æŒ‡å›è¯¥å¯¹è±¡æœ¬èº«ï¼Œå³å¾ªç¯å¼•ç”¨ï¼Œå±æ€§ä¹Ÿä¼šè¢«å¿½ç•¥
- å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§å€¼é€šè¿‡æŸç§é—´æ¥çš„æ–¹å¼æŒ‡å›è¯¥å¯¹è±¡æœ¬èº«ï¼Œå³å¾ªç¯å¼•ç”¨ï¼Œå±æ€§ä¹Ÿä¼šè¢«å¿½ç•¥

```js
function jsonStringify(obj) {
    let type = typeof obj;
    if (type !== "object") {
        if (/string|undefined|function/.test(type)) {
            obj = '"' + obj + '"';
        }
        return String(obj);
    } else {
        let json = []
        let arr = Array.isArray(obj)
        for (let k in obj) {
            let v = obj[k];
            let type = typeof v;
            if (/string|undefined|function/.test(type)) {
                v = '"' + v + '"';
            } else if (type === "object") {
                v = jsonStringify(v);
            }
            json.push((arr ? "" : '"' + k + '":') + String(v));
        }
        return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}")
    }
}
jsonStringify({x : 5}) // "{"x":5}"
jsonStringify([1, "false", false]) // "[1,"false",false]"
jsonStringify({b: undefined}) // "{"b":"undefined"}"
```

## å®ç°`JSON.parse`

```text
JSON.parse(text[, reviver])
```

> ç”¨æ¥è§£æ`JSON`å­—ç¬¦ä¸²ï¼Œæ„é€ ç”±å­—ç¬¦ä¸²æè¿°çš„`JavaScript`å€¼æˆ–å¯¹è±¡ã€‚æä¾›å¯é€‰çš„`reviver`å‡½æ•°ç”¨ä»¥åœ¨è¿”å›ä¹‹å‰å¯¹æ‰€å¾—åˆ°çš„å¯¹è±¡æ‰§è¡Œå˜æ¢(æ“ä½œ)

**ç¬¬ä¸€ç§ï¼šç›´æ¥è°ƒç”¨ `eval`**

```js
function jsonParse(opt) {
    return eval('(' + opt + ')');
}
jsonParse(jsonStringify({x : 5}))
// Object { x: 5}
jsonParse(jsonStringify([1, "false", false]))
// [1, "false", falsr]
jsonParse(jsonStringify({b: undefined}))
// Object { b: "undefined"}
```

> é¿å…åœ¨ä¸å¿…è¦çš„æƒ…å†µä¸‹ä½¿ç”¨ `eval`ï¼Œ`eval()` æ˜¯ä¸€ä¸ªå±é™©çš„å‡½æ•°ï¼Œä»–æ‰§è¡Œçš„ä»£ç æ‹¥æœ‰ç€æ‰§è¡Œè€…çš„æƒåˆ©ã€‚å¦‚æœä½ ç”¨`eval()`è¿è¡Œçš„å­—ç¬¦ä¸²ä»£ç è¢«æ¶æ„æ–¹ï¼ˆä¸æ€€å¥½æ„çš„äººï¼‰æ“æ§ä¿®æ”¹ï¼Œæ‚¨æœ€ç»ˆå¯èƒ½ä¼šåœ¨æ‚¨çš„ç½‘é¡µ/æ‰©å±•ç¨‹åºçš„æƒé™ä¸‹ï¼Œåœ¨ç”¨æˆ·è®¡ç®—æœºä¸Šè¿è¡Œæ¶æ„ä»£ç ã€‚å®ƒä¼šæ‰§è¡Œ`JS`ä»£ç ï¼Œæœ‰`XSS`æ¼æ´ã€‚

å¦‚æœä½ åªæƒ³è®°è¿™ä¸ªæ–¹æ³•ï¼Œå°±å¾—å¯¹å‚æ•°jsonåšæ ¡éªŒã€‚

```js
var rx_one = /^[\],:{}\s]*$/;
var rx_two = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;
var rx_three = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;
var rx_four = /(?:^|:|,)(?:\s*\[)+/g;
if (
    rx_one.test(
        json
            .replace(rx_two, "@")
            .replace(rx_three, "]")
            .replace(rx_four, "")
    )
) {
    var obj = eval("(" +json + ")");
}
```

**ç¬¬äºŒç§ï¼š`Function`**

> æ ¸å¿ƒï¼š`Function`ä¸`eval`æœ‰ç›¸åŒçš„å­—ç¬¦ä¸²å‚æ•°ç‰¹æ€§

```text
var func = new Function(arg1, arg2, ..., functionBody);
```

åœ¨è½¬æ¢`JSON`çš„å®é™…åº”ç”¨ä¸­ï¼Œåªéœ€è¦è¿™ä¹ˆåš

```js
var jsonStr = '{ "age": 20, "name": "jack" }'
var json = (new Function('return ' + jsonStr))();
```

> `eval` ä¸ `Function`éƒ½æœ‰ç€åŠ¨æ€ç¼–è¯‘jsä»£ç çš„ä½œç”¨ï¼Œä½†æ˜¯åœ¨å®é™…çš„ç¼–ç¨‹ä¸­å¹¶ä¸æ¨èä½¿ç”¨

## å®ç°æ•°æ®çš„åŒå‘ç»‘å®š

```javascript
let obj = {};
let input = document.querySelector("input");
let span = document.querySelector("span");

Object.defineProperty(obj, "text", {
  enumerable: true,
  writeable: true,
  configurable: true,
  set(newVal) {
    console.log(newVal);
    input.value = newVal;
    span.innerHTML = newVal;
  },
  get() {
    console.log("get");
  },
});

input.addEventListener("keyup", function (e) {
  obj.text = e.target.value;
});
```

## å®ç°ç®€å•è·¯ç”±

```javascript
class Route {
  constructor() {
    // è·¯ç”±åˆ—è¡¨
    this.routes = {};
    // è·¯ç”±hash
    this.currentHash = "";
    this.freshHash = this.freshHash.bind(this);
    window.addEventListener("load", this.freshHash, false);
    window.addEventListener("hashchange", this.freshHash, false);
  }
  storeRoute(path, cb) {
    this.routes[path] = cb || function () {};
  }
  freshHash() {
    this.currentHash = location.hash.slice(1) || "/";
    this.routes[this.currentHash]();
  }
}
```

## åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰

```js
function judgeEqual(x, y) {
  if (Object.is) {
    return Object.is();
  } else {
    // SameValue algorithm
    if (x === y) {
      // Steps 1-5, 7-10
      // Steps 6.b-6.e: +0 != -0
      return x !== 0 || 1 / x === 1 / y;
    } else {
      // Step 6.a: NaN == NaN
      return x !== x && y !== y;
    }
  }
}
```

## è¾“å‡ºç»“æœï¼›å¦‚æœå¸Œæœ›æ¯éš” `1s` è¾“å‡ºä¸€ä¸ªç»“æœï¼Œåº”è¯¥å¦‚ä½•æ”¹é€ ï¼Ÿæ³¨æ„ä¸å¯æ”¹åŠ¨ `square` æ–¹æ³•

```js
const list = [1, 2, 3]
const square = num => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve(num * num)
    }, 1000)
  })
}

function test() {
  list.forEach(async x=> {
    const res = await square(x)
    console.log(res)
  })
}
test()
```

`1s` ååŒæ—¶æ‰“å° 1ã€4ã€9

åŸå› ï¼šä½¿ç”¨ `promise` æˆ– `async` å‡½æ•°ä½œä¸º `forEach()` ç­‰ç±»ä¼¼æ–¹æ³•çš„ `callback` å‚æ•°å¹¶ä¸ä¼šç­‰å¾…å¼‚æ­¥çš„æ‰§è¡Œ

å¦‚æœæˆ‘ä»¬å¸Œæœ›æ¯éš” `1s` è¾“å‡ºä¸€ä¸ªç»“æœï¼Œæ–¹æ³•æœ‰ï¼š

- ä¸€ä¸ªç®€å•çš„ `for` å¾ªç¯
- `forâ€¦of` / `forâ€¦in` å¾ªç¯
- åˆ©ç”¨ `promise` çš„é“¾å¼è°ƒç”¨

**è§£æ³•ä¸€ï¼š`for` å¾ªç¯**

```
async function test() {
    for(let i = 0; i<list.length; i++) {
        const res = await square(list[i])
    	console.log(res)
    }
}
test()
```

**è§£æ³•äºŒï¼š`forâ€¦in / forâ€¦of`**

```js
for...in
async function test() {
    for(let i in list) {
        const res = await square(list[i])
    	console.log(res)
    }
}
test()
for...of
async function test() {
    for(let x of list) {
        const res = await square(x)
    	console.log(res)
    }
}
test()
```

**è§£æ³•ä¸‰ï¼šåˆ©ç”¨ `promise` çš„é“¾å¼è°ƒç”¨**

```js
function test() {
    let promise = Promise.resolve()
    list.forEach(x=> {
        promise = promise.then(() => square(x)).then(console.log)
    })
}
test()
```

## å¦‚ä½•è®© `(a == 1 && a == 2 && a == 3)` è¿”å› `true`

```js
// 1.
const a = {
  i: 1,
  toString: function () {
    return a.i++;
  }
}

if (a == 1 && a == 2 && a == 3) {
  console.log('Hello World!');
}

// 2.
const a = {
  i: 1,
  valueOf() {
    return this.i++
  }
}

if (a == 1 && a == 2 && a == 3) {
  console.log('Hello World!');
}

// 3.
var a = new Proxy({ i: 1 }, {
  get(target) { return () => target.i++ }
});

// 4.
var a = { i: 1 }
Object.defineProperty(a, 'value', {
  enumerable: false,
  configurable: false,
  get() { return a.i }
  set() { a.i++ }
})

// 5.
var i = 1
Object.defineProperty(window, 'a', {
  get() { return i++ }
})

if (a === 1 && a === 2 && a === 3) {
  console.log('Hello World!');
}
```



## å®ç°æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²

```javascript
var lengthOfLongestSubstring = function(s) {
  let len = s.length
  let set = new Set()
  let left = 0
  let right = 0
  let sum = 0
  while(left < len) {
    while(right < len && !set.has(s[right])) {
      set.add(s[right])
      right++
    }
    // å¤„ç†é‡å¤çš„
    sum = Math.max(sum, right - left)
    set.delete(s[left])
    left++
  }
  return sum
};
```

## ä½¿ç”¨`setTimeout`æ¨¡æ‹Ÿ`setInterval`

```javascript
function mySetInterval(fn, timeout) {
  // æ§åˆ¶å™¨ï¼Œæ§åˆ¶å®šæ—¶å™¨æ˜¯å¦ç»§ç»­æ‰§è¡Œ
  var timer = {
    flag: true
  };
  // è®¾ç½®é€’å½’å‡½æ•°ï¼Œæ¨¡æ‹Ÿå®šæ—¶å™¨æ‰§è¡Œã€‚
  function interval() {
    if (timer.flag) {
      fn();
      setTimeout(interval, timeout);
    }
  }
  // å¯åŠ¨å®šæ—¶å™¨
  setTimeout(interval, timeout);
  // è¿”å›æ§åˆ¶å™¨
  return timer;
}
// å®Œæ•´ç‰ˆ
function setInterval1 (handler,timeout,...args) {
  let isBrowser = typeof window !== 'undefined'
  if(isBrowser && this !== window){
    throw 'TypeError: Illegal invocation'
  }
  let timer = {}
  if(isBrowser){
    // æµè§ˆå™¨ä¸Šå¤„ç†
    timer = {
      value:-1,
      valueOf: function (){
        return this.value
      }
    }
    let callback = ()=>{
      handler.apply(this,args)
      timer.value = setTimeout(callback,timeout)
    }
    timer.value = setTimeout(callback,timeout)
  } else {
    // nodejsçš„å¤„ç†
    let callback = ()=>{
      handler.apply(this,args)
      Object.assign(timer,setTimeout(callback,timeout))
    }
    Object.assign(timer,setTimeout(callback,timeout))
  }
  return timer
}
```

## åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨

```javascript
const isCycleObject = (obj,parent) => {
    const parentArr = parent || [obj];
    for(let i in obj) {
        if(typeof obj[i] === 'object') {
            let flag = false;
            parentArr.forEach((pObj) => {
                if(pObj === obj[i]){
                    flag = true;
                }
            })
            if(flag) return true;
            flag = isCycleObject(obj[i],[...parentArr,obj[i]]);
            if(flag) return true;
        }
    }
    return false;
}


const a = 1;
const b = {a};
const c = {b};
const o = {d:{a:3},c}
o.c.b.aa = a;

console.log(isCycleObject(o)
```

## å¦‚ä½•æ¸²æŸ“å‡ ä¸‡æ¡æ•°æ®å¹¶ä¸å¡ä½ç•Œé¢

> è¿™é“é¢˜è€ƒå¯Ÿäº†å¦‚ä½•åœ¨ä¸å¡ä½é¡µé¢çš„æƒ…å†µä¸‹æ¸²æŸ“æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¸€æ¬¡æ€§å°†å‡ ä¸‡æ¡éƒ½æ¸²æŸ“å‡ºæ¥ï¼Œè€Œåº”è¯¥ä¸€æ¬¡æ¸²æŸ“éƒ¨åˆ† `DOM`ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ `requestAnimationFrame` æ¥æ¯ `16 ms` åˆ·æ–°ä¸€æ¬¡

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <ul>æ§ä»¶</ul>
  <script>
    setTimeout(() => {
      // æ’å…¥åä¸‡æ¡æ•°æ®
      const total = 100000
      // ä¸€æ¬¡æ’å…¥ 20 æ¡ï¼Œå¦‚æœè§‰å¾—æ€§èƒ½ä¸å¥½å°±å‡å°‘
      const once = 20
      // æ¸²æŸ“æ•°æ®æ€»å…±éœ€è¦å‡ æ¬¡
      const loopCount = total / once
      let countOfRender = 0
      let ul = document.querySelector("ul");
      function add() {
        // ä¼˜åŒ–æ€§èƒ½ï¼Œæ’å…¥ä¸ä¼šé€ æˆå›æµ
        const fragment = document.createDocumentFragment();
        for (let i = 0; i < once; i++) {
          const li = document.createElement("li");
          li.innerText = Math.floor(Math.random() * total);
          fragment.appendChild(li);
        }
        ul.appendChild(fragment);
        countOfRender += 1;
        loop();
      }
      function loop() {
        if (countOfRender < loopCount) {
          window.requestAnimationFrame(add);
        }
      }
      loop();
    }, 0);
  </script>
</body>
</html>
```

## å¸Œæœ›è·å–åˆ°é¡µé¢ä¸­æ‰€æœ‰çš„`checkbox`æ€ä¹ˆåšï¼Ÿ

> ä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶

```js
 var domList = document.getElementsByTagName(â€˜inputâ€™)
 var checkBoxList = [];
 var len = domList.length;ã€€ã€€//ç¼“å­˜åˆ°å±€éƒ¨å˜é‡
 while (len--) {ã€€ã€€//ä½¿ç”¨whileçš„æ•ˆç‡ä¼šæ¯”forå¾ªç¯æ›´é«˜
 ã€€ã€€if (domList[len].type == â€˜checkboxâ€™) {
     ã€€ã€€checkBoxList.push(domList[len]);
 ã€€ã€€}
 }
```

## `Javascript`ä¸­`callee`å’Œ`caller`çš„ä½œç”¨ï¼Ÿ

- `caller`æ˜¯è¿”å›ä¸€ä¸ªå¯¹å‡½æ•°çš„å¼•ç”¨ï¼Œè¯¥å‡½æ•°è°ƒç”¨äº†å½“å‰`å‡½æ•°ï¼›
- `callee`æ˜¯è¿”å›æ­£åœ¨è¢«æ‰§è¡Œçš„`function`å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰€æŒ‡å®šçš„`function`å¯¹è±¡çš„æ­£æ–‡

> é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Ÿå¦‚æœä¸€å¯¹å…”å­æ¯æœˆç”Ÿä¸€å¯¹å…”å­ï¼›ä¸€å¯¹æ–°ç”Ÿå…”ï¼Œä»ç¬¬äºŒä¸ªæœˆèµ·å°±å¼€å§‹ç”Ÿå…”å­ï¼›å‡å®šæ¯å¯¹å…”å­éƒ½æ˜¯ä¸€é›Œä¸€é›„ï¼Œè¯•é—®ä¸€å¯¹å…”å­ï¼Œç¬¬nä¸ªæœˆèƒ½ç¹æ®–æˆå¤šå°‘å¯¹å…”å­ï¼Ÿï¼ˆä½¿ç”¨`callee`å®Œæˆï¼‰

```js
function fn(n) {
  //å…¸å‹çš„æ–æ³¢é‚£å¥‘æ•°åˆ—
  if (n == 1) {
    return 1;
  } else if (n == 2) {
    return 1;
  } else {
    //argument.callee()è¡¨ç¤ºfn()
    return arguments.callee(n - 1) + arguments.callee(n - 2);
  }
}
```

## ï¼ˆè®¾è®¡é¢˜ï¼‰æƒ³å®ç°ä¸€ä¸ªå¯¹é¡µé¢æŸä¸ªèŠ‚ç‚¹çš„æ‹–æ›³ï¼Ÿå¦‚ä½•åšï¼Ÿï¼ˆä½¿ç”¨åŸç”Ÿ`JS`ï¼‰

- ç»™éœ€è¦æ‹–æ‹½çš„èŠ‚ç‚¹ç»‘å®š`mousedown`, `mousemove`, `mouseup`äº‹ä»¶
- `mousedown`äº‹ä»¶è§¦å‘åï¼Œå¼€å§‹æ‹–æ‹½
- `mousemove`æ—¶ï¼Œéœ€è¦é€šè¿‡`event.clientX`å’Œ`clientY`è·å–æ‹–æ‹½ä½ç½®ï¼Œå¹¶å®æ—¶æ›´æ–°ä½ç½®
- `mouseup`æ—¶ï¼Œæ‹–æ‹½ç»“æŸ
- éœ€è¦æ³¨æ„æµè§ˆå™¨è¾¹ç•Œçš„æƒ…å†µ

## ä½¿ç”¨`js`å®ç°ä¸€ä¸ªæŒç»­çš„åŠ¨ç”»æ•ˆæœ

**å®šæ—¶å™¨æ€è·¯**

```js
var e = document.getElementById('e')
var flag = true;
var left = 0;
setInterval(() => {
    left == 0 ? flag = true : left == 100 ? flag = false : ''
    flag ? e.style.left = ` ${left++}px` : e.style.left = ` ${left--}px`
}, 1000 / 60)
```

**`requestAnimationFrame`**

```js
//å…¼å®¹æ€§å¤„ç†
window.requestAnimFrame = (function(){
    return window.requestAnimationFrame       ||
           window.webkitRequestAnimationFrame ||
           window.mozRequestAnimationFrame    ||
           function(callback){
                window.setTimeout(callback, 1000 / 60);
           };
})();

var e = document.getElementById("e");
var flag = true;
var left = 0;

function render() {
    left == 0 ? flag = true : left == 100 ? flag = false : '';
    flag ? e.style.left = ` ${left++}px` :
        e.style.left = ` ${left--}px`;
}

(function animloop() {
    render();
    requestAnimFrame(animloop);
})();
```

**ä½¿ç”¨`css`å®ç°ä¸€ä¸ªæŒç»­çš„åŠ¨ç”»æ•ˆæœ**

```css
animation:mymove 5s infinite;

@keyframes mymove {
    from {top:0px;}
    to {top:200px;}
}
```

- `animation-name` è§„å®šéœ€è¦ç»‘å®šåˆ°é€‰æ‹©å™¨çš„ `keyframe`åç§°ã€‚
- `animation-duration` è§„å®šå®ŒæˆåŠ¨ç”»æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œä»¥ç§’æˆ–æ¯«ç§’è®¡ã€‚
- `animation-timing-function` è§„å®šåŠ¨ç”»çš„é€Ÿåº¦æ›²çº¿ã€‚
- `animation-delay` è§„å®šåœ¨åŠ¨ç”»å¼€å§‹ä¹‹å‰çš„å»¶è¿Ÿã€‚
- `animation-iteration-count` è§„å®šåŠ¨ç”»åº”è¯¥æ’­æ”¾çš„æ¬¡æ•°ã€‚
- `animation-direction` è§„å®šæ˜¯å¦åº”è¯¥è½®æµåå‘æ’­æ”¾åŠ¨ç”»

## å°è£…ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°æ˜¯å®šæ—¶å™¨çš„æ—¶é—´ï¼Œ`.then`æ‰§è¡Œå›è°ƒå‡½æ•°

```js
function sleep (time) {
    return new Promise((resolve) => setTimeout(resolve, time));
}
```

## æ€ä¹ˆåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Ÿ

```js
obj={
    a:1,
    b:2
}
obj2={
    a:1,
    b:2
}
obj3={
    a:1,
    b:'2'
}
```

> å¯ä»¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¥åˆ¤æ–­

```js
JSON.stringify(obj)==JSON.stringify(obj2);//true
JSON.stringify(obj)==JSON.stringify(obj3);//false
```

## å®ç°æ•ˆæœï¼Œç‚¹å‡»å®¹å™¨å†…çš„å›¾æ ‡ï¼Œå›¾æ ‡è¾¹æ¡†å˜æˆ`border 1px solid red`ï¼Œç‚¹å‡»ç©ºç™½å¤„é‡ç½®

```js
const box = document.getElementById('box');
function isIcon(target) {
  return target.className.includes('icon');
}

box.onClick = function(e) {
  e.stopPropagation();
  const target = e.target;
  if (isIcon(target)) {
    target.style.border = '1px solid red';
  }
}
const doc = document;
doc.onclick = function(e) {
  const children = box.children;
  for(let i; i < children.length; i++) {
    if (isIcon(children[i])) {
      children[i].style.border = 'none';
    }
  }
}
```

## è¯·ç®€å•å®ç°åŒå‘æ•°æ®ç»‘å®š`mvvm`

```html
<input id="input"/>
<script>
const data = {};
const input = document.getElementById('input');
Object.defineProperty(data, 'text', {
  set(value) {
    input.value = value;
    this.value = value;
  }
});
input.onChange = function(e) {
  data.text = e.target.value;
}
</script>
```

## å®ç°`Storage`ï¼Œä½¿å¾—è¯¥å¯¹è±¡ä¸ºå•ä¾‹ï¼Œå¹¶å¯¹`localStorage`è¿›è¡Œå°è£…è®¾ç½®å€¼`setItem(key,value)`å’Œ`getItem(key)`

```js
var instance = null;
class Storage {
  static getInstance() {
    if (!instance) {
      instance = new Storage();
    }
    return instance;
  }
  setItem = (key, value) => localStorage.setItem(key, value),
  getItem = key => localStorage.getItem(key)
}
// è°ƒç”¨
// Storage.getInstance()
// instance.setItem('xx', 'xxx')
// instance.getItem('xx')
```

## ç°åœ¨è¦ä½ å®Œæˆä¸€ä¸ª`Dialog`ç»„ä»¶ï¼Œè¯´è¯´ä½ è®¾è®¡çš„æ€è·¯ï¼Ÿå®ƒåº”è¯¥æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ

- è¯¥ç»„ä»¶éœ€è¦æä¾›`hook`æŒ‡å®šæ¸²æŸ“ä½ç½®ï¼Œé»˜è®¤æ¸²æŸ“åœ¨`body`ä¸‹é¢ã€‚
- ç„¶åæ”¹ç»„ä»¶å¯ä»¥æŒ‡å®šå¤–å±‚æ ·å¼ï¼Œå¦‚å®½åº¦ç­‰
- ç»„ä»¶å¤–å±‚è¿˜éœ€è¦ä¸€å±‚`mask`æ¥é®ä½åº•å±‚å†…å®¹ï¼Œç‚¹å‡»`mask`å¯ä»¥æ‰§è¡Œä¼ è¿›æ¥çš„`onCancel`å‡½æ•°å…³é—­`Dialog`ã€‚
- å¦å¤–ç»„ä»¶æ˜¯å¯æ§çš„ï¼Œéœ€è¦å¤–å±‚ä¼ å…¥`visible`è¡¨ç¤ºæ˜¯å¦å¯è§ã€‚
- ç„¶å`Dialog`å¯èƒ½éœ€è¦è‡ªå®šä¹‰å¤´headå’Œåº•éƒ¨`footer`ï¼Œé»˜è®¤æœ‰å¤´éƒ¨å’Œåº•éƒ¨ï¼Œåº•éƒ¨æœ‰ä¸€ä¸ªç¡®è®¤æŒ‰é’®å’Œå–æ¶ˆæŒ‰é’®ï¼Œç¡®è®¤æŒ‰é’®ä¼šæ‰§è¡Œå¤–éƒ¨ä¼ è¿›æ¥çš„`onOk`äº‹ä»¶ï¼Œç„¶åå–æ¶ˆæŒ‰é’®ä¼šæ‰§è¡Œå¤–éƒ¨ä¼ è¿›æ¥çš„`onCancel`äº‹ä»¶ã€‚
- å½“ç»„ä»¶çš„`visible`ä¸º`true`æ—¶å€™ï¼Œè®¾ç½®`body`çš„`overflow`ä¸º`hidden`ï¼Œéšè—`body`çš„æ»šåŠ¨æ¡ï¼Œåä¹‹æ˜¾ç¤ºæ»šåŠ¨æ¡ã€‚
- ç»„ä»¶é«˜åº¦å¯èƒ½å¤§äºé¡µé¢é«˜åº¦ï¼Œç»„ä»¶å†…éƒ¨éœ€è¦æ»šåŠ¨æ¡ã€‚
- åªæœ‰ç»„ä»¶çš„`visible`æœ‰å˜åŒ–ä¸”ä¸º`ture`æ—¶å€™ï¼Œæ‰é‡æ¸²æŸ“ç»„ä»¶å†…çš„æ‰€æœ‰å†…å®¹

## åœ¨è¾“å…¥æ¡†ä¸­å¦‚ä½•åˆ¤æ–­è¾“å…¥çš„æ˜¯ä¸€ä¸ªæ­£ç¡®çš„ç½‘å€

```js
function isUrl(url) {
	try {
		new URL(url);
		return true;
	} catch(err) {
		return false;
}}
```

## å†™ä¸€ä¸ªé€šç”¨çš„äº‹ä»¶ä¾¦å¬å™¨å‡½æ•°

```js
// event(äº‹ä»¶)å·¥å…·é›†ï¼Œæ¥æºï¼šgithub.com/markyun
markyun.Event = {
  // è§†èƒ½åŠ›åˆ†åˆ«ä½¿ç”¨dom0||dom2||IEæ–¹å¼ æ¥ç»‘å®šäº‹ä»¶
  // å‚æ•°ï¼š æ“ä½œçš„å…ƒç´ ,äº‹ä»¶åç§° ,äº‹ä»¶å¤„ç†ç¨‹åº
  addEvent: function (element, type, handler) {
    if (element.addEventListener) {
      //äº‹ä»¶ç±»å‹ã€éœ€è¦æ‰§è¡Œçš„å‡½æ•°ã€æ˜¯å¦æ•æ‰
      element.addEventListener(type, handler, false);
    } else if (element.attachEvent) {
      element.attachEvent("on" + type, function () {
        handler.call(element);
      });
    } else {
      element["on" + type] = handler;
    }
  },
  // ç§»é™¤äº‹ä»¶
  removeEvent: function (element, type, handler) {
    if (element.removeEventListener) {
      element.removeEventListener(type, handler, false);
    } else if (element.datachEvent) {
      element.detachEvent("on" + type, handler);
    } else {
      element["on" + type] = null;
    }
  },
  // é˜»æ­¢äº‹ä»¶ (ä¸»è¦æ˜¯äº‹ä»¶å†’æ³¡ï¼Œå› ä¸ºIEä¸æ”¯æŒäº‹ä»¶æ•è·)
  stopPropagation: function (ev) {
    if (ev.stopPropagation) {
      ev.stopPropagation();
    } else {
      ev.cancelBubble = true;
    }
  },
  // å–æ¶ˆäº‹ä»¶çš„é»˜è®¤è¡Œä¸º
  preventDefault: function (event) {
    if (event.preventDefault) {
      event.preventDefault();
    } else {
      event.returnValue = false;
    }
  },
  // è·å–äº‹ä»¶ç›®æ ‡
  getTarget: function (event) {
    return event.target || event.srcElement;
  },
};
```

## ç¼–å†™ä¸€ä¸ªæ–¹æ³•æ±‚å­—ç¬¦ä¸²å­—èŠ‚é•¿åº¦

> å‡è®¾ï¼šä¸€ä¸ªè‹±æ–‡å­—ç¬¦å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦å ç”¨ä¸¤ä¸ªå­—èŠ‚

```js
function GetBytes(str) {
  let len = str.length;
  let bytes = len;

  for (let i = 0; i < len; i++) {
    if (str.charCodeAt(i) > 255) bytes++;
  }
  return bytes;
}

alert(GetBytes("ä½ å¥½,crucials"));
```

## ä¸‹é¢è¿™ä¸ª`ul`ï¼Œå¦‚ä½•ç‚¹å‡»æ¯ä¸€åˆ—çš„æ—¶å€™`alert`å…¶`index`

> è€ƒå¯Ÿé—­åŒ…

```html
 <ul id=â€testâ€>
     <li>è¿™æ˜¯ç¬¬ä¸€æ¡</li>
     <li>è¿™æ˜¯ç¬¬äºŒæ¡</li>
     <li>è¿™æ˜¯ç¬¬ä¸‰æ¡</li>
 </ul>
<script>
  // æ–¹æ³•ä¸€ï¼š
var lis = document.getElementById("test").getElementsByTagName("li");
for (var i = 0; i < 3; i++) {
  lis[i].index = i;
  lis[i].onclick = function () {
    alert(this.index);
  };
}
//æ–¹æ³•äºŒï¼š
var lis = document.getElementById("test").getElementsByTagName("li");
for (var i = 0; i < 3; i++) {
  lis[i].index = i;
  lis[i].onclick = (function (a) {
    return function () {
      alert(a);
    };
  })(i);
}
</script>
```

## å®šä¹‰ä¸€ä¸ª`log`æ–¹æ³•ï¼Œè®©å®ƒå¯ä»¥ä»£ç†`console.log`çš„æ–¹æ³•

```js
å¯è¡Œçš„æ–¹æ³•ä¸€ï¼š

 function log(msg)ã€€{
     console.log(msg);
 }

 log("hello world!") // hello world!
```

> å¦‚æœè¦ä¼ å…¥å¤šä¸ªå‚æ•°å‘¢ï¼Ÿæ˜¾ç„¶ä¸Šé¢çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œæ‰€ä»¥æ›´å¥½çš„æ–¹æ³•æ˜¯ï¼š

```js
 function log(){
     console.log.apply(console, arguments);
 };
```

## å†™ä¸€ä¸ª`function`ï¼Œæ¸…é™¤å­—ç¬¦ä¸²å‰åçš„ç©ºæ ¼

> ä½¿ç”¨è‡ªå¸¦æ¥å£`trim()`ï¼Œè€ƒè™‘å…¼å®¹æ€§ï¼š

```js
if (!String.prototype.trim) {
    String.prototype.trim = function() {
        return this.replace(/^\s+/, "").replace(/\s+$/,"");
    }
}

 // test the function
 var str = " \t\n test string ".trim();
 alert(str == "test string"); // alerts "true"
```

## å®ç°æ¯éš”ä¸€ç§’é’Ÿè¾“å‡º`1,2,3...`æ•°å­—

```js
for (var i = 0; i < 10; i++) {
  (function (j) {
    setTimeout(function () {
      console.log(j + 1);
    }, j * 1000);
  })(i);
}
```

## `js`è‡ªå®šä¹‰äº‹ä»¶

> ä¸‰è¦ç´ ï¼š `document.createEvent()` `event.initEvent()` `element.dispatchEvent()`

```js
// (en:è‡ªå®šä¹‰äº‹ä»¶åç§°ï¼Œfn:äº‹ä»¶å¤„ç†å‡½æ•°ï¼ŒaddEvent:ä¸ºDOMå…ƒç´ æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ï¼ŒtriggerEvent:è§¦å‘è‡ªå®šä¹‰äº‹ä»¶)
window.onload = function(){
    var demo = document.getElementById("demo");
    demo.addEvent("test",function(){console.log("handler1")});
    demo.addEvent("test",function(){console.log("handler2")});
    demo.onclick = function(){
        this.triggerEvent("test");
    }
}
Element.prototype.addEvent = function(en,fn){
    this.pools = this.pools || {};
    if(en in this.pools){
        this.pools[en].push(fn);
    }else{
        this.pools[en] = [];
        this.pools[en].push(fn);
    }
}
Element.prototype.triggerEvent  = function(en){
    if(en in this.pools){
        var fns = this.pools[en];
        for(var i=0,il=fns.length;i<il;i++){
            fns[i]();
        }
    }else{
        return;
    }
}
```

## å®ç°ä¸€ä¸ªç®€å•çš„ç›‘å¬è§†çª—æ¿€æ´»çŠ¶æ€

![](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201271548112.gif)

```js
// çª—å£æ¿€æ´»çŠ¶æ€ç›‘å¬
let vEvent = 'visibilitychange';
if (document.webkitHidden != undefined) {
    vEvent = 'webkitvisibilitychange';
}

function visibilityChanged() {
    if (document.hidden || document.webkitHidden) {
        document.title = 'å®¢å®˜ï¼Œåˆ«èµ°å•Š~'
        console.log("Web page is hidden.")
    } else {
        document.title = 'å®¢å®˜ï¼Œä½ åˆå›æ¥äº†å‘¢~'
        console.log("Web page is visible.")
    }
}

document.addEventListener(vEvent, visibilityChanged, false);
```

