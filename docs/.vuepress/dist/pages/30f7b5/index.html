<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redux | 小宋爱睡觉</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="🚀一个前端程序员小白的博客🌹">
    <meta name="keywords" content="blog,crucials,frontend,前端,小宋爱睡觉,博客,duochizhacai">
    <meta name="theme-color" content="#60ad81">
    
    <link rel="preload" href="/assets/css/0.styles.65787d8c.css" as="style"><link rel="preload" href="/assets/js/app.95fc12d6.js" as="script"><link rel="preload" href="/assets/js/2.abf57e2f.js" as="script"><link rel="preload" href="/assets/js/48.8d4e8a09.js" as="script"><link rel="prefetch" href="/assets/js/10.9d6bb65c.js"><link rel="prefetch" href="/assets/js/11.bea1ca2d.js"><link rel="prefetch" href="/assets/js/12.a5ced6a2.js"><link rel="prefetch" href="/assets/js/13.ec1bcac6.js"><link rel="prefetch" href="/assets/js/14.4e5bcc62.js"><link rel="prefetch" href="/assets/js/15.753bb2dc.js"><link rel="prefetch" href="/assets/js/16.a6e51bcc.js"><link rel="prefetch" href="/assets/js/17.25227dca.js"><link rel="prefetch" href="/assets/js/18.19267273.js"><link rel="prefetch" href="/assets/js/19.a9403a12.js"><link rel="prefetch" href="/assets/js/20.c007e659.js"><link rel="prefetch" href="/assets/js/21.dca7af69.js"><link rel="prefetch" href="/assets/js/22.d9f25771.js"><link rel="prefetch" href="/assets/js/23.2668c7ed.js"><link rel="prefetch" href="/assets/js/24.30c858a4.js"><link rel="prefetch" href="/assets/js/25.bd21abb1.js"><link rel="prefetch" href="/assets/js/26.28d250cb.js"><link rel="prefetch" href="/assets/js/27.a60d212f.js"><link rel="prefetch" href="/assets/js/28.8a5c2c34.js"><link rel="prefetch" href="/assets/js/29.4688a5d6.js"><link rel="prefetch" href="/assets/js/3.e687237e.js"><link rel="prefetch" href="/assets/js/30.5985f3b4.js"><link rel="prefetch" href="/assets/js/31.7ee5d916.js"><link rel="prefetch" href="/assets/js/32.2f711dea.js"><link rel="prefetch" href="/assets/js/33.45a4e58a.js"><link rel="prefetch" href="/assets/js/34.6a46cad8.js"><link rel="prefetch" href="/assets/js/35.79084a19.js"><link rel="prefetch" href="/assets/js/36.9a5cf509.js"><link rel="prefetch" href="/assets/js/37.ea6b36a3.js"><link rel="prefetch" href="/assets/js/38.1ebed809.js"><link rel="prefetch" href="/assets/js/39.16200e67.js"><link rel="prefetch" href="/assets/js/4.4a0efd85.js"><link rel="prefetch" href="/assets/js/40.db1f5064.js"><link rel="prefetch" href="/assets/js/41.5c8205b4.js"><link rel="prefetch" href="/assets/js/42.d8e671a9.js"><link rel="prefetch" href="/assets/js/43.80c6d459.js"><link rel="prefetch" href="/assets/js/44.0dc33dbe.js"><link rel="prefetch" href="/assets/js/45.e623e04e.js"><link rel="prefetch" href="/assets/js/46.b9a46fc2.js"><link rel="prefetch" href="/assets/js/47.2d5eb349.js"><link rel="prefetch" href="/assets/js/49.f7f58461.js"><link rel="prefetch" href="/assets/js/5.84799806.js"><link rel="prefetch" href="/assets/js/50.b482896d.js"><link rel="prefetch" href="/assets/js/51.9ad2b264.js"><link rel="prefetch" href="/assets/js/52.7862671c.js"><link rel="prefetch" href="/assets/js/53.d8153804.js"><link rel="prefetch" href="/assets/js/54.0af2674d.js"><link rel="prefetch" href="/assets/js/55.597b91b8.js"><link rel="prefetch" href="/assets/js/56.46804158.js"><link rel="prefetch" href="/assets/js/57.006f6db0.js"><link rel="prefetch" href="/assets/js/58.751e40d0.js"><link rel="prefetch" href="/assets/js/59.b0ebe0e6.js"><link rel="prefetch" href="/assets/js/6.f7ec0152.js"><link rel="prefetch" href="/assets/js/60.8d675b12.js"><link rel="prefetch" href="/assets/js/61.55190a7f.js"><link rel="prefetch" href="/assets/js/62.117f5f66.js"><link rel="prefetch" href="/assets/js/63.b848bfe2.js"><link rel="prefetch" href="/assets/js/64.000227a3.js"><link rel="prefetch" href="/assets/js/65.9ec404e1.js"><link rel="prefetch" href="/assets/js/66.1834b2b1.js"><link rel="prefetch" href="/assets/js/67.bf716de8.js"><link rel="prefetch" href="/assets/js/68.6e03054c.js"><link rel="prefetch" href="/assets/js/69.c6605c56.js"><link rel="prefetch" href="/assets/js/7.40c08f02.js"><link rel="prefetch" href="/assets/js/70.30051d78.js"><link rel="prefetch" href="/assets/js/71.1fdc7d36.js"><link rel="prefetch" href="/assets/js/72.4b0ad4ad.js"><link rel="prefetch" href="/assets/js/73.e989ab6d.js"><link rel="prefetch" href="/assets/js/74.02429c23.js"><link rel="prefetch" href="/assets/js/75.8f044cef.js"><link rel="prefetch" href="/assets/js/76.7acc2de5.js"><link rel="prefetch" href="/assets/js/77.ce127400.js"><link rel="prefetch" href="/assets/js/78.deb1ae24.js"><link rel="prefetch" href="/assets/js/79.75a4c78b.js"><link rel="prefetch" href="/assets/js/8.303c64d8.js"><link rel="prefetch" href="/assets/js/80.6c258060.js"><link rel="prefetch" href="/assets/js/81.563a0c28.js"><link rel="prefetch" href="/assets/js/82.143b4caf.js"><link rel="prefetch" href="/assets/js/83.32431b7f.js"><link rel="prefetch" href="/assets/js/84.2320a5a5.js"><link rel="prefetch" href="/assets/js/85.d9a1625a.js"><link rel="prefetch" href="/assets/js/86.dc0f47f2.js"><link rel="prefetch" href="/assets/js/87.8335157f.js"><link rel="prefetch" href="/assets/js/88.2cfc7001.js"><link rel="prefetch" href="/assets/js/89.6bc590c2.js"><link rel="prefetch" href="/assets/js/9.7ba1b2de.js"><link rel="prefetch" href="/assets/js/90.c20801a7.js"><link rel="prefetch" href="/assets/js/91.1a32fafc.js"><link rel="prefetch" href="/assets/js/92.4a802465.js">
    <link rel="stylesheet" href="/assets/css/0.styles.65787d8c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/logo.png" alt="小宋爱睡觉" class="logo"> <span class="site-name can-hide">小宋爱睡觉</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><a href="/pages/56881f/" class="link-title">知识库</a> <span class="title" style="display:none;">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/56881f/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/c0e7f0/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/787250/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/f0a671/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/b7238f/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/2448f7/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/b8bd46/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/pages/f15087/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/pages/e3cba5/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/pages/ba01c4/" class="nav-link">手写系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/pages/ad5191/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ac126/" class="nav-link">字符串</a></li><li class="dropdown-item"><!----> <a href="/pages/251490/" class="nav-link">数组</a></li><li class="dropdown-item"><!----> <a href="/pages/fc9745/" class="nav-link">链表</a></li><li class="dropdown-item"><!----> <a href="/pages/ad5191/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/6aee18/" class="nav-link">动态规划</a></li><li class="dropdown-item"><!----> <a href="/pages/78e948/" class="nav-link">排序算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><a href="/pages/30f7b5/https://github.com/duochizhacai" class="link-title">GitHub</a> <span class="title" style="display:none;">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duochizhacai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1249486902410744" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JueJin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><a href="/pages/56881f/" class="link-title">知识库</a> <span class="title" style="display:none;">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/56881f/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/c0e7f0/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/787250/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/f0a671/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/b7238f/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/2448f7/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/b8bd46/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/pages/f15087/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/pages/e3cba5/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/pages/ba01c4/" class="nav-link">手写系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/pages/ad5191/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ac126/" class="nav-link">字符串</a></li><li class="dropdown-item"><!----> <a href="/pages/251490/" class="nav-link">数组</a></li><li class="dropdown-item"><!----> <a href="/pages/fc9745/" class="nav-link">链表</a></li><li class="dropdown-item"><!----> <a href="/pages/ad5191/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/6aee18/" class="nav-link">动态规划</a></li><li class="dropdown-item"><!----> <a href="/pages/78e948/" class="nav-link">排序算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><a href="/pages/30f7b5/https://github.com/duochizhacai" class="link-title">GitHub</a> <span class="title" style="display:none;">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duochizhacai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1249486902410744" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JueJin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/b7238f/" class="sidebar-link">事件机制</a></li><li><a href="/pages/24db5f/" class="sidebar-link">数据管理</a></li><li><a href="/pages/54c6f9/" class="sidebar-link">生命周期</a></li><li><a href="/pages/be9376/" class="sidebar-link">组件通信</a></li><li><a href="/pages/000594/" class="sidebar-link">路由</a></li><li><a href="/pages/30f7b5/" aria-current="page" class="active sidebar-link">redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/30f7b5/#对-redux-的理解-主要解决什么问题" class="sidebar-link">对 Redux 的理解，主要解决什么问题</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-原理及工作流程" class="sidebar-link">Redux 原理及工作流程</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-中异步的请求怎么处理" class="sidebar-link">Redux 中异步的请求怎么处理</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-怎么实现属性传递-介绍下原理" class="sidebar-link">Redux 怎么实现属性传递，介绍下原理</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-中间件是什么-接受几个参数-柯里化函数两端的参数具体是什么" class="sidebar-link">Redux 中间件是什么？接受几个参数？柯里化函数两端的参数具体是什么？</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-请求中间件如何处理并发" class="sidebar-link">Redux 请求中间件如何处理并发</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-状态管理器和变量挂载到-window-中有什么区别" class="sidebar-link">Redux 状态管理器和变量挂载到 window 中有什么区别</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#mobx-和-redux-有什么区别" class="sidebar-link">mobx 和 redux 有什么区别</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-和-vuex-有什么区别-它们的共同思想" class="sidebar-link">Redux 和 Vuex 有什么区别，它们的共同思想</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux-中间件是怎么拿到store-和-action-然后怎么处理" class="sidebar-link">Redux 中间件是怎么拿到store 和 action? 然后怎么处理?</a></li><li class="sidebar-sub-header"><a href="/pages/30f7b5/#redux中的connect有什么作用" class="sidebar-link">Redux中的connect有什么作用</a></li></ul></li><li><a href="/pages/6bcb1a/" class="sidebar-link">Hooks</a></li><li><a href="/pages/b06269/" class="sidebar-link">虚拟DOM</a></li><li><a href="/pages/b0c8ad/" class="sidebar-link">其他</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><span data-v-1cd794fe>React</span></li> <!----> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/duochizhacai" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Crucials</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-05-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          redux
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="对-redux-的理解-主要解决什么问题"><a href="#对-redux-的理解-主要解决什么问题" class="header-anchor">#</a> 对 <code>Redux</code> 的理解，主要解决什么问题</h2> <p><code>React</code> 是视图层框架。<code>Redux</code> 是一个用来管理数据状态和<code>UI</code>状态的<code>JavaScript</code>应用工具。随着<code>JavaScript</code>单页应用（<code>SPA</code>）开发日趋复杂， <code>JavaScript</code> 需要管理比任何时候都要多的<code>state</code>（状态）， <code>Redux</code>就是降低管理难度的.</p> <p>在 <code>React</code> 中，<code>UI</code> 以组件的形式来搭建，组件之间可以嵌套组合。但 <code>React</code> 中组件间通信的数据流是单向的，顶层组件可以通过 <code>props</code> 属性向下层组件传递数据，而下层组件不能向上层组件传递数据，兄弟组件之间同样不能。这样简单的单向数据流支撑起了 <code>React</code> 中的数据可控性。</p> <p>当项目越来越大的时候，管理数据的事件或回调函数将越来越多，也将越来越不好管理。管理不断变化的 <code>state</code> 非常困难。如果一个 <code>model</code> 的变化会引起另一个 <code>model</code> 变化，那么当 <code>view</code> 变化时，就可能引起对应 <code>model</code> 以及另一个 <code>model</code> 的变化，依次地，可能会引起另一个 <code>view</code> 的变化。直至你搞不清楚到底发生了什么。<code>state</code> 在什么时候，由于什么原因，如何变化已然不受控制。 当系统变得错综复杂的时候，想重现问题或者添加新功能就会变得举步维艰。如果这还不够糟糕，考虑一些来自前端开发领域的新需求，如更新调优、服务端渲染、路由跳转前请求数据等。<code>state</code> 的管理在大项目中相当复杂。</p> <p><code>Redux</code> 提供了一个叫 <code>store</code> 的统一仓储库，组件通过 <code>dispatch</code> 将 <code>state</code> 直接传入 <code>store</code>，不用通过其他的组件。并且组件通过 <code>subscribe</code> 从 <code>store</code> 获取到 <code>state</code> 的改变。使用了 <code>Redux</code> ，所有的组件都可以从 <code>store</code> 中获取到所需的 <code>state</code>，他们也能从 <code>store</code> 获取到 <code>state</code> 的改变。这比组件之间互相传递数据清晰明朗的多。</p> <p><strong>主要解决的问题：</strong> 单纯的 <code>Redux</code> 只是一个状态机，是没有<code>UI</code>呈现的，<code>react- redux</code>作用是将<code>Redux</code>的状态机和<code>React</code>的<code>UI</code>呈现绑定在一起，当你<code>dispatch action</code>改变<code>state</code>的时候，会自动更新页面。</p> <h2 id="redux-原理及工作流程"><a href="#redux-原理及工作流程" class="header-anchor">#</a> <code>Redux</code> 原理及工作流程</h2> <p><strong>原理</strong> <code>Redux</code>源码主要分为以下几个模块文件</p> <ul><li><code>compose.js</code> 提供从右到左进行函数式编程</li> <li><code>createStore.js</code> 提供作为生成唯一<code>store</code>的函数</li> <li><code>combineReducers.js</code> 提供合并多个 <code>reducer</code> 的函数，保证<code>store</code> 的唯一性</li> <li><code>bindActionCreators.js</code> 可以让开发者在不直接接触 <code>dispatch</code> 的前提下进行更改<code>state</code>的操作</li> <li><code>applyMiddleware.js</code> 这个方法通过中间件来增强<code>dispatch</code>的功能</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> actionTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">ADD</span><span class="token operator">:</span> <span class="token string">'ADD'</span><span class="token punctuation">,</span>
    <span class="token constant">CHANGEINFO</span><span class="token operator">:</span> <span class="token string">'CHANGEINFO'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initState <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">'初始化'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">initReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CHANGEINFO</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token operator">...</span>state<span class="token punctuation">,</span>
                info<span class="token operator">:</span> action<span class="token punctuation">.</span>preload<span class="token punctuation">.</span>info <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> middleFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialState <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> initialState <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        middleFunc <span class="token operator">=</span> initialState<span class="token punctuation">;</span>
        initialState <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> currentState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>

    <span class="token keyword">const</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>middleFunc <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> middleFunc <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 封装dispatch </span>
        <span class="token keyword">return</span> <span class="token function">middleFunc</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">getState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> currentState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        currentState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>

        listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">listener</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        getState<span class="token punctuation">,</span>
        dispatch<span class="token punctuation">,</span>
        subscribe
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p><strong>工作流程</strong></p> <ul><li><code>const store= createStore(fn)</code>生成数据;</li> <li><code>action: {type: Symble('action01), payload:'payload' }</code>定义行为;</li> <li><code>dispatch</code>发起<code>action：store.dispatch(doSomething('action001'))</code>;</li> <li><code>reducer</code>处理<code>action</code>，返回新的<code>state</code>;</li></ul> <p>通俗点解释：</p> <ul><li>首先，用户（通过<code>View</code>）发出<code>Action</code>，发出方式就用到了<code>dispatch</code>方法</li> <li>然后，<code>Store</code> 自动调用 <code>Reducer</code>，并且传入两个参数：当前<code>State</code>和收到的<code>Action</code>，<code>Reducer</code>会返回新的<code>State</code></li> <li><code>State</code>—旦有变化，<code>Store</code>就会调用监听函数，来更新<code>View</code></li></ul> <p>以 <code>store</code> 为核心，可以把它看成数据存储中心，但是他要更改数据的时候不能直接修改，数据修改更新的角色由<code>Reducers</code>来担任，<code>store</code>只做存储，中间人，当<code>Reducers</code>的更新完成以后会通过<code>store</code>的订阅来通知<code>react component</code>，组件把新的状态重新获取渲染，组件中也能主动发送<code>action</code>，创建<code>action</code>后这个动作是不会执行的，所以要<code>dispatch</code>这个<code>action</code>，让<code>store</code>通过<code>reducers</code>去做更新<code>React Component</code> 就是<code>react</code>的每个组件。</p> <h2 id="redux-中异步的请求怎么处理"><a href="#redux-中异步的请求怎么处理" class="header-anchor">#</a> <code>Redux</code> 中异步的请求怎么处理</h2> <p>可以在 <code>componentDidmount</code> 中直接进⾏请求⽆须借助<code>redux</code>。但是在⼀定规模的项⽬中,上述⽅法很难进⾏异步流的管理,通常情况下我们会借助<code>redux</code>的异步中间件进⾏异步处理。<code>redux</code>异步流中间件其实有很多，当下主流的异步中间件有两种<code>redux-thunk</code>、<code>redux-saga</code>。</p> <p><strong>1. 使用<code>react-thunk</code>中间件</strong></p> <p><strong><code>redux-thunk</code></strong> 优点:</p> <ul><li>体积⼩: <code>redux-thunk</code>的实现⽅式很简单</li> <li>使⽤简单: <code>redux-thunk</code>没有引⼊像<code>redux-saga</code>或者<code>redux-observable</code>额外的范式,上⼿简单</li></ul> <p><strong><code>redux-thunk</code></strong> 缺陷:</p> <ul><li>样板代码过多: 与<code>redux</code>本身⼀样,通常⼀个请求需要⼤量的代码,⽽且很多都是重复性质的</li> <li>耦合严重: 异步操作与<code>redux</code>的<code>action</code>偶合在⼀起,不⽅便管理</li> <li>功能孱弱: 有⼀些实际开发中常⽤的功能需要⾃⼰进⾏封装</li></ul> <p>使用步骤：</p> <ul><li>配置中间件，在<code>store</code>的创建中配置</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">,</span> compose<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>

<span class="token comment">// 设置调试工具</span>
<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ <span class="token operator">?</span> window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION_COMPOSE__</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> compose<span class="token punctuation">;</span>
<span class="token comment">// 设置中间件</span>
<span class="token keyword">const</span> enhancer <span class="token operator">=</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> enhancer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>添加一个返回函数的<code>actionCreator</code>，将异步请求逻辑放在里面</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
  发送get请求，并生成相应action，更新store的函数
  @param url {string} 请求地址
  @param func {function} 真正需要生成的action对应的actionCreator
  @return {function} 
*/</span>
<span class="token comment">// dispatch为自动接收的store.dispatch函数 </span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getHttpAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> func</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>生成<code>action</code>，并发送<code>action</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> action <span class="token operator">=</span> <span class="token function">getHttpAction</span><span class="token punctuation">(</span><span class="token string">'/getData'</span><span class="token punctuation">,</span> getInitTodoItemAction<span class="token punctuation">)</span>
    <span class="token comment">// 发送函数类型的action时，该action的函数体会自动执行</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>2. 使用<code>redux-saga</code>中间件</strong></p> <p><strong><code>redux-saga</code></strong> 优点:</p> <ul><li>异步解耦: 异步操作被被转移到单独 <code>saga.js</code> 中，不再是掺杂在 <code>action.js</code> 或 <code>component.js</code> 中</li> <li><code>action</code>摆脱<code>thunk function: dispatch</code> 的参数依然是⼀个纯粹的 <code>action (FSA)</code>，⽽不是充满 “⿊魔法” <code>thunk function</code></li> <li>异常处理: 受益于 <code>generator function</code> 的 <code>saga</code> 实现，代码异常/请求失败 都可以直接通过 <code>try/catch</code> 语法直接捕获处理</li> <li>功能强⼤: <code>redux-saga</code>提供了⼤量的<code>Saga</code> 辅助函数和<code>Effect</code> 创建器供开发者使⽤,开发者⽆须封装或者简单封装即可使⽤</li> <li>灵活: <code>redux-saga</code> 可以将多个<code>Saga</code>可以串⾏/并⾏组合起来,形成⼀个⾮常实⽤的异步<code>flow</code></li> <li>易测试，提供了各种<code>case</code>的测试⽅案，包括<code>mock task</code>，分⽀覆盖等等</li></ul> <p><strong><code>redux-saga</code></strong> 缺陷:</p> <ul><li>额外的学习成本: <code>redux-saga</code>不仅在使⽤难以理解的 <code>generator function</code>,⽽且有数⼗个<code>API</code>,学习成本远超<code>redux-thunk</code>,最重要的是你的额外学习成本是只服务于这个库的,与<code>redux-observable</code>不同,<code>redux-observable</code>虽然也有额外学习成本但是背后是<code>rxjs</code>和⼀整套思想</li> <li>体积庞⼤: 体积略⼤,代码近<code>2000</code>⾏，<code>min</code>版<code>25KB</code>左右</li> <li>功能过剩: 实际上并发控制等功能很难⽤到,但是我们依然需要引⼊这些代码</li> <li><code>ts</code>⽀持不友好: <code>yield</code>⽆法返回<code>TS</code>类型</li></ul> <p><code>redux-saga</code>可以捕获<code>action</code>，然后执行一个函数，那么可以把异步代码放在这个函数中，使用步骤如下：</p> <ul><li>配置中间件</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">,</span> compose<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createSagaMiddleware <span class="token keyword">from</span> <span class="token string">'redux-saga'</span>
<span class="token keyword">import</span> TodoListSaga <span class="token keyword">from</span> <span class="token string">'./sagas'</span>

<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ <span class="token operator">?</span> window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION_COMPOSE__</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> compose<span class="token punctuation">;</span>
<span class="token keyword">const</span> sagaMiddleware <span class="token operator">=</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> enhancer <span class="token operator">=</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>sagaMiddleware<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> enhancer<span class="token punctuation">)</span><span class="token punctuation">;</span>
sagaMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>TodoListSaga<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>将异步请求放在<code>sagas.js</code>中</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>takeEvery<span class="token punctuation">,</span> put<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-saga/effects'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>initTodoList<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actionCreator'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">GET_INIT_ITEM</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actionTypes'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token comment">// 可以获取异步返回数据</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getData'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">initTodoList</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token comment">// 将action发送到reducer</span>
    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'网络请求失败'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">mySaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 自动捕获GET_INIT_ITEM类型的action，并执行func</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token constant">GET_INIT_ITEM</span><span class="token punctuation">,</span> func<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> mySaga
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>发送<code>action</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">getInitTodoItemAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="redux-怎么实现属性传递-介绍下原理"><a href="#redux-怎么实现属性传递-介绍下原理" class="header-anchor">#</a> <code>Redux</code> 怎么实现属性传递，介绍下原理</h2> <p><code>react-redux</code> 数据传输∶ <code>view--&gt;action--&gt;reducer--&gt;store--&gt;view</code>。看下点击事件的数据是如何通过<code>redux</code>传到<code>view</code>上：</p> <ul><li><code>view</code> 上的<code>AddClick</code> 事件通过<code>mapDispatchToProps</code> 把数据传到<code>action</code> ---&gt; <code>click:()=&gt;dispatch(ADD)</code></li> <li><code>action</code> 的<code>ADD</code> 传到<code>reducer</code>上</li> <li><code>reducer</code>传到<code>store</code>上 <code>const store = createStore(reducer)</code>;</li> <li><code>store</code>再通过 <code>mapStateToProps</code> 映射穿到<code>view上text:State.text</code></li></ul> <p>代码示例∶</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> text<span class="token punctuation">,</span> click<span class="token punctuation">,</span> clickR <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>数据<span class="token operator">:</span>已有人<span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span>click<span class="token punctuation">}</span><span class="token operator">&gt;</span>加人<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span>clickR<span class="token punctuation">}</span><span class="token operator">&gt;</span>减人<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  text<span class="token operator">:</span><span class="token number">5</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>text<span class="token operator">:</span>state<span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'REMOVE'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>text<span class="token operator">:</span>state<span class="token punctuation">.</span>text<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token constant">ADD</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span><span class="token string">'ADD'</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> Remove <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span><span class="token string">'REMOVE'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    text<span class="token operator">:</span>state<span class="token punctuation">.</span>text
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    <span class="token function-variable function">click</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token constant">ADD</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">clickR</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span>Remove<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App1 <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span>mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store <span class="token operator">=</span> <span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>App1 <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h2 id="redux-中间件是什么-接受几个参数-柯里化函数两端的参数具体是什么"><a href="#redux-中间件是什么-接受几个参数-柯里化函数两端的参数具体是什么" class="header-anchor">#</a> <code>Redux</code> 中间件是什么？接受几个参数？柯里化函数两端的参数具体是什么？</h2> <p><code>Redux</code> 的中间件提供的是位于 <code>action</code> 被发起之后，到达 reducer 之前的扩展点，换而言之，原本 <code>view → action → reducer → store</code> 的数据流加上中间件后变成了 <code>view → action → middleware → reducer → store</code> ，在这一环节可以做一些&quot;副作用&quot;的操作，如异步请求、打印日志等。</p> <p><code>applyMiddleware</code> 源码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>middlewares</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token parameter">createStore</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 利用传入的createStore和reducer和创建一个store</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token keyword">let</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> middlewareAPI <span class="token operator">=</span> <span class="token punctuation">{</span>
      getState<span class="token operator">:</span> store<span class="token punctuation">.</span>getState<span class="token punctuation">,</span>
      <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 让每个 middleware 带着 middlewareAPI 这个参数分别执行一遍</span>
    <span class="token keyword">const</span> chain <span class="token operator">=</span> middlewares<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">middleware</span> <span class="token operator">=&gt;</span> <span class="token function">middleware</span><span class="token punctuation">(</span>middlewareAPI<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 接着 compose 将 chain 中的所有匿名函数，组装成一个新的函数，即新的 dispatch</span>
    dispatch <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token operator">...</span>chain<span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>store<span class="token punctuation">,</span>
      dispatch
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>从<code>applyMiddleware</code>中可以看出∶</p> <ul><li><code>redux</code>中间件接受一个对象作为参数，对象的参数上有两个字段 <code>dispatch</code> 和 <code>getState</code>，分别代表着 <code>Redux Store</code> 上的两个同名函数。</li> <li>柯里化函数两端一个是 <code>middewares</code>，一个是 <code>store.dispatch</code></li></ul> <h2 id="redux-请求中间件如何处理并发"><a href="#redux-请求中间件如何处理并发" class="header-anchor">#</a> <code>Redux</code> 请求中间件如何处理并发</h2> <p><strong>使用<code>redux-Saga</code></strong> ,一个管理<code>redux</code>应用异步操作的中间件，用于代替 <code>redux-thunk</code> 的。它通过创建 <code>Sagas</code> 将所有异步操作逻辑存放在一个地方进行集中处理，以此将<code>react</code>中的同步操作与异步操作区分开来，以便于后期的管理与维护。 <code>redux-saga</code>如何处理并发：</p> <ul><li><strong><code>takeEvery</code></strong></li></ul> <p>可以让多个 <code>saga</code> 任务并行被 <code>fork</code> 执行。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  fork<span class="token punctuation">,</span>
  take
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux-saga/effects&quot;</span>

<span class="token keyword">const</span> <span class="token function-variable function">takeEvery</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pattern<span class="token punctuation">,</span> saga<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>saga<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><strong><code>takeLatest</code></strong></li></ul> <p><code>takeLatest</code> 不允许多个 <code>saga</code> 任务并行地执行。一旦接收到新的发起的 <code>action</code>，它就会取消前面所有 <code>fork</code> 过的任务（如果这些任务还在执行的话）。 在处理 <code>AJAX</code> 请求的时候，如果只希望获取最后那个请求的响应， <code>takeLatest</code> 就会非常有用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  cancel<span class="token punctuation">,</span>
  fork<span class="token punctuation">,</span>
  take
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux-saga/effects&quot;</span>

<span class="token keyword">const</span> <span class="token function-variable function">takeLatest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pattern<span class="token punctuation">,</span> saga<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> lastTask
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>lastTask<span class="token punctuation">)</span> <span class="token comment">// 如果任务已经结束，则 cancel 为空操作</span>
    <span class="token punctuation">}</span>
    lastTask <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>saga<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="redux-状态管理器和变量挂载到-window-中有什么区别"><a href="#redux-状态管理器和变量挂载到-window-中有什么区别" class="header-anchor">#</a> <code>Redux</code> 状态管理器和变量挂载到 <code>window</code> 中有什么区别</h2> <p>两者都是存储数据以供后期使用。但是<code>Redux</code>状态更改可回溯——Time <code>travel</code>，数据多了的时候可以很清晰的知道改动在哪里发生，完整的提供了一套状态管理模式。</p> <p>随着 <code>JavaScript</code> 单页应用开发日趋复杂，<code>JavaScript</code> 需要管理比任何时候都要多的 <code>state</code>（状态）。 这些 <code>state</code> 可能包括服务器响应、缓存数据、本地生成尚未持久化到服务器的数据，也包括 <code>UI</code> 状态，如激活的路由，被选中的标签，是否显示加载动效或者分页器等等。</p> <p>管理不断变化的 <code>state</code> 非常困难。如果一个 <code>model</code> 的变化会引起另一个 <code>model</code> 变化，那么当 <code>view</code> 变化时，就可能引起对应 <code>model</code> 以及另一个<code>model</code> 的变化，依次地，可能会引起另一个 <code>view</code> 的变化。直至你搞不清楚到底发生了什么。</p> <p><code>state</code> 在什么时候，由于什么原因，如何变化已然不受控制。 当系统变得错综复杂的时候，想重现问题或者添加新功能就会变得举步维艰。 如果这还不够糟糕，考虑一些来自前端开发领域的新需求，如更新调优、服务端渲染、路由跳转前请求数据等等。前端开发者正在经受前所未有的复杂性，难道就这么放弃了吗?当然不是。</p> <p>这里的复杂性很大程度上来自于：我们总是将两个难以理清的概念混淆在一起：变化和异步。 可以称它们为曼妥思和可乐。如果把二者分开，能做的很好，但混到一起，就变得一团糟。一些库如 <code>React</code> 视图在视图层禁止异步和直接操作 <code>DOM</code> 来解决这个问题。美中不足的是，<code>React</code> 依旧把处理 <code>state</code> 中数据的问题留给了你。<code>Redux</code>就是为了帮你解决这个问题。</p> <h2 id="mobx-和-redux-有什么区别"><a href="#mobx-和-redux-有什么区别" class="header-anchor">#</a> <code>mobx</code> 和 <code>redux</code> 有什么区别</h2> <p><strong>共同点</strong></p> <ul><li>为了解决状态管理混乱，无法有效同步的问题统一维护管理应用状态;</li> <li>某一状态只有一个可信数据来源（通常命名为<code>store</code>，指状态容器）;</li> <li>操作更新状态方式统一，并且可控（通常以<code>action</code>方式提供更新状态的途径）;</li> <li>支持将<code>store</code>与<code>React</code>组件连接，如<code>react-redux</code>，<code>mobx- react</code>;</li></ul> <p><strong>区别:</strong><code>Redux</code>更多的是遵循<code>Flux</code>模式的一种实现，是一个 <code>JavaScript</code>库，它关注点主要是以下几方面∶</p> <ul><li><p><code>Action</code>∶ 一个<code>JavaScript</code>对象，描述动作相关信息，主要包含<code>type</code>属性和<code>payload</code>属性∶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>o type∶ action 类型; o payload∶ 负载数据;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>Reducer</code>∶ 定义应用状态如何响应不同动作（<code>action</code>），如何更新状态;</p></li> <li><p><code>Store</code>∶ 管理<code>action</code>和<code>reducer</code>及其关系的对象，主要提供以下功能∶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>o 维护应用状态并支持访问状态(getState());
o 支持监听action的分发，更新状态(dispatch(action)); 
o 支持订阅store的变更(subscribe(listener));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>异步流∶ 由于<code>Redux</code>所有对<code>store</code>状态的变更，都应该通过<code>action</code>触发，异步任务（通常都是业务或获取数据任务）也不例外，而为了不将业务或数据相关的任务混入<code>React</code>组件中，就需要使用其他框架配合管理异步任务流程，如<code>redux-thunk</code>，<code>redux-saga</code>等;</p></li></ul> <p><code>Mobx</code>是一个透明函数响应式编程的状态管理库，它使得状态管理简单可伸缩∶</p> <ul><li><code>Action</code>∶定义改变状态的动作函数，包括如何变更状态;</li> <li><code>Store</code>∶ 集中管理模块状态（<code>State</code>）和动作(<code>action</code>)</li> <li><code>Derivation</code>（衍生）∶ 从应用状态中派生而出，且没有任何其他影响的数据</li></ul> <p><strong>对比总结：</strong></p> <ul><li><code>redux</code>将数据保存在单一的<code>store</code>中，<code>mobx</code>将数据保存在分散的多个<code>store</code>中</li> <li><code>redux</code>使用<code>plain object</code>保存数据，需要手动处理变化后的操作;<code>mobx</code>适用<code>observable</code>保存数据，数据变化后自动处理响应的操作</li> <li><code>redux</code>使用不可变状态，这意味着状态是只读的，不能直接去修改它，而是应该返回一个新的状态，同时使用纯函数;<code>mobx</code>中的状态是可变的，可以直接对其进行修改</li> <li><code>mobx</code>相对来说比较简单，在其中有很多的抽象，<code>mobx</code>更多的使用面向对象的编程思维;<code>redux</code>会比较复杂，因为其中的函数式编程思想掌握起来不是那么容易，同时需要借助一系列的中间件来处理异步和副作用</li> <li><code>mobx</code>中有更多的抽象和封装，调试会比较困难，同时结果也难以预测;而<code>redux</code>提供能够进行时间回溯的开发工具，同时其纯函数以及更少的抽象，让调试变得更加的容易</li></ul> <h2 id="redux-和-vuex-有什么区别-它们的共同思想"><a href="#redux-和-vuex-有什么区别-它们的共同思想" class="header-anchor">#</a> <code>Redux</code> 和 <code>Vuex</code> 有什么区别，它们的共同思想</h2> <p><strong><code>Redux</code> 和 <code>Vuex</code>区别</strong></p> <ul><li><code>Vuex</code>改进了<code>Redux</code>中的<code>Action</code>和<code>Reducer</code>函数，以<code>mutations</code>变化函数取代<code>Reducer</code>，无需<code>switch</code>，只需在对应的<code>mutation</code>函数里改变<code>state</code>值即可</li> <li><code>Vuex</code>由于<code>Vue</code>自动重新渲染的特性，无需订阅重新渲染函数，只要生成新的<code>State</code>即可</li> <li><code>Vuex</code>数据流的顺序是∶<code>View</code>调用<code>store.commit</code>提交对应的请求到<code>Store</code>中对应的<code>mutation</code>函数→<code>store</code>改变（<code>vue</code>检测到数据变化自动渲染）</li></ul> <p>通俗点理解就是，<code>vuex</code> 弱化 <code>dispatch</code>，通过<code>commit</code>进行 <code>store</code>状态的一次更变；取消了<code>action</code>概念，不必传入特定的 <code>action</code>形式进行指定变更；弱化<code>reducer</code>，基于<code>commit</code>参数直接对数据进行转变，使得框架更加简易;</p> <p><strong>共同思想</strong></p> <ul><li>单—的数据源</li> <li>变化可以预测</li></ul> <p>本质上∶ <code>redux</code>与<code>vuex</code>都是对<code>mvvm</code>思想的服务，将数据从视图中抽离的一种方案。</p> <h2 id="redux-中间件是怎么拿到store-和-action-然后怎么处理"><a href="#redux-中间件是怎么拿到store-和-action-然后怎么处理" class="header-anchor">#</a> <code>Redux</code> 中间件是怎么拿到<code>store</code> 和 <code>action</code>? 然后怎么处理?</h2> <p><code>redux</code>中间件本质就是一个函数柯里化。</p> <p><code>redux applyMiddleware API</code> 源码中每个<code>middleware</code> 接受<code>2</code>个参数， <code>Store</code> 的<code>getState</code> 函数和<code>dispatch</code> 函数，分别获得<code>store</code>和<code>action</code>，最终返回一个函数。该函数会被传入 <code>next</code> 的下一个 <code>middleware</code> 的 <code>dispatch</code> 方法，并返回一个接收 <code>action</code> 的新函数，这个函数可以直接调用 <code>next（action）</code>，或者在其他需要的时刻调用，甚至根本不去调用它。</p> <p>调用链中最后一个 <code>middleware</code> 会接受真实的 <code>store</code>的 <code>dispatch</code> 方法作为 <code>next</code> 参数，并借此结束调用链。所以，<code>middleware</code> 的函数签名是<code>({ getState，dispatch })=&gt; next =&gt; action</code>。</p> <h2 id="redux中的connect有什么作用"><a href="#redux中的connect有什么作用" class="header-anchor">#</a> <code>Redux</code>中的<code>connect</code>有什么作用</h2> <p><code>connect</code>负责连接<code>React</code>和<code>Redux</code></p> <p><strong>1. 获取<code>state</code></strong></p> <p><code>connect</code> 通过 <code>context</code> 获取 <code>Provider</code> 中的 <code>store</code>，通过<code>store.getState()</code> 获取整个<code>store tree</code> 上所有<code>state</code></p> <p><strong>2. 包装原组件</strong></p> <p>将<code>state</code>和<code>action</code>通过<code>props</code>的方式传入到原组件内部 <code>wrapWithConnect</code> 返回—个 <code>ReactComponent</code> 对 象 <code>Connect</code>，<code>Connect</code> 重新 <code>render</code> 外部传入的原组件 <code>WrappedComponent</code> ，并把 <code>connect</code> 中传入的 <code>mapStateToProps</code>，<code>mapDispatchToProps</code>与组件上原有的 <code>props</code> 合并后，通过属性的方式传给<code>WrappedComponent</code></p> <p><strong>3. 监听<code>store tree</code>变化</strong></p> <p><code>connect</code>缓存了<code>store tree</code>中<code>state</code>的状态，通过当前<code>state</code>状态 和变更前 <code>state</code> 状态进行比较，从而确定是否调用 <code>this.setState()</code>方法触发 <code>Connect</code> 及其子组件的重新渲染</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/02, 12:25:10</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/000594/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">路由</div></a> <a href="/pages/6bcb1a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Hooks</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/000594/" class="prev">路由</a></span> <span class="next"><a href="/pages/6bcb1a/">Hooks</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/duochizhacai" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://juejin.cn/user/1249486902410744" title="JueJin" target="_blank" class="iconfont icon-juejin"></a></div> 
    Copyright © 2021-2022
    <span><a href='https://beian.miit.gov.cn'>粤ICP备2021165371号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95fc12d6.js" defer></script><script src="/assets/js/2.abf57e2f.js" defer></script><script src="/assets/js/48.8d4e8a09.js" defer></script>
  </body>
</html>
