---
title: DNS和网络模型
date: 2021-12-12 18:09:39
permalink: /pages/f051f8/
---

# `DNS`协议

## 介绍一下`DNS`协议是什么

`DNS`是**域名系统**的缩写，提供一种主机名到`IP`地址的转换服务，由分层的`DNS`服务器组成的分布式数据库，定义了主机如何查询这个分布式数据库的方式的应用协议

作用是将域名解析为`IP`地址，客户端向`DNS`服务器发送域名查询请求，`DNS`服务器告诉客户端他的`web`服务器的`IP`地址



## `DNS`同时使用`TCP`和`UDP`协议吗<badge text="重要" type="warning" />

`DNS`占用`53`号端口，同时使用`TCP`和`UDP`协议

1. 在**区域传输**的时候使用`TCP`协议
   - 辅域名服务器会定时（一般三小时）向主域名查询了解数据是否有变，有变的话，会执行一次区域传送，进行数据同步，区域传送使用`TCP`，因为数据传送的数据量比一个请求应答的数据量多得多
   - `TCP`是一种可靠连接 保证数据的准确性
1. 在**域名解析**的时候使用`UDP`协议
   - 客户端向`DNS`查询域名，一般返回的内容不超过`512`字节，用`UDP`传输即可，不经过三次握手，使得`DNS`服务器负载更低，响应更快，理论上客户端向`DNS`服务器查询域名的时候用`TCP`但是很多`DNS`服务器配置时候只支持`UDP`查询包

## 说一下`DNS`完整查询过程<badge text="重要" type="warning" />

![](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081154673.png)

- 首先在浏览器缓存中查找对应的`IP`	地址，如果查到就直接返回，查不到就下一步
- 将请求发给本地`dns`服务器，在本地域名服务器查询，如果查到直接返回，差不到就下一步

- 本地`dns`服务器向根域名服务器发送请求，根域名服务器返回一个所查询域的顶级服务器地址
- 本地`dns`向顶级域名服务器发送请求，接收请求的服务器查询自己的缓存，如果有记录就返回查询结果，没有就返回下一级的权威域名服务器地址

- 本地`dns`向权威域名服务器请求，域名服务器返回对应结果
- 本地`dns`将结果保存在缓存中，便于下次使用

- 将结果返回给浏览器

## `DNS`的迭代查询和递归查询

递归查询指的是查询请求发送之后，域名服务器代为向下一级域名服务器发送请求，最后向用户返回结果，使用递归查询，用户只用发送一次查询

迭代查询是域名服务器返回单次查询的结果，需要用户自己请求下一级的服务器



一般我们向本地`dns`发送请求的都是递归查询，因为只发了一次就能返回最终的结果，而本地`dns`服务器向其他域名服务器采用的就是迭代查询，每一级域名服务器返回的结果之后，都由本地`dns`服务器自己进行下一级的查询



# 网络模型

## `OSI`7层模型

![img](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202112122148011.webp)

1. **应用层**
   - 为计算机用户提供应用接口，为用户提供提供网络服务协议，如`http` `https` `ftp`等
1. **表示层**
   - 用于对应用层数据的编码和转换功能，确保一个系统的应用程序发送的数据能被另一个系统应用层识别，可以使用`base64`对数据进行编解码，`base64`在表示层工作
1. **会话层**
   - 负责建立、管理和终止表示层实体之间的通信会话
1. **传输层**
   - 建立主机端到端的连接，传输层的作用就是为上层协议提供端到端的可靠和透明数据传输，包括差错控制和流量控制，`tcp`和`udp`就是在这一层
1. **网络层**
   - 通过`IP`寻址建立两个节点的连接，通常就是我们说的`IP`协议层，我们可以理解网络层规定了数据包的传输路线，传输层规定了数据包的传输方式
1. **数据链路层**
   - 将比特组合成字节，将字节组合成帧，使用链路层地址(以太网用`mac`地址)，并进行差错控制，我们可以理解为网络层是规划了数据包的传输路线，数据链路层就是传输路线，在数据链路层增加了差错控制
1. **物理层**
   - 实际的信号通过物理层实现，通过物理截止传输比特流



`OSI`七层模型通信特点是对等通信，为了使数据分组从源传送到目的地，源端每一层都必须和目的端对等层进行通信，称为对等层通信，在每一层通信都使用本层自己的协议进行通信

## `TCP/IP`五层协议

![img](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202112122148362.webp)

- 应用层
  - 直接为应用进程提供服务 `http/ftp/smtp/dns`
- 传输层
  - 主要有`tcp`和`udp`协议
- 网络层
  - 为两台主机提供通信服务 通过选择合适的路由将数据传递到目的主机
- 数据链路层
  - 将网络层交下来的`IP`数据包封装成帧，在链路两个相邻节点传送帧，每一帧都包含数据和必要的控制信息
- 物理层
  - 确保数据在各种物理媒介上传输

![img](https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202112122149313.webp)

