<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>情景题 | 小宋爱睡觉</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="🚀一个前端程序员小白的博客🌹">
    <meta name="keywords" content="blog,crucials,frontend,前端,小宋爱睡觉,博客,duochizhacai">
    <meta name="theme-color" content="#60ad81">
    
    <link rel="preload" href="/assets/css/0.styles.65787d8c.css" as="style"><link rel="preload" href="/assets/js/app.95fc12d6.js" as="script"><link rel="preload" href="/assets/js/2.abf57e2f.js" as="script"><link rel="preload" href="/assets/js/14.4e5bcc62.js" as="script"><link rel="preload" href="/assets/js/3.e687237e.js" as="script"><link rel="prefetch" href="/assets/js/10.9d6bb65c.js"><link rel="prefetch" href="/assets/js/11.bea1ca2d.js"><link rel="prefetch" href="/assets/js/12.a5ced6a2.js"><link rel="prefetch" href="/assets/js/13.ec1bcac6.js"><link rel="prefetch" href="/assets/js/15.753bb2dc.js"><link rel="prefetch" href="/assets/js/16.a6e51bcc.js"><link rel="prefetch" href="/assets/js/17.25227dca.js"><link rel="prefetch" href="/assets/js/18.19267273.js"><link rel="prefetch" href="/assets/js/19.a9403a12.js"><link rel="prefetch" href="/assets/js/20.c007e659.js"><link rel="prefetch" href="/assets/js/21.dca7af69.js"><link rel="prefetch" href="/assets/js/22.d9f25771.js"><link rel="prefetch" href="/assets/js/23.2668c7ed.js"><link rel="prefetch" href="/assets/js/24.30c858a4.js"><link rel="prefetch" href="/assets/js/25.bd21abb1.js"><link rel="prefetch" href="/assets/js/26.28d250cb.js"><link rel="prefetch" href="/assets/js/27.a60d212f.js"><link rel="prefetch" href="/assets/js/28.8a5c2c34.js"><link rel="prefetch" href="/assets/js/29.4688a5d6.js"><link rel="prefetch" href="/assets/js/30.5985f3b4.js"><link rel="prefetch" href="/assets/js/31.7ee5d916.js"><link rel="prefetch" href="/assets/js/32.2f711dea.js"><link rel="prefetch" href="/assets/js/33.45a4e58a.js"><link rel="prefetch" href="/assets/js/34.6a46cad8.js"><link rel="prefetch" href="/assets/js/35.79084a19.js"><link rel="prefetch" href="/assets/js/36.9a5cf509.js"><link rel="prefetch" href="/assets/js/37.ea6b36a3.js"><link rel="prefetch" href="/assets/js/38.1ebed809.js"><link rel="prefetch" href="/assets/js/39.16200e67.js"><link rel="prefetch" href="/assets/js/4.4a0efd85.js"><link rel="prefetch" href="/assets/js/40.db1f5064.js"><link rel="prefetch" href="/assets/js/41.5c8205b4.js"><link rel="prefetch" href="/assets/js/42.d8e671a9.js"><link rel="prefetch" href="/assets/js/43.80c6d459.js"><link rel="prefetch" href="/assets/js/44.0dc33dbe.js"><link rel="prefetch" href="/assets/js/45.e623e04e.js"><link rel="prefetch" href="/assets/js/46.b9a46fc2.js"><link rel="prefetch" href="/assets/js/47.2d5eb349.js"><link rel="prefetch" href="/assets/js/48.8d4e8a09.js"><link rel="prefetch" href="/assets/js/49.f7f58461.js"><link rel="prefetch" href="/assets/js/5.84799806.js"><link rel="prefetch" href="/assets/js/50.b482896d.js"><link rel="prefetch" href="/assets/js/51.9ad2b264.js"><link rel="prefetch" href="/assets/js/52.7862671c.js"><link rel="prefetch" href="/assets/js/53.d8153804.js"><link rel="prefetch" href="/assets/js/54.0af2674d.js"><link rel="prefetch" href="/assets/js/55.597b91b8.js"><link rel="prefetch" href="/assets/js/56.46804158.js"><link rel="prefetch" href="/assets/js/57.006f6db0.js"><link rel="prefetch" href="/assets/js/58.751e40d0.js"><link rel="prefetch" href="/assets/js/59.b0ebe0e6.js"><link rel="prefetch" href="/assets/js/6.f7ec0152.js"><link rel="prefetch" href="/assets/js/60.8d675b12.js"><link rel="prefetch" href="/assets/js/61.55190a7f.js"><link rel="prefetch" href="/assets/js/62.117f5f66.js"><link rel="prefetch" href="/assets/js/63.b848bfe2.js"><link rel="prefetch" href="/assets/js/64.000227a3.js"><link rel="prefetch" href="/assets/js/65.9ec404e1.js"><link rel="prefetch" href="/assets/js/66.1834b2b1.js"><link rel="prefetch" href="/assets/js/67.bf716de8.js"><link rel="prefetch" href="/assets/js/68.6e03054c.js"><link rel="prefetch" href="/assets/js/69.c6605c56.js"><link rel="prefetch" href="/assets/js/7.40c08f02.js"><link rel="prefetch" href="/assets/js/70.30051d78.js"><link rel="prefetch" href="/assets/js/71.1fdc7d36.js"><link rel="prefetch" href="/assets/js/72.4b0ad4ad.js"><link rel="prefetch" href="/assets/js/73.e989ab6d.js"><link rel="prefetch" href="/assets/js/74.02429c23.js"><link rel="prefetch" href="/assets/js/75.8f044cef.js"><link rel="prefetch" href="/assets/js/76.7acc2de5.js"><link rel="prefetch" href="/assets/js/77.ce127400.js"><link rel="prefetch" href="/assets/js/78.deb1ae24.js"><link rel="prefetch" href="/assets/js/79.75a4c78b.js"><link rel="prefetch" href="/assets/js/8.303c64d8.js"><link rel="prefetch" href="/assets/js/80.6c258060.js"><link rel="prefetch" href="/assets/js/81.563a0c28.js"><link rel="prefetch" href="/assets/js/82.143b4caf.js"><link rel="prefetch" href="/assets/js/83.32431b7f.js"><link rel="prefetch" href="/assets/js/84.2320a5a5.js"><link rel="prefetch" href="/assets/js/85.d9a1625a.js"><link rel="prefetch" href="/assets/js/86.dc0f47f2.js"><link rel="prefetch" href="/assets/js/87.8335157f.js"><link rel="prefetch" href="/assets/js/88.2cfc7001.js"><link rel="prefetch" href="/assets/js/89.6bc590c2.js"><link rel="prefetch" href="/assets/js/9.7ba1b2de.js"><link rel="prefetch" href="/assets/js/90.c20801a7.js"><link rel="prefetch" href="/assets/js/91.1a32fafc.js"><link rel="prefetch" href="/assets/js/92.4a802465.js">
    <link rel="stylesheet" href="/assets/css/0.styles.65787d8c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/logo.png" alt="小宋爱睡觉" class="logo"> <span class="site-name can-hide">小宋爱睡觉</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><a href="/pages/56881f/" class="link-title">知识库</a> <span class="title" style="display:none;">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/56881f/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/c0e7f0/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/787250/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/f0a671/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/b7238f/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/2448f7/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/b8bd46/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/pages/f15087/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/pages/e3cba5/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/pages/ba01c4/" class="nav-link">手写系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/pages/ad5191/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ac126/" class="nav-link">字符串</a></li><li class="dropdown-item"><!----> <a href="/pages/251490/" class="nav-link">数组</a></li><li class="dropdown-item"><!----> <a href="/pages/fc9745/" class="nav-link">链表</a></li><li class="dropdown-item"><!----> <a href="/pages/ad5191/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/6aee18/" class="nav-link">动态规划</a></li><li class="dropdown-item"><!----> <a href="/pages/78e948/" class="nav-link">排序算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><a href="/pages/1ae607/https://github.com/duochizhacai" class="link-title">GitHub</a> <span class="title" style="display:none;">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duochizhacai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1249486902410744" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JueJin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><a href="/pages/56881f/" class="link-title">知识库</a> <span class="title" style="display:none;">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/56881f/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/c0e7f0/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/787250/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/f0a671/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/b7238f/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/2448f7/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/b8bd46/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/pages/f15087/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/pages/e3cba5/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/pages/ba01c4/" class="nav-link">手写系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/pages/ad5191/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ac126/" class="nav-link">字符串</a></li><li class="dropdown-item"><!----> <a href="/pages/251490/" class="nav-link">数组</a></li><li class="dropdown-item"><!----> <a href="/pages/fc9745/" class="nav-link">链表</a></li><li class="dropdown-item"><!----> <a href="/pages/ad5191/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/6aee18/" class="nav-link">动态规划</a></li><li class="dropdown-item"><!----> <a href="/pages/78e948/" class="nav-link">排序算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><a href="/pages/1ae607/https://github.com/duochizhacai" class="link-title">GitHub</a> <span class="title" style="display:none;">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duochizhacai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1249486902410744" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JueJin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/787250/" class="sidebar-link">数据类型</a></li><li><a href="/pages/9d5b13/" class="sidebar-link">ES6</a></li><li><a href="/pages/f1d00d/" class="sidebar-link">JS基础</a></li><li><a href="/pages/4a6f6a/" class="sidebar-link">执行上下文/ 闭包/ 作用域链</a></li><li><a href="/pages/e98c4e/" class="sidebar-link">原型和原型链</a></li><li><a href="/pages/1ae607/" aria-current="page" class="active sidebar-link">情景题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1ae607/#当在浏览器输入google-com回车之后会发生什么" class="sidebar-link">当在浏览器输入google.com回车之后会发生什么</a></li><li class="sidebar-sub-header"><a href="/pages/1ae607/#扫码登陆流程" class="sidebar-link">扫码登陆流程</a></li><li class="sidebar-sub-header"><a href="/pages/1ae607/#为什么通常在发送数据埋点请求的时候使用的是-1x1-像素的透明-gif-图片" class="sidebar-link">为什么通常在发送数据埋点请求的时候使用的是 1x1 像素的透明 gif 图片</a></li><li class="sidebar-sub-header"><a href="/pages/1ae607/#简单描述一下-babel-的编译过程" class="sidebar-link">简单描述一下 Babel 的编译过程</a></li><li class="sidebar-sub-header"><a href="/pages/1ae607/#列举一下有哪些捕获-监控错误的方式" class="sidebar-link">列举一下有哪些捕获/监控错误的方式</a></li><li class="sidebar-sub-header"><a href="/pages/1ae607/#前端容灾是什么-该怎么解决" class="sidebar-link">前端容灾是什么 该怎么解决</a></li><li class="sidebar-sub-header"><a href="/pages/1ae607/#前端工程化的理解" class="sidebar-link">前端工程化的理解</a></li></ul></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><span data-v-1cd794fe>JavaScript</span></li> <!----> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/duochizhacai" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Crucials</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-02-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          情景题
        </h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="情景题"><a href="#情景题" class="header-anchor">#</a> 情景题</h1> <h2 id="当在浏览器输入google-com回车之后会发生什么"><a href="#当在浏览器输入google-com回车之后会发生什么" class="header-anchor">#</a> 当在浏览器输入<code>google.com</code>回车之后会发生什么<span class="badge error" style="vertical-align:top;" data-v-d5affa18>本博客最重要的一个问题</span></h2> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081153220.png" alt=""></p> <ol><li><p>在回车之前，会执行一次当前页面的<code>beforeunload</code>事件，可以让页面退出之前执行一些数据清理工作，或者，有表单没有提交的情况提示用户是否确认离开</p></li> <li><p><strong>缓存判断</strong> 判断资源是否存在缓存中，若在缓存且没有失效，就直接使用，否则向服务器发起新请求</p> <div class="custom-block note"><p class="custom-block-title">这里的缓存主要指的是</p> <ul><li>如果是<code>https</code>的话，有可能先找<code>Service Worker</code>，比如你设置了请求拦截，离线缓存的话</li> <li>如果没有，再找浏览器的<strong>内存缓存</strong>（<code>Memory Cache</code>)</li> <li>如果还没有，再找<strong>硬盘缓存</strong>（<code>Disk Cache</code>）（ 强缓存和协商缓存都属于硬盘缓存）</li> <li>如果这三种都没有找到，请求还是<code>http2</code>的话，还可能会查找<strong>推送缓存</strong>（<code>Push Cache</code>)，就是找<code>Session</code>（<code>Session</code>会话结束就会释放，所以存在时间很短）</li></ul></div></li> <li><p><strong>解析<code>URL</code></strong> 对<code>URL</code>进行解析，分析所用的<strong>传输协议</strong> <strong>域名</strong> <strong>端口</strong> <strong>资源路径</strong>，如果不合法，就传递给<strong>搜索引擎</strong>，如果没问题，浏览器检查<code>URL</code>是否出现非法字符，若有则进行转义</p></li> <li><p><strong><code>DNS</code>解析</strong></p> <ul><li>首先在浏览器缓存中查找对应的<code>IP</code> 地址，如果查到就直接返回，查不到就下一步</li> <li>将请求发给本地<code>dns</code>服务器，在本地域名服务器查询，如果查到直接返回，差不到就下一步</li> <li>本地<code>dns</code>服务器向根域名服务器发送请求，根域名服务器返回一个所查询域的顶级服务器地址</li> <li>本地<code>dns</code>向顶级域名服务器发送请求，接收请求的服务器查询自己的缓存，如果有记录就返回查询结果，没有就返回下一级的权威域名服务器地址</li> <li>本地<code>dns</code>向权威域名服务器请求，域名服务器返回对应结果</li> <li>本地<code>dns</code>将结果保存在缓存中，便于下次使用</li> <li>将结果返回给浏览器</li></ul></li></ol> <ul><li>(用户向本地<code>dns</code>服务器发起请求是递归请求，本地<code>dns</code>向各级域名服务器发起的请求是迭代请求)</li></ul> <div class="custom-block note"><p class="custom-block-title">服务器作用笔记</p> <ul><li>根域名服务器：离用户较近，当所要查询的主机也属于同一个本地<code>ISP</code>时，该本地域名服务器立即就能将所查询的主机名转换为它的<code>IP</code>地址，而不需要再去询问其他的域名服务器。</li> <li>根域名服务器：最高层次、最重要的服务器，所有的根域名服务器都知道所有的顶级域名服务器的域名和<code>IP</code>地址。不管是哪一个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析，就首先求助于根域名服务器</li> <li>顶级域名服务器: 负责管理在该顶级域名服务器注册的所有二级域名。当收到<code>DNS</code>查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当找的域名服务器的<code>IP</code>地址）。</li> <li>权限域名服务器是负责一个区的域名服务器，用来保存该区中的所有主机的域名到<code>IP</code>地址的映射。当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的<code>DNS</code>客户，下一步应当找哪一个权限域名服务器。</li></ul></div> <div class="custom-block warning"><p class="custom-block-title">值得注意的是</p> <ul><li>如果没有配置<code>CDN</code>，就直接返回解析到的<code>IP</code></li> <li>如果有配置<code>CDN</code>，权威域名会返回一个<a href="/pages/f15087/#cdn工作原理">CName</a>别名记录，它指向<code>CDN</code>网络中的智能<code>DNS</code>负载均衡系统，然后负载均衡系统通过智能算法，将最佳<code>CDN</code>节点的<code>IP</code>返回</li></ul></div> <ol start="5"><li><p><strong>获取<code>MAC</code>地址</strong> 当浏览器得到<code>ip</code>地址时，数据传输还得知道<code>mac</code>地址，数据是从<strong>应用层</strong>下发到<strong>传输层</strong>，<code>tcp</code>会指定<strong>源端口号</strong>和<strong>目的端口号</strong>，然后下发给网络层，网络层将本地<code>ip</code>作为源地址，获取的<code>ip</code>作为目的<code>ip</code>，然后下发给数据链路层，数据链路层要加入通信双方的<code>mac</code>地址，本地<code>mac</code>作为源<code>mac</code>地址，目的<code>mac</code>地址分情况处理，通过<code>ip</code>地址与本地子网掩码相与，判断是否和请求主机处于同一个子网，如果在同一子网，用<code>ARP</code>协议获得目的主机的<code>mac</code>地址，如果不在，请求转发给网关，由他来转发，此时同样可以通过<code>arp</code>协议获得网关的<code>mac</code>地址，此时目的主机的<code>mac</code>地址为网关的地址</p></li> <li><p><strong><code>TCP</code>三次握手</strong> 下面是 <code>TCP</code> 建立连接的三次握手的过程。</p></li></ol> <ul><li>首先客户端向服务器发送一个 <code>SYN</code>连接请求报文段和一个随机序号，进入<code>SYN-SENT</code>状态</li> <li>服务端接收到请求后向客户端发送一个 <code>SYN ACK</code>报文段，确认连接请求，并且也向客户端发送一个随机序号,进入<code>LISTEN</code>状态</li> <li>客户端接收服务器的确认应答后，进入连接建立的状态，同时向服务器也发送一个<code>ACK</code>确认报文段,进入<code>ESTABLISH</code>状态</li> <li>服务器端接收到确认后，也进入连接建立状态，此时双方的连接就建立起来了,也进入<code>ESTABLISH</code>状态
<ul><li><strong>两次握手不行的简单原因</strong>：服务器就没有办法知道自己的序号是否 已被确认，防止失效的连接请求报文段突然又传送到主机<code>B</code>。</li></ul></li></ul> <ol start="7"><li><strong><code>HTTPS</code>握手</strong> 通信还存在<code>TLS</code>的四次挥手</li></ol> <ul><li><p>首先客户端向服务端发送<strong>协议的版本号</strong>、<strong>一个随机数</strong>和可以使用的<strong>加密方法</strong></p></li> <li><p>服务器收到后确认加密方法，向客户端发送一个<strong>随机数</strong>和<strong>自己的数字证书</strong></p></li> <li><p>客户端收到后检查数字证书是否有效，有效的话再生成一个<strong>随机数</strong>，使用证书的公钥对<strong>随机数加密</strong> 然后发给服务端，并且会提供一个<strong>前面所有内容的<code>hash</code>值给服务器检验</strong></p></li> <li><p>服务器接收后用私钥对<strong>数据解密</strong>，同时<strong>向客户端发送一个前面所有内容的<code>hash</code>值供客户端检验</strong>，双方这时有三个随机数，按之前的加密方法，使用<strong>这三个随机数生成一把密钥</strong>，以后双方传输数据时用这个密钥加密再传输</p></li></ul> <ol start="8"><li><p><strong>返回数据</strong> 当页面请求发到服务端，服务端会返回一个<code>html</code>文件作为响应，浏览器接到响应 对<code>html</code>进行解析，开始页面渲染</p></li> <li><p><strong><code>TCP</code>四次挥手</strong> 最后一步是<code>TCP</code> 断开连接的四次挥手过程。</p></li></ol> <ul><li>若客户端认为数据发送完成，则它需要向服务端发送连接释放请求，进入<code>FIN_WAIT1</code> 状态。</li> <li>服务端收到连接释放请求后，会告诉应用层要释放<code>TCP</code> 链接。然后会发送 <code>ACK</code> 包，并进入 <code>CLOSE_WAIT</code> 状态，此时表明客户端到服务端的连接已经释放，不再接收客户端发的数据了。<strong>但是因为 <code>TCP</code>连接是双向的，所以服务端仍旧可以发送数据给客户端，</strong> 此时服务端处于<code>CLOSE_WAIT</code>,客户端收到确认报文后处于<code>FIN_WAIT2</code>状态</li> <li>服务端如果此时还有没发完的数据会继续发送，完毕后会向客户端发送连接释放请求，然后服务端便进入 <code>LAST-ACK</code> 状态</li> <li>客户端收到释放请求后，向服务端发送确认应答，此时客户端进入 <code>TIME-WAIT</code>状态。该状态会持续 <code>2MSL</code>（<mark>最大段生存期，指报文段在网络中生存的时间，超时会被抛弃</mark>） 时间，若该时间段内没有服务端的重发请求的话，就进入<code>CLOSED</code> 状态。</li> <li>当服务端收到确认应答后，也便进入 <code>CLOSED</code> 状态。
<ul><li>四次挥手简单原因：服务端还没发完消息</li> <li>等待<code>2MSL</code>简单原因是：防止发送给服务器的确认报文段丢失或者出错,从而导致服务器 端不能正常关闭。</li></ul></li></ul> <ol start="10"><li><strong>解析响应数据</strong></li></ol> <p>如果返回的状态码是<code>301</code>或<code>302</code>就需要<code>重定向</code>到其他<code>URL</code>，在重定向地址会在响应头的<code>Location</code>字段中，然后一切从头开始，否则然后根据情况选择关闭<code>TCP</code>连接或者保留重用</p> <p>然后网络线程会通过<code>SafeBrowsing</code>来检查站点是不是恶意站点，如果是就展示警告页面，告诉你这个站点有安全问题，浏览器会阻止访问，当然也可以强行继续访问。</p> <blockquote><p><strong><code>SafeBrowsing</code></strong> 是谷歌内部的一套站点安全系统，通过检查该站点的数据来判断是不是安全，比如通过查看该站点的<code>IP</code>有没有在谷歌黑名单中，如果是<code>Chrome</code>浏览器的话</p></blockquote> <p>响应成功返回状态码<code>2xx</code>，然后判断资源能不能缓存，如果可以就<code>先缓存</code>起来</p> <p>然后对响应解码，比如<code>gzip压缩</code>，然后根据资源类型(<code>Content-Type</code>)决定如何处理，如果浏览器判断是下载文件，那么请求会被提交给浏览器的<code>下载管理器</code>，同时<code>URL</code>请求流程就结束了</p> <p>否则网络线程会通知<code>UI</code>线程，然后<code>UI</code>线程会创建一个渲染器进程来准备渲染页面</p> <p>然后浏览器进程通过<code>IPC</code>管道将数据传给渲染器进程的主线程，准备<code>渲染流程</code></p> <blockquote><p>默认情况下会为每一个标签页配置一个渲染进程，但是也有例外，比如从<code>A</code>页面里面打开一个新的页面<code>B</code>页面，而<code>A</code>页面和<code>B</code>页面又属于同一站点的话，<code>A</code>和<code>B</code>就共用一个渲染进程，其他情况就为<code>B</code>创建一个新的渲染进程</p></blockquote> <p>渲染进程收到确认消息后，会和网络进程建立传输数据的管道，开始执行解析数据、下载资源等</p> <p><strong>为什么进入新页面，之前的页面不会立马消失，而是要加载一会才会更新的原因</strong></p> <ul><li>因为这时候的旧的文档还在网络进程中，渲染进程准备好了之后，渲染进程会向浏览器进程发出提交文档的消息</li> <li>浏览器进程收到后会开始清理当前的旧页面的文档，然后发出确认消息给渲染进程，同时浏览器更新浏览器界面(安全状态、<code>URL</code>、前进后退历史状态)并更新页面（此时是空白页）</li></ul> <ol start="11"><li><strong>页面渲染</strong></li></ol> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081158120.png" alt=""></p> <ul><li><p>渲染进程将 <code>HTML</code> 内容转换为能够读懂 <code>DOM</code> 树结构。</p></li> <li><p>渲染引擎将 <code>CSS</code> 样式表转化为浏览器可以理解的 <code>styleSheets</code>，计算出 <code>DOM</code> 节点的样式。</p></li> <li><p>创建布局树，并计算元素的布局信息。</p></li> <li><p>对布局树进行分层，并生成分层树。</p></li> <li><p>为每个图层生成绘制列表，并将其提交到合成线程。合成线程将图层分图块，并栅格化将图块转换成位图。</p></li> <li><p>合成线程发送绘制图块命令给浏览器进程。浏览器进程根据指令生成页面，并显示到显示器上</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>其中的构建<code>dom</code>树的过程如下</p> <ul><li>转码（<code>Bytes -&gt; Characters</code>）—— 读取接收到的 <code>HTML</code> 二进制数据，按指定编码格式将字节转换为 <code>HTML</code> 字符串</li> <li><code>Tokens</code> 化（<code>Characters -&gt; Tokens</code>）—— 解析 <code>HTML</code>，将 <code>HTML</code> 字符串转换为结构清晰的 <code>Tokens</code>，每个 <code>Token</code> 都有特殊的含义同时有自己的一套规则</li> <li>构建 <code>Nodes</code>（<code>Tokens -&gt; Nodes</code>）—— 每个 <code>Node</code> 都添加特定的属性（或属性访问器）也叫词法分析：将<code>token</code>转换为对象并定义属性和规则，通过指针能够确定 <code>Node</code> 的父、子、兄弟关系和所属 <code>treeScope</code>（例如：<code>iframe</code> 的 <code>treeScope</code> 与外层页面的 <code>treeScope</code> 不同）</li> <li>构建 <code>DOM</code> 树（<code>Nodes -&gt; DOM Tree</code>）—— 最重要的工作是建立起每个结点的父子兄弟关系(解析器会维护一个解析栈，栈底为<code>document</code>，也就是<code>DOM</code>树的根节点,然后根据节点对象关系按顺序依次向解析栈添加，<code>形成DOM树</code>)</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202280936284.png" alt=""></p> <blockquote><p><code>DOM</code>树 和 渲染树 的区别：</p></blockquote> <ul><li><code>DOM</code>树与<code>HTML</code>标签一一对应，包括<code>head</code>和隐藏元素</li> <li>渲染树不包括<code>head</code>和隐藏元素，大段文本的每一个行都是独立节点，每一个节点都有对应的<code>css</code>属性</li></ul> <p>样式计算</p> <p>渲染引擎将 <code>CSS</code> 样式表转化为浏览器可以理解的 <code>styleSheets</code>，计算出 <code>DOM</code> 节点的样式。</p> <div class="custom-block warning"><p class="custom-block-title">值得注意的是</p> <p><code>CSS</code>解析和<code>DOM</code>解析是可以同时进行的，但是<code>script</code>执行和<code>CSS</code>解析不能同时进行，<code>CSS</code>会阻塞<code>JS</code>执行</p> <p>因为<code>JS</code>执行时可能在文档的解析过程中 获取样式信息，如果样式信息没有加载和解析完毕，<code>JS</code>就会得到错误的值，所以会延迟<code>JS</code>执行</p></div></div> <blockquote><p><code>CSS</code> 样式来源主要有 <code>3</code> 种，分别是通过 <code>link</code> 引用的外部 <code>CSS</code> 文件、<code>style</code>标签内的 <code>CSS</code>、元素的 <code>style</code> 属性内嵌的 <code>CSS</code>。</p></blockquote> <p>页面布局</p> <blockquote><p>布局过程，即<code>排除 script、meta 等功能化、非视觉节点</code>，排除 <code>display: none</code> 的节点，计算元素的位置信息，确定元素的位置，构建一棵只包含可见元素布局树。如图</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081203608.png" alt=""></p> <p><strong>生成分层树</strong></p> <blockquote><p>页面中有很多复杂的效果，如一些复杂的 <code>3D</code> 变换、页面滚动，或者使用 <code>z-index</code> 做 <code>z</code> 轴排序等，为了更加方便地实现这些效果，渲染引擎还需要为特定的节点生成专用的图层，并生成一棵对应的图层树（<code>LayerTree</code>）</p></blockquote> <div class="custom-block note"><p class="custom-block-title">具体</p> <ul><li><p>拥有层叠上下文属性的元素，比如：</p></li> <li><p><code>html</code></p></li> <li><p><code>z-index</code>不为<code>auto</code></p></li> <li><p><code>position:fixed</code></p></li> <li><p><code>opacity</code>小于<code>1</code></p></li> <li><p><code>transform</code>不为<code>none</code></p></li> <li><p><code>filter不为none</code></p></li> <li><p><code>-webkit-overflow-scrolling：touch</code></p></li> <li><p>有<code>裁剪</code>的地方，比如内容溢出裁剪</p></li> <li><p>不裁剪出现滚动条的话，<code>滚动条</code>也会被提升为单独的层</p></li></ul></div> <p><strong>栅格化</strong></p> <blockquote><p>合成线程会按照视口附近的图块来优先生成位图，实际生成位图的操作是由栅格化来执行的。所谓栅格化，是指将<strong>图块转换为位图</strong></p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081205799.png" alt=""></p> <p>通常一个页面可能很大，但是用户只能看到其中的一部分，我们把用户可以看到的这个部分叫做视口（<code>viewport</code>）。在有些情况下，有的图层可以很大，比如有的页面你使用滚动条要滚动好久才能滚动到底部，但是通过视口，用户只能看到页面的很小一部分，所以在这种情况下，要绘制出所有图层内容的话，就会产生太大的开销，而且也没有必要。</p> <p>另外渲染引擎还维护了一个<strong>栅格化(光栅化)线程</strong>，合成线程将分割好的图块发送给<code>栅格化线程</code>，然后分别栅格化每个图块，再将栅格化之后的图块存储在<code>GPU内存</code>中</p> <p>合成器线程能够对不同的栅格化线程做优先处理，所以出现在视口内的图块会被<strong>优先栅格化</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202280945979.awebp" alt=""></p></li></ul> <ol start="12"><li><strong>合成和显示</strong>：当图块都被栅格化完成后，合成线程会收集栅格化线程的<code>draw quads</code>图块信息，该信息记录了图块在内存中的位置信息和图块在页面中的位置信息</li></ol> <p>根据这些信息，合成器线程生成一个合成器帧，然后通过<code>IPC</code>传给浏览器进程</p> <p>浏览器进程里有个叫 <code>viz</code> 的组件，用来接收这个合成器帧</p> <p>然后浏览器进程再将合成器帧绘制到显存中，再通过 <code>GPU</code> 渲染在屏幕上，这时候终于看到了页面内容</p> <p>当屏幕内容发生变化，比如滚动了页面，合成器线程就会将栅格化好的层合成一个新的合成器帧，新的帧再传到显存，<code>GPU</code> 再渲染到页面上</p> <div class="custom-block note"><p class="custom-block-title">延伸</p> <p><strong>这里可以问到<code>transform</code>不用重排，不会导致卡顿的原因</strong></p> <p>刚才的流程我们知道栅格化的整个流程是不占用主线程的，只在合成器线程和栅格线程中运行</p> <p>这就意味着它不用<code>JS</code>抢主线程，刚才提到反复重绘和重排会导致掉帧，是因为<code>JS</code>阻塞了主线程，而通过<code>CSS</code>中的动画属性<code>transform</code>实现的动画不会经过布局和绘制，而是直接运行在合成器线程和栅格化线程中，所以不会受到主线程<code>JS</code>执行的影响</p> <p>更重要的是<strong>通过<code>transform</code>实现的动画由于不需要经过布局和绘制，样式计算等操作</strong>，所以节省了很多运算时间</p></div> <div class="custom-block note"><p class="custom-block-title">补充 两种合成</p> <h4 id="显式合成"><a href="#显式合成" class="header-anchor">#</a> 显式合成</h4> <p>下面是<code>显式合成</code>的情况:</p> <p>一、 拥有<strong>层叠上下文</strong>的节点。</p> <p>层叠上下文也基本上是有一些特定的<code>CSS</code>属性创建的，一般有以下情况:</p> <ol><li><code>HTML</code>根元素本身就具有层叠上下文。</li> <li>普通元素设置 <strong><code>position</code>不为<code>static</code></strong> 并且<strong>设置了<code>z-index</code>属性</strong>，会产生层叠上下文。</li> <li>元素的 <strong><code>opacity</code></strong> 值不是 <code>1</code></li> <li>元素的 <strong><code>transform</code></strong> 值不是 <code>none</code></li> <li>元素的 <strong><code>filter</code></strong> 值不是 <code>none</code></li> <li>元素的 <strong><code>isolation</code></strong> 值是<code>isolate</code></li> <li><strong><code>will-change</code></strong> 指定的属性值为上面任意一个。</li></ol> <p>二、需要<strong>剪裁</strong>的地方。</p> <p>比如一个<code>div</code>，你只给他设置 <code>100 * 100</code> 像素的大小，而你在里面放了非常多的文字，那么超出的文字部分就需要被剪裁。当然如果出现了滚动条，那么滚动条会被单独提升为一个图层。</p> <h4 id="隐式合成"><a href="#隐式合成" class="header-anchor">#</a> 隐式合成</h4> <p>接下来是<code>隐式合成</code>，简单来说就是<code>层叠等级低</code>的节点被提升为单独的图层之后，那么<code>所有层叠等级比它高</code>的节点<strong>都会</strong>成为一个单独的图层。</p> <p>这个隐式合成其实隐藏着巨大的风险，如果在一个大型应用中，当一个<code>z-index</code>比较低的元素被提升为单独图层之后，层叠在它上面的的元素统统都会被提升为单独的图层，可能会增加上千个图层，大大增加内存的压力，甚至直接让页面崩溃。这就是<strong>层爆炸</strong>的原理。</p> <p>值得注意的是，当需要<code>repaint</code>时，只需要<code>repaint</code>本身，而不会影响到其他的层。</p></div> <ol start="13"><li><strong><code>JS</code>引擎解析过程</strong>：调用<code>JS</code>引擎执行<code>JS</code>代码（<code>JS</code>的解释阶段，预处理阶段，执行阶段生成执行上下文，<code>VO</code>，作用域链、回收机制等等）</li></ol> <ul><li>创建<code>window</code>对象：<code>window</code>对象也叫全局执行环境，当页面产生时就被创建，所有的全局变量和函数都属于<code>window</code>的属性和方法，而<code>DOM Tree</code>也会映射在<code>window</code>的<code>doucment</code>对象上。当关闭网页或者关闭浏览器时，全局执行环境会被销毁。</li> <li>加载文件：完成<code>js</code>引擎分析它的语法与词法是否合法，如果合法进入预编译</li> <li>预编译：在预编译的过程中，浏览器会寻找全局变量声明，把它作为<code>window</code>的属性加入到<code>window</code>对象中，并给变量赋值为<code>'undefined'</code>；寻找全局函数声明，把它作为<code>window</code>的方法加入到<code>window</code>对象中，并将函数体赋值给他（<strong>匿名函数是不参与预编译的，因为它是变量</strong>）。而变量提升作为不合理的地方在<code>ES6</code>中已经解决了，函数提升还存在。</li> <li>解释执行：执行到变量就赋值，如果变量没有被定义，也就没有被预编译直接赋值，在<code>ES5</code>非严格模式下这个变量会成为<code>window</code>的一个属性，也就是成为全局变量。<code>string</code>、<code>int</code>这样的值就是直接把值放在变量的存储空间里，<code>object</code>对象就是把指针指向变量的存储空间。函数执行，就将函数的环境推入一个环境的栈中，执行完成后再弹出，控制权交还给之前的环境。<code>JS</code>作用域其实就是这样的执行流机制实现的。</li></ul> <div class="custom-block note"><p class="custom-block-title">补充:显示器显示图像的原理</p> <p>无论是 <code>PC</code> 还是手机屏幕，都有一个固定的刷新频率，一般是 <code>60 HZ</code>，即 <code>60</code> 帧，也就是一秒更新 <code>60</code> 张图片，一张图片停留的时间约为 <code>16.7 ms</code>。</p> <p>而每次更新的图片都来自显卡的<strong>前缓冲区</strong>。而显卡接收到浏览器进程传来的页面后，会合成相应的图像，并将图像保存到<strong>后缓冲区</strong>，然后系统自动将<code>前缓冲区</code>和<code>后缓冲区</code>对换位置，如此循环更新。</p> <p>这也就是当某个动画大量占用内存的时候，浏览器生成图像的时候会变慢，图像传送给显卡就会不及时，而显示器还是以不变的频率刷新，因此会出现卡顿，也就是明显的掉帧现象</p></div> <h2 id="扫码登陆流程"><a href="#扫码登陆流程" class="header-anchor">#</a> 扫码登陆流程</h2> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202261059558.png" alt="image-20220226105933315"></p> <p><strong>问：假设扫码途中<code>QRCode</code>刷新了怎么办？</strong></p> <p>可以在<code>PC</code>端新增状态，已扫码待确认，来阻止轮询超时重新获取二维码</p> <p><strong>问：<code>PC</code>怎么根据二维码进行响应</strong></p> <p><code>PC</code>端可以通过获取二维码的状态来进行相应的响应：</p> <ul><li>二维码<code>未扫描</code>：无操作</li> <li>二维码<code>已失效</code>：提示刷新二维码</li> <li>二维码<code>已成功</code>：从服务端获取<code>PC token</code></li></ul> <p><strong>问：可以用长轮询嘛 <code>ws</code>呢</strong></p> <p>可以。长轮询是指客户端主动给服务端发送二维码状态的查询请求，服务端会按情况对请求进行阻塞，直至二维码信息更新或超时。当客户端接收到返回结果后，若二维码仍未被扫描，则会继续发送查询请求，直至状态变化（已失效或已成功）</p> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202261108821.awebp" alt="长轮询"></p> <p><code>Websocket</code>是指前端在生成二维码后，会与后端建立连接，一旦后端发现二维码状态变化，可直接通过建立的连接主动推送信息给前端。</p> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202261108891.awebp" alt="Websocket"></p> <h2 id="为什么通常在发送数据埋点请求的时候使用的是-1x1-像素的透明-gif-图片"><a href="#为什么通常在发送数据埋点请求的时候使用的是-1x1-像素的透明-gif-图片" class="header-anchor">#</a> 为什么通常在发送数据埋点请求的时候使用的是 <code>1x1</code> 像素的透明 <code>gif</code> 图片<span class="badge warning" style="vertical-align:top;" data-v-d5affa18>重要</span></h2> <ul><li>能够完成整个 <code>HTTP</code> 请求+响应（尽管不需要响应内容）</li> <li>触发 <code>GET</code> 请求之后不需要获取和处理数据、服务器也不需要发送数据</li> <li>跨域友好</li> <li>执行过程无阻塞</li> <li>相比 <code>XMLHttpRequest</code> 对象发送 <code>GET</code> 请求，性能上更好</li> <li><code>GIF</code>的最低合法体积最小（最小的<code>BMP</code>文件需要<code>74</code>个字节，<code>PNG</code>需要<code>67</code>个字节，而合法的<code>GIF</code>，只需要<code>43</code>个字节）</li></ul> <p><strong>为什么不能用请求其他文件资源(<code>js/css/ttf</code>)的方式进行上报呢</strong></p> <p>创建资源节点后只有将对象注入到浏览器<code>DOM</code>树后，浏览器才会实际发送资源请求。而且载入<code>js/css</code>资源还会阻塞页面渲染，影响用户体验。</p> <p>构造图片打点不仅不用插入<code>DOM</code>，只要在<code>js</code>中<code>new</code>出<code>Image</code>对象就能发起请求，而且还没有阻塞问题，在没有<code>js</code>的浏览器环境中也能通过<code>img</code>标签正常打点。</p> <p><strong>同样都是图片，上报时选用了<code>1x1</code>的透明<code>GIF</code>，而不是其他的<code>PNG/JEPG/BMP</code>文件</strong></p> <p>首先，<code>1x1</code>像素是最小的合法图片。而且，因为是通过图片打点，所以图片最好是透明的，这样一来不会影响页面本身展示效果，二者表示图片透明只要使用一个二进制位标记图片是透明色即可，不用存储色彩空间数据，可以节约体积。因为需要透明色，所以可以直接排除<code>JEPG</code>。</p> <p>同样的响应，<code>GIF</code>可以比<code>BMP</code>节约<code>41%</code>的流量，比<code>PNG</code>节约<code>35%</code>的流量。<code>GIF</code>才是最佳选择。</p> <ul><li>可以进行跨域</li> <li>不会携带<code>cookie</code></li> <li>不需要等待服务器返回数据</li></ul> <h2 id="简单描述一下-babel-的编译过程"><a href="#简单描述一下-babel-的编译过程" class="header-anchor">#</a> 简单描述一下 <code>Babel</code> 的编译过程<span class="badge error" style="vertical-align:top;" data-v-d5affa18>特别重要</span></h2> <div class="custom-block tip"><p class="custom-block-title">概念</p> <p><code>Babel</code> 是一个 <code>JavaScript</code> 编译器，是一个工具链，主要用于将采用 <code>ECMAScript 2015+</code> 语法编写的代码转换为向后兼容的 <code>JavaScript</code> 语法，以便能够运行在当前和旧版本的浏览器或其他环境中。</p></div> <p><code>Babel</code> 本质上就是在操作 <code>AST</code> 来完成代码的转译。<code>AST</code>是抽象语法树（<code>Abstract Syntax Tree, AST</code>）</p> <p><code>Babel</code> 的功能很纯粹，它只是一个编译器。大多数编译器的工作过程可以分为三部分：</p> <ol><li><strong>解析（<code>Parse</code>）</strong> ：将源代码转换成更加抽象的表示方法（例如抽象语法树）。包括词法分析和语法分析。词法分析主要把字符流源代码（<code>Char Stream</code>）转换成令牌流（ <code>Token Stream</code>），语法分析主要是将令牌流转换成抽象语法树<code>（Abstract Syntax Tree，AST）</code>。</li> <li><strong>转换（<code>Transform</code>）</strong> ：通过 <code>Babel</code> 的插件能力，对（抽象语法树）做一些特殊处理，将高版本语法的 <code>AST</code> 转换成支持低版本语法的 <code>AST</code>。让它符合编译器的期望，当然在此过程中也可以对 <code>AST</code> 的 <code>Node</code> 节点进行优化操作，比如添加、更新以及移除节点等。</li> <li><strong>生成（<code>Generate</code>）</strong> ：将 <code>AST</code> 转换成字符串形式的低版本代码，同时也能创建 <code>Source Map</code> 映射。</li></ol> <p>经过这三个阶段，代码就被 <code>Babel</code> 转译成功了。</p> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202051701131.awebp" alt="img"> <img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202051701937.awebp" alt="img"></p> <h2 id="列举一下有哪些捕获-监控错误的方式"><a href="#列举一下有哪些捕获-监控错误的方式" class="header-anchor">#</a> 列举一下有哪些捕获/监控错误的方式<span class="badge error" style="vertical-align:top;" data-v-d5affa18>特别重要</span></h2> <p><strong><code>try/catch</code></strong></p> <blockquote><p>能捕获常规运行时错误，语法错误和异步错误不行</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 常规运行时错误，可以捕获 ✅</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notdefined<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 语法错误，不能捕获 ❌</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notdefined<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 异步错误，不能捕获 ❌</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notdefined<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong><code>window.onerror</code></strong></p> <blockquote><p><code>pure js</code>错误收集，<code>window.onerror</code>，当 <code>JS</code> 运行时错误发生时，<code>window</code> 会触发一个 <code>ErrorEvent</code> 接口的 <code>error</code> 事件。</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
* @param {String}  message    错误信息
* @param {String}  source    出错文件
* @param {Number}  lineno    行号
* @param {Number}  colno    列号
* @param {Object}  error  Error对象
*/</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>先验证下几个错误是否可以捕获。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 常规运行时错误，可以捕获 ✅</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notdefined<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 语法错误，不能捕获 ❌</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> notdefined<span class="token punctuation">,</span>
      
<span class="token comment">// 异步错误，可以捕获 ✅</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notdefined<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// 资源错误，不能捕获 ❌</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;https://yun.tuia.cn/image/kkk.png&quot;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong><code>window.addEventListener</code></strong></p> <blockquote><p>当一项资源（如图片或脚本）加载失败，加载资源的元素会触发一个 <code>Event</code> 接口的 <code>error</code> 事件，这些 <code>error</code> 事件不会向上冒泡到 <code>window</code>，但能被捕获。而<code>window.onerror</code>不能监测捕获。</p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// 图片、script、css加载错误，都能被捕获 ✅
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://yun.tuia.cn/image/kkk.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://yun.tuia.cn/foundnull.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://yun.tuia.cn/foundnull.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  
// new Image错误，不能捕获 ❌
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://yun.tuia.cn/image/lll.png'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

// fetch错误，不能捕获 ❌
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://tuia.cn/test'</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><code>new Image</code>运用的比较少，可以单独自己处理自己的错误。</p> <p>但通用的<code>fetch</code>怎么办呢，<code>fetch</code>返回<code>Promise</code>，但<code>Promise</code>的错误不能被捕获，怎么办呢？</p> <p><strong><code>Promise</code>错误</strong></p> <ol><li>普通<code>Promise</code>错误</li></ol> <blockquote><p><code>try/catch</code>不能捕获<code>Promise</code>中的错误</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// try/catch 不能处理 JSON.parse 的错误，因为它在 Promise 中</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'in try catch'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 需要使用catch方法</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in catch fn'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol><li><code>async</code>错误</li></ol> <blockquote><p><code>try/catch</code>不能捕获<code>async</code>包裹的错误</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getJSON</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'inner error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 通过try/catch处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">makeRequest</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 捕获不到</span>
        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'outer'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// try/catch不到</span>
    <span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'in try catch'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要await，才能捕获到</span>
    <span class="token keyword">await</span> <span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'in try catch'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol start="3"><li><code>import chunk</code>错误</li></ol> <blockquote><p><code>import</code>其实返回的也是一个<code>promise</code>，因此使用如下两种方式捕获错误</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Promise catch方法</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;incentive&quot; */</span><span class="token string">'./index'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'in catch fn'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// await 方法，try catch</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;incentive&quot; */</span><span class="token string">'./index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'in try catch'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>以上三种其实归结为<code>Promise</code>类型错误，可以通过<code>unhandledrejection</code>捕获</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 全局统一处理Promise</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unhandledrejection&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://tuia.cn/test'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>不过捕捉不到行数，触发时间在被 <code>reject</code> 但没有 <code>reject</code> 处理的时候，可能发生在 <code>window</code> 下，也可能在 <code>Worker</code> 中</p></blockquote> <p><strong><code>Vue</code>错误</strong></p> <blockquote><p>由于<code>Vue</code>会捕获所有<code>Vue</code>单文件组件或者<code>Vue.extend</code>继承的代码，所以在<code>Vue</code>里面出现的错误，并不会直接被<code>window.onerror</code>捕获，而是会抛给<code>Vue.config.errorHandler</code>。</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 全局捕获Vue错误，直接扔出给onerror处理
 */</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong><code>React</code>错误</strong></p> <blockquote><p><code>react</code> 通过<code>componentDidCatch</code>，声明一个错误边界的组件</p></blockquote> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasError<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 更新 state 使下一次渲染能够显示降级后的 UI</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> hasError<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 你同样可以将错误日志上报给服务器</span>
    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 你可以自定义降级后的 UI 并渲染</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Something went wrong.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
   
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorBoundary</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyWidget</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ErrorBoundary</span></span><span class="token punctuation">&gt;</span></span>  
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>但<code>error boundaries</code>并不会捕捉以下错误：<code>React</code>事件处理，异步代码，<code>error boundaries</code>自己抛出的错误</p> <h2 id="前端容灾是什么-该怎么解决"><a href="#前端容灾是什么-该怎么解决" class="header-anchor">#</a> 前端容灾是什么 该怎么解决</h2> <p>前端容灾指的因为各种原因后端接口挂了(比如服务器断电断网等等)，前端依然能保证页面信息能完整展示。</p> <p>比如 <code>banner</code> 或者列表之类的等等数据是从接口获取的，要是接口获取不到了，怎么办呢？</p> <p><strong><code>LocalStorage</code></strong></p> <p>在接口正常返回的时候把数据都存到 <code>LocalStorage</code> ，可以把接口路径作为 <code>key</code>，返回的数据作为 <code>value</code></p> <p>然后之次再请求，只要请求失败，就读取 <code>LocalStorage</code>，把上次的数据拿出来展示，并上报错误信息，以获得缓冲时间</p> <p><strong><code>CDN</code></strong></p> <p>同时，每次更新都要备份一份静态数据放到<code>CDN</code></p> <p>在接口请求失败的时候，并且 <code>LocalStorage</code> 也没有数据的情况下，就去 <code>CDN</code> 摘取备份的静态数据</p> <p><strong><code>Service Worker</code></strong></p> <p>假如不只是接口数据，整个 <code>html</code> 都想存起来，就可以使用 <code>Service Worker</code> 做离线存储</p> <p>利用 <code>Service Worker</code> 的请求拦截，不管是存接口数据，还是存页面静态资源文件都可以</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 拦截所有请求事件 缓存中有请求的数据就直接用缓存，否则去请求数据 </span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token comment">// 查找request中被缓存命中的response </span>
    e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword">return</span> response 
        <span class="token punctuation">}</span> 
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fetch source'</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>做好这些，整个网站就完全可以离线运行了，但是问题也很明显，就是时效性较高的页面可能会有数据无法同步更新的问题（比如商家库存不足了显示不一致）</p> <p>另外要注意的是要保证前端页面自身可发布更新，比如页面异常后，此时业务系统要发新版本进行修复和更新，要能确保新版本的资源可以全量替换旧版本的线上资源</p> <h2 id="前端工程化的理解"><a href="#前端工程化的理解" class="header-anchor">#</a> 前端工程化的理解</h2> <p><strong>模块化</strong></p> <p>将一个大的文件，拆分成多个相互依赖的小文件，按一个个模块来划分</p> <p><strong>组件化</strong></p> <p>页面上所有的东西都可以看成组件，页面是个大型组件，可以拆成若干个中型组件，然后中型组件还可以再拆，拆成若干个小型组件</p> <ul><li><strong>组件化≠模块化</strong>。模块化只是在文件层面上，对代码和资源的拆分；组件化是在设计层面上，对于<code>UI</code>的拆分</li> <li>目前市场上的组件化的框架，主要的有<code>Vue</code>，<code>React</code>，<code>Angular2</code></li></ul> <p><strong>规范化</strong></p> <p>在项目规划初期制定的好坏对于后期的开发有一定影响。包括的规范有</p> <ul><li>目录结构的制定</li> <li>编码规范 <code>editorconfig</code>、<code>eslint</code>配置，<code>git husky</code>在<code>git commit</code> 后自动通过规范化修复</li> <li>前后端接口规范</li> <li>文档规范</li> <li>组件管理</li> <li><code>Git</code>分支管理</li> <li><code>Commit</code>描述规范 <code>commitizen</code>使用统一风格的<code>commit</code>语句</li> <li>定期<code>codeReview</code></li> <li>视觉图标规范</li></ul> <p><strong>自动化</strong></p> <p>也就是简单重复的工作交给机器来做，自动化也就是有很多自动化工具代替我们来完成，例如持续集成、自动化构建、自动化部署、自动化测试等等</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p><code>CI</code>是什么</p> <ul><li>持续集成：当代码仓库代码发生变更，就会自动对代码进行测试和构建，反馈运行结果。</li></ul> <p><code>CD</code>是什么</p> <ul><li>持续交付：持续交付是在持续集成的基础上，可以将集成后的代码依次部署到测试环境、予发布环境、生产环境等中</li></ul></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/04/03, 23:38:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/e98c4e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">原型和原型链</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/e98c4e/" class="prev">原型和原型链</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/duochizhacai" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://juejin.cn/user/1249486902410744" title="JueJin" target="_blank" class="iconfont icon-juejin"></a></div> 
    Copyright © 2021-2022
    <span><a href='https://beian.miit.gov.cn'>粤ICP备2021165371号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95fc12d6.js" defer></script><script src="/assets/js/2.abf57e2f.js" defer></script><script src="/assets/js/14.4e5bcc62.js" defer></script><script src="/assets/js/3.e687237e.js" defer></script>
  </body>
</html>
