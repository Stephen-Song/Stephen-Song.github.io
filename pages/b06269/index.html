<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>虚拟DOM | 小宋爱睡觉</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="🚀一个前端程序员小白的博客🌹">
    <meta name="keywords" content="blog,crucials,frontend,前端,小宋爱睡觉,博客,duochizhacai">
    <meta name="theme-color" content="#60ad81">
    
    <link rel="preload" href="/assets/css/0.styles.65787d8c.css" as="style"><link rel="preload" href="/assets/js/app.95fc12d6.js" as="script"><link rel="preload" href="/assets/js/2.abf57e2f.js" as="script"><link rel="preload" href="/assets/js/50.b482896d.js" as="script"><link rel="prefetch" href="/assets/js/10.9d6bb65c.js"><link rel="prefetch" href="/assets/js/11.bea1ca2d.js"><link rel="prefetch" href="/assets/js/12.a5ced6a2.js"><link rel="prefetch" href="/assets/js/13.ec1bcac6.js"><link rel="prefetch" href="/assets/js/14.4e5bcc62.js"><link rel="prefetch" href="/assets/js/15.753bb2dc.js"><link rel="prefetch" href="/assets/js/16.a6e51bcc.js"><link rel="prefetch" href="/assets/js/17.25227dca.js"><link rel="prefetch" href="/assets/js/18.19267273.js"><link rel="prefetch" href="/assets/js/19.a9403a12.js"><link rel="prefetch" href="/assets/js/20.c007e659.js"><link rel="prefetch" href="/assets/js/21.dca7af69.js"><link rel="prefetch" href="/assets/js/22.d9f25771.js"><link rel="prefetch" href="/assets/js/23.2668c7ed.js"><link rel="prefetch" href="/assets/js/24.30c858a4.js"><link rel="prefetch" href="/assets/js/25.bd21abb1.js"><link rel="prefetch" href="/assets/js/26.28d250cb.js"><link rel="prefetch" href="/assets/js/27.a60d212f.js"><link rel="prefetch" href="/assets/js/28.8a5c2c34.js"><link rel="prefetch" href="/assets/js/29.4688a5d6.js"><link rel="prefetch" href="/assets/js/3.e687237e.js"><link rel="prefetch" href="/assets/js/30.5985f3b4.js"><link rel="prefetch" href="/assets/js/31.7ee5d916.js"><link rel="prefetch" href="/assets/js/32.2f711dea.js"><link rel="prefetch" href="/assets/js/33.45a4e58a.js"><link rel="prefetch" href="/assets/js/34.6a46cad8.js"><link rel="prefetch" href="/assets/js/35.79084a19.js"><link rel="prefetch" href="/assets/js/36.9a5cf509.js"><link rel="prefetch" href="/assets/js/37.ea6b36a3.js"><link rel="prefetch" href="/assets/js/38.1ebed809.js"><link rel="prefetch" href="/assets/js/39.16200e67.js"><link rel="prefetch" href="/assets/js/4.4a0efd85.js"><link rel="prefetch" href="/assets/js/40.db1f5064.js"><link rel="prefetch" href="/assets/js/41.5c8205b4.js"><link rel="prefetch" href="/assets/js/42.d8e671a9.js"><link rel="prefetch" href="/assets/js/43.80c6d459.js"><link rel="prefetch" href="/assets/js/44.0dc33dbe.js"><link rel="prefetch" href="/assets/js/45.e623e04e.js"><link rel="prefetch" href="/assets/js/46.b9a46fc2.js"><link rel="prefetch" href="/assets/js/47.2d5eb349.js"><link rel="prefetch" href="/assets/js/48.8d4e8a09.js"><link rel="prefetch" href="/assets/js/49.f7f58461.js"><link rel="prefetch" href="/assets/js/5.84799806.js"><link rel="prefetch" href="/assets/js/51.9ad2b264.js"><link rel="prefetch" href="/assets/js/52.7862671c.js"><link rel="prefetch" href="/assets/js/53.d8153804.js"><link rel="prefetch" href="/assets/js/54.0af2674d.js"><link rel="prefetch" href="/assets/js/55.597b91b8.js"><link rel="prefetch" href="/assets/js/56.46804158.js"><link rel="prefetch" href="/assets/js/57.006f6db0.js"><link rel="prefetch" href="/assets/js/58.751e40d0.js"><link rel="prefetch" href="/assets/js/59.b0ebe0e6.js"><link rel="prefetch" href="/assets/js/6.f7ec0152.js"><link rel="prefetch" href="/assets/js/60.8d675b12.js"><link rel="prefetch" href="/assets/js/61.55190a7f.js"><link rel="prefetch" href="/assets/js/62.117f5f66.js"><link rel="prefetch" href="/assets/js/63.b848bfe2.js"><link rel="prefetch" href="/assets/js/64.000227a3.js"><link rel="prefetch" href="/assets/js/65.9ec404e1.js"><link rel="prefetch" href="/assets/js/66.1834b2b1.js"><link rel="prefetch" href="/assets/js/67.bf716de8.js"><link rel="prefetch" href="/assets/js/68.6e03054c.js"><link rel="prefetch" href="/assets/js/69.c6605c56.js"><link rel="prefetch" href="/assets/js/7.40c08f02.js"><link rel="prefetch" href="/assets/js/70.30051d78.js"><link rel="prefetch" href="/assets/js/71.1fdc7d36.js"><link rel="prefetch" href="/assets/js/72.4b0ad4ad.js"><link rel="prefetch" href="/assets/js/73.e989ab6d.js"><link rel="prefetch" href="/assets/js/74.02429c23.js"><link rel="prefetch" href="/assets/js/75.8f044cef.js"><link rel="prefetch" href="/assets/js/76.7acc2de5.js"><link rel="prefetch" href="/assets/js/77.ce127400.js"><link rel="prefetch" href="/assets/js/78.deb1ae24.js"><link rel="prefetch" href="/assets/js/79.75a4c78b.js"><link rel="prefetch" href="/assets/js/8.303c64d8.js"><link rel="prefetch" href="/assets/js/80.6c258060.js"><link rel="prefetch" href="/assets/js/81.563a0c28.js"><link rel="prefetch" href="/assets/js/82.143b4caf.js"><link rel="prefetch" href="/assets/js/83.32431b7f.js"><link rel="prefetch" href="/assets/js/84.2320a5a5.js"><link rel="prefetch" href="/assets/js/85.d9a1625a.js"><link rel="prefetch" href="/assets/js/86.dc0f47f2.js"><link rel="prefetch" href="/assets/js/87.8335157f.js"><link rel="prefetch" href="/assets/js/88.2cfc7001.js"><link rel="prefetch" href="/assets/js/89.6bc590c2.js"><link rel="prefetch" href="/assets/js/9.7ba1b2de.js"><link rel="prefetch" href="/assets/js/90.c20801a7.js"><link rel="prefetch" href="/assets/js/91.1a32fafc.js"><link rel="prefetch" href="/assets/js/92.4a802465.js">
    <link rel="stylesheet" href="/assets/css/0.styles.65787d8c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/logo.png" alt="小宋爱睡觉" class="logo"> <span class="site-name can-hide">小宋爱睡觉</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><a href="/pages/56881f/" class="link-title">知识库</a> <span class="title" style="display:none;">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/56881f/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/c0e7f0/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/787250/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/f0a671/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/b7238f/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/2448f7/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/b8bd46/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/pages/f15087/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/pages/e3cba5/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/pages/ba01c4/" class="nav-link">手写系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/pages/ad5191/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ac126/" class="nav-link">字符串</a></li><li class="dropdown-item"><!----> <a href="/pages/251490/" class="nav-link">数组</a></li><li class="dropdown-item"><!----> <a href="/pages/fc9745/" class="nav-link">链表</a></li><li class="dropdown-item"><!----> <a href="/pages/ad5191/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/6aee18/" class="nav-link">动态规划</a></li><li class="dropdown-item"><!----> <a href="/pages/78e948/" class="nav-link">排序算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><a href="/pages/b06269/https://github.com/duochizhacai" class="link-title">GitHub</a> <span class="title" style="display:none;">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duochizhacai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1249486902410744" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JueJin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><a href="/pages/56881f/" class="link-title">知识库</a> <span class="title" style="display:none;">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/56881f/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/c0e7f0/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/787250/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/f0a671/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/b7238f/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/2448f7/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/b8bd46/" class="nav-link">浏览器原理</a></li><li class="dropdown-item"><!----> <a href="/pages/f15087/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/pages/e3cba5/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/pages/ba01c4/" class="nav-link">手写系列</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><a href="/pages/ad5191/" class="link-title">算法</a> <span class="title" style="display:none;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ac126/" class="nav-link">字符串</a></li><li class="dropdown-item"><!----> <a href="/pages/251490/" class="nav-link">数组</a></li><li class="dropdown-item"><!----> <a href="/pages/fc9745/" class="nav-link">链表</a></li><li class="dropdown-item"><!----> <a href="/pages/ad5191/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/6aee18/" class="nav-link">动态规划</a></li><li class="dropdown-item"><!----> <a href="/pages/78e948/" class="nav-link">排序算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><a href="/pages/b06269/https://github.com/duochizhacai" class="link-title">GitHub</a> <span class="title" style="display:none;">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duochizhacai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1249486902410744" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JueJin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/b7238f/" class="sidebar-link">事件机制</a></li><li><a href="/pages/24db5f/" class="sidebar-link">数据管理</a></li><li><a href="/pages/54c6f9/" class="sidebar-link">生命周期</a></li><li><a href="/pages/be9376/" class="sidebar-link">组件通信</a></li><li><a href="/pages/000594/" class="sidebar-link">路由</a></li><li><a href="/pages/30f7b5/" class="sidebar-link">redux</a></li><li><a href="/pages/6bcb1a/" class="sidebar-link">Hooks</a></li><li><a href="/pages/b06269/" aria-current="page" class="active sidebar-link">虚拟DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/b06269/#对虚拟-dom的理解-虚拟-dom-主要做了什么-虚拟-dom-本身是什么" class="sidebar-link">对虚拟 DOM 的理解？虚拟 DOM 主要做了什么？虚拟 DOM 本身是什么？</a></li><li class="sidebar-sub-header"><a href="/pages/b06269/#react-diff-算法的原理是什么" class="sidebar-link">React diff 算法的原理是什么？</a></li><li class="sidebar-sub-header"><a href="/pages/b06269/#react-key-是干嘛用的-为什么要加-key-主要是解决哪一类问题的" class="sidebar-link">React key 是干嘛用的 为什么要加？key 主要是解决哪一类问题的</a></li><li class="sidebar-sub-header"><a href="/pages/b06269/#虚拟-dom-的引入与直接操作原生-dom-相比-哪一个效率更高-为什么" class="sidebar-link">虚拟 DOM 的引入与直接操作原生 DOM 相比，哪一个效率更高，为什么</a></li><li class="sidebar-sub-header"><a href="/pages/b06269/#react-与-vue-的-diff-算法有何不同" class="sidebar-link">React 与 Vue 的 diff 算法有何不同？</a></li></ul></li><li><a href="/pages/b0c8ad/" class="sidebar-link">其他</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><span data-v-1cd794fe>React</span></li> <!----> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/duochizhacai" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Crucials</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-05-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          虚拟DOM
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="对虚拟-dom的理解-虚拟-dom-主要做了什么-虚拟-dom-本身是什么"><a href="#对虚拟-dom的理解-虚拟-dom-主要做了什么-虚拟-dom-本身是什么" class="header-anchor">#</a> 对虚拟 <code>DOM</code>的理解？虚拟 <code>DOM</code> 主要做了什么？虚拟 <code>DOM</code> 本身是什么？</h2> <p>从本质上来说，<code>Virtual Dom</code> 是一个<code>JavaScript</code>对象，通过对象的方式来表示<code>DOM</code>结构。将页面的状态抽象为<code>JS</code>对象的形式，配合不同的渲染工具，使跨平台渲染成为可能。</p> <p>通过事务处理机制，将多次<code>DOM</code>修改的结果一次性的更新到页面上，从而有效的减少页面渲染的次数，减少修改<code>DOM</code>的重绘重排次数，提高渲染性能。</p> <p>虚拟<code>DOM</code>是对<code>DOM</code>的抽象，这个对象是更加轻量级的对<code>DOM</code>的描述。它设计的最初目的，就是更好的跨平台，比如<code>node.js</code>就没有<code>DOM</code>，如果想实现<code>SSR</code>，那么一个方式就是借助虚拟<code>dom</code>，因为虚拟<code>dom</code>本身是<code>js</code>对象。 在代码渲染到页面之前，<code>vue</code>或者<code>react</code>会把代码转换成一个对象（虚拟<code>DOM</code>）。以对象的形式来描述真实<code>dom</code>结构，最终渲染到页面。在每次数据发生变化前，虚拟<code>dom</code>都会缓存一份，变化之时，现在的虚拟<code>dom</code>会与缓存的虚拟<code>dom</code>进行比较。在<code>vue</code>或者<code>react</code>内部封装了<code>diff</code>算法，通过这个算法来进行比较，渲染时修改改变的变化，原先没有发生改变的通过原先的数据进行渲染。</p> <p>另外现代前端框架的一个基本要求就是无须手动操作<code>DOM</code>，一方面是因为手动操作<code>DOM</code>无法保证程序性能，多人协作的项目中如果<code>review</code>不严格，可能会有开发者写出性能较低的代码，另一方面更重要的是省略手动<code>DOM</code>操作可以大大提高开发效率。</p> <p><strong>为什么要用 <code>Virtual DOM</code>：</strong></p> <p><strong>1. 保证性能下限，在不进行手动优化的情况下，提供过得去的性能</strong></p> <p>下面对比一下修改<code>DOM</code>时真实<code>DOM</code>操作和<code>Virtual DOM</code>的过程，来看一下它们重排重绘的性能消耗∶</p> <ul><li>真实<code>DOM</code>∶ 生成<code>HTML</code>字符串＋ 重建所有的<code>DOM</code>元素</li> <li><code>Virtual DOM</code>∶ 生成<code>vNode</code>＋ <code>DOMDiff</code>＋必要的<code>DOM</code>更新</li></ul> <p><code>Virtual DOM</code>的更新<code>DOM</code>的准备工作耗费更多的时间，也就是<code>JS</code>层面，相比于更多的<code>DOM</code>操作它的消费是极其便宜的。尤雨溪在社区论坛中说道∶ 框架给你的保证是，你不需要手动优化的情况下，我依然可以给你提供过得去的性能。</p> <p><strong>2. 跨平台</strong> <code>Virtual DOM</code>本质上是<code>JavaScript</code>的对象，它可以很方便的跨平台操作，比如服务端渲染、<code>uniapp</code>等。</p> <h2 id="react-diff-算法的原理是什么"><a href="#react-diff-算法的原理是什么" class="header-anchor">#</a> <code>React diff</code> 算法的原理是什么？</h2> <p>实际上，<code>diff</code> 算法探讨的就是虚拟 <code>DOM</code> 树发生变化后，生成 <code>DOM</code> 树更新补丁的方式。它通过对比新旧两株虚拟 <code>DOM</code> 树的变更差异，将更新补丁作用于真实 <code>DOM</code>，以最小成本完成视图更新。 <img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202205021525287.awebp" alt="CgqCHl_qyouAAkb9AAB_cmWuZhc920_mh1609406106571.jpg"> 具体的流程如下：</p> <ul><li>真实的 <code>DOM</code> 首先会映射为虚拟 <code>DOM</code>；</li> <li>当虚拟 <code>DOM</code> 发生变化后，就会根据差距计算生成 <code>patch</code>，这个 <code>patch</code> 是一个结构化的数据，内容包含了增加、更新、移除等；</li> <li>根据 <code>patch</code> 去更新真实的 <code>DOM</code>，反馈到用户的界面上。</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202205021526103.awebp" alt="CgqCHl_qypGAZPuGAADYrK9nkJY878_mh1609406162857.jpg"> 一个简单的例子：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ExampleComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;visible&quot;</span><span class="token operator">&gt;</span>visbile<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span><span class="token operator">&gt;</span>hidden<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这里，首先假定 <code>ExampleComponent</code> 可见，然后再改变它的状态，让它不可见 。映射为真实的 <code>DOM</code> 操作是这样的，<code>React</code> 会创建一个 <code>div</code> 节点。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>visible<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>visbile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当把 <code>visbile</code> 的值变为 <code>false</code> 时，就会替换 <code>class</code> 属性为 <code>hidden</code>，并重写内部的 <code>innerText</code> 为 <code>hidden</code>。<strong>这样一个生成补丁、更新差异的过程统称为 <code>diff</code> 算法。</strong></p> <p><code>diff</code>算法可以总结为三个策略，分别从树、组件及元素三个层面进行复杂度的优化：</p> <p><strong>策略一：忽略节点跨层级操作场景，提升比对效率。（基于树进行对比）</strong></p> <p>这一策略需要进行树比对，即对树进行分层比较。树比对的处理手法是非常“暴力”的，即两棵树只对同一层次的节点进行比较，如果发现节点已经不存在了，则该节点及其子节点会被完全删除掉，不会用于进一步的比较，这就提升了比对效率。</p> <p><strong>策略二：如果组件的 <code>class</code> 一致，则默认为相似的树结构，否则默认为不同的树结构。（基于组件进行对比）</strong></p> <p>在组件比对的过程中：</p> <ul><li>如果组件是同一类型则进行树比对；</li> <li>如果不是则直接放入补丁中。</li></ul> <p>只要父组件类型不同，就会被重新渲染。这也就是为什么 <code>shouldComponentUpdate</code>、<code>PureComponent</code> 及 <code>React.memo</code> 可以提高性能的原因。</p> <p><strong>策略三：同一层级的子节点，可以通过标记 <code>key</code> 的方式进行列表对比。（基于节点进行对比）</strong></p> <p>元素比对主要发生在同层级中，通过标记节点操作生成补丁。节点操作包含了插入、移动、删除等。其中节点重新排序同时涉及插入、移动、删除三个操作，所以效率消耗最大，此时策略三起到了至关重要的作用。通过标记 <code>key</code> 的方式，<code>React</code> 可以直接移动 <code>DOM</code> 节点，降低内耗。</p> <h2 id="react-key-是干嘛用的-为什么要加-key-主要是解决哪一类问题的"><a href="#react-key-是干嘛用的-为什么要加-key-主要是解决哪一类问题的" class="header-anchor">#</a> <code>React key</code> 是干嘛用的 为什么要加？<code>key</code> 主要是解决哪一类问题的</h2> <p><code>Keys</code> 是 <code>React</code> 用于追踪哪些列表中元素被修改、被添加或者被移除的辅助标识。在开发过程中，我们需要保证某个元素的 <code>key</code> 在其同级元素中具有唯一性。</p> <p>在 <code>React Diff</code> 算法中 <code>React</code> 会借助元素的 <code>Key</code> 值来判断该元素是新近创建的还是被移动而来的元素，从而减少不必要的元素重渲染此外，<code>React</code> 还需要借助 <code>Key</code> 值来判断元素与本地状态的关联关系。</p> <p>注意事项：</p> <ul><li><code>key</code> 值一定要和具体的元素—一对应；</li> <li>尽量不要用数组的 <code>index</code> 去作为 <code>key</code>；</li> <li>不要在 <code>render</code> 的时候用随机数或者其他操作给元素加上不稳定的<code>key</code>，这样造成的性能开销比不加<code>key</code>的情况下更糟糕。</li></ul> <h2 id="虚拟-dom-的引入与直接操作原生-dom-相比-哪一个效率更高-为什么"><a href="#虚拟-dom-的引入与直接操作原生-dom-相比-哪一个效率更高-为什么" class="header-anchor">#</a> 虚拟 <code>DOM</code> 的引入与直接操作原生 <code>DOM</code> 相比，哪一个效率更高，为什么</h2> <p>虚拟<code>DOM</code>相对原生的<code>DOM</code>不一定是效率更高，如果只修改一个按钮的文案，那么虚拟 <code>DOM</code> 的操作无论如何都不可能比真实的 <code>DOM</code> 操作更快。在首次渲染大量 <code>DOM</code> 时，由于多了一层虚拟 <code>DOM</code> 的计算，虚拟<code>DOM</code>也会比<code>innerHTML</code>插入慢。它能保证性能下限，在真实<code>DOM</code>操作的时候进行针对性的优化时，还是更快的。所以要根据具体的场景进行探讨。</p> <p>在整个 <code>DOM</code> 操作的演化过程中，其实主要矛盾并不在于性能，而在于开发者写得爽不爽，在于研发体验/研发效率。虚拟 <code>DOM</code> 不是别的，正是前端开发们为了追求更好的研发体验和研发效率而创造出来的高阶产物。虚拟 <code>DOM</code> 并不一定会带来更好的性能，<code>React</code> 官方也从来没有把虚拟 <code>DOM</code> 作为性能层面的卖点对外输出过。</p> <p><strong>虚拟 <code>DOM</code> 的优越之处在于，它能够在提供更爽、更高效的研发模式（也就是函数式的 <code>UI</code> 编程方式）的同时，仍然保持一个还不错的性能。</strong></p> <h2 id="react-与-vue-的-diff-算法有何不同"><a href="#react-与-vue-的-diff-算法有何不同" class="header-anchor">#</a> <code>React</code> 与 <code>Vue</code> 的 <code>diff</code> 算法有何不同？</h2> <p><code>diff</code> 算法是指生成更新补丁的方式，主要应用于虚拟 <code>DOM</code> 树变化后，更新真实 <code>DOM</code>。所以 <code>diff</code> 算法一定存在这样一个过程：触发更新 → 生成补丁 → 应用补丁。</p> <p><code>React</code> 的 <code>diff</code> 算法，触发更新的时机主要在 <code>state</code> 变化与 <code>hooks</code> 调用之后。此时触发虚拟 <code>DOM</code> 树变更遍历，采用了深度优先遍历算法。但传统的遍历方式，效率较低。为了优化效率，使用了分治的方式。将单一节点比对转化为了 <code>3</code> 种类型节点的比对，分别是树、组件及元素，以此提升效率。</p> <ul><li>树比对：由于网页视图中较少有跨层级节点移动，两株虚拟 <code>DOM</code> 树只对同一层次的节点进行比较。</li> <li>组件比对：如果组件是同一类型，则进行树比对，如果不是，则直接放入到补丁中。</li> <li>元素比对：主要发生在同层级中，通过标记节点操作生成补丁，节点操作对应真实的 <code>DOM</code> 剪裁操作。</li></ul> <p>以上是经典的 <code>React diff</code> 算法内容。自 <code>React 16</code> 起，引入了 <code>Fiber</code> 架构。为了使整个更新过程可随时暂停恢复，节点与树分别采用了 <code>FiberNode</code> 与 <code>FiberTree</code> 进行重构。<code>fiberNode</code> 使用了双链表的结构，可以直接找到兄弟节点与子节点。整个更新过程由 <code>current</code> 与 <code>workInProgress</code> 两株树双缓冲完成。<code>workInProgress</code> 更新完成后，再通过修改 <code>current</code> 相关指针指向新节点。</p> <p><code>Vue</code> 的整体 <code>diff</code> 策略与 <code>React</code> 对齐，虽然缺乏时间切片能力，但这并不意味着 <code>Vue</code> 的性能更差，因为在 <code>Vue 3</code> 初期引入过，后期因为收益不高移除掉了。除了高帧率动画，在 <code>Vue</code> 中其他的场景几乎都可以使用防抖和节流去提高响应性能。</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/02, 17:04:16</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/6bcb1a/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Hooks</div></a> <a href="/pages/b0c8ad/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">其他</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/6bcb1a/" class="prev">Hooks</a></span> <span class="next"><a href="/pages/b0c8ad/">其他</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/duochizhacai" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://juejin.cn/user/1249486902410744" title="JueJin" target="_blank" class="iconfont icon-juejin"></a></div> 
    Copyright © 2021-2022
    <span><a href='https://beian.miit.gov.cn'>粤ICP备2021165371号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95fc12d6.js" defer></script><script src="/assets/js/2.abf57e2f.js" defer></script><script src="/assets/js/50.b482896d.js" defer></script>
  </body>
</html>
