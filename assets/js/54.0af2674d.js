(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{495:function(s,a,t){"use strict";t.r(a);var e=t(26),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"webpack优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webpack优化"}},[s._v("#")]),s._v(" "),t("code",[s._v("webpack")]),s._v("优化")]),s._v(" "),t("h2",{attrs:{id:"优化-webpack-的构建速度"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化-webpack-的构建速度"}},[s._v("#")]),s._v(" "),t("strong",[s._v("优化 Webpack 的构建速度")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("使用高版本的 "),t("code",[s._v("Webpack")]),s._v(" （使用"),t("code",[s._v("webpack4+")]),s._v("）")])]),s._v(" "),t("li",[t("p",[s._v("多线程/多实例构建："),t("code",[s._v("HappyPack")]),s._v("(不维护了)、"),t("code",[s._v("thread-loader")])])]),s._v(" "),t("li",[t("p",[s._v("缩小打包作用域：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("exclude/include")]),s._v(" (确定 "),t("code",[s._v("loader")]),s._v(" 规则范围)")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("resolve.modules")]),s._v(" 指明第三方模块的绝对路径 (减少不必要的查找)")]),s._v(" "),t("p",[t("code",[s._v("resolve.extensions")]),s._v(" 尽可能减少后缀尝试的可能性")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("noParse")]),s._v(" 对完全不需要解析的库进行忽略 (不去解析但仍会打包到 "),t("code",[s._v("bundle")]),s._v(" 中，注意被忽略掉的文件里不应该包含 "),t("code",[s._v("import")]),s._v("、"),t("code",[s._v("require")]),s._v("、"),t("code",[s._v("define")]),s._v(" 等模块化语句)")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("IgnorePlugin")]),s._v(" (完全排除模块)")])]),s._v(" "),t("li",[t("p",[s._v("合理使用"),t("code",[s._v("alias")])])])])]),s._v(" "),t("li",[t("p",[s._v("充分利用缓存提升二次构建速度：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("babel-loader")]),s._v(" 开启缓存")]),s._v(" "),t("li",[t("code",[s._v("terser-webpack-plugin")]),s._v(" 开启缓存")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("cache-loader")]),s._v(" 或者 "),t("code",[s._v("hard-source-webpack-plugin")]),s._v(" "),t("strong",[s._v("注意")]),s._v("："),t("code",[s._v("thread-loader")]),s._v(" 和 "),t("code",[s._v("cache-loader")]),s._v(" 两个要一起使用的话，请先放 "),t("code",[s._v("cache-loader")]),s._v(" 接着是 "),t("code",[s._v("thread-loader")]),s._v(" 最后才是 "),t("code",[s._v("heavy-loader")])])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("DLL")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("使用 "),t("code",[s._v("DllPlugin")]),s._v(" 进行分包，使用 "),t("code",[s._v("DllReferencePlugin")]),s._v("(索引链接) 对 "),t("code",[s._v("manifest.json")]),s._v(" 引用，让一些基本不会改动的代码先打包成静态资源，避免反复编译浪费时间。")])])])]),s._v(" "),t("p",[s._v("2）使用"),t("code",[s._v("webpack4-")]),s._v("优化原因")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("V8")]),s._v("带来的优化（"),t("code",[s._v("for of")]),s._v("替代"),t("code",[s._v("forEach")]),s._v("、"),t("code",[s._v("Map")]),s._v("和"),t("code",[s._v("Set")]),s._v("替代"),t("code",[s._v("Object")]),s._v("、"),t("code",[s._v("includes")]),s._v("替代"),t("code",[s._v("indexOf")]),s._v("）")]),s._v(" "),t("li",[s._v("默认使用更快的"),t("code",[s._v("md4 hash算法")])]),s._v(" "),t("li",[t("code",[s._v("webpacks AST")]),s._v("可以直接从"),t("code",[s._v("loader")]),s._v("传递给"),t("code",[s._v("AST")]),s._v("，减少解析时间")]),s._v(" "),t("li",[s._v("使用字符串方法替代正则表达式")])]),s._v(" "),t("p",[s._v("①"),t("code",[s._v("noParse")])]),s._v(" "),t("ul",[t("li",[s._v("不去解析某个库内部的依赖关系")]),s._v(" "),t("li",[s._v("比如"),t("code",[s._v("jquery")]),s._v(" 这个库是独立的， 则不去解析这个库内部依赖的其他的东西")]),s._v(" "),t("li",[s._v("在独立库的时候可以使用")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    noParse"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("jquery")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("②"),t("code",[s._v("IgnorePlugin")])]),s._v(" "),t("ul",[t("li",[s._v("忽略掉某些内容 不去解析依赖库内部引用的某些内容")]),s._v(" "),t("li",[s._v("从"),t("code",[s._v("moment")]),s._v("中引用 "),t("code",[s._v("./local")]),s._v(" 则忽略掉")]),s._v(" "),t("li",[s._v("如果要用"),t("code",[s._v("local")]),s._v("的话 则必须在项目中必须手动引入")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'moment/locale/zh-cn'")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Webpack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IgnorePlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("moment")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("③"),t("code",[s._v("dillPlugin")])]),s._v(" "),t("ul",[t("li",[s._v("不会多次打包， 优化打包时间")]),s._v(" "),t("li",[s._v("先把依赖的不变的库打包")]),s._v(" "),t("li",[s._v("生成 "),t("code",[s._v("manifest.json")]),s._v("文件")]),s._v(" "),t("li",[s._v("然后在"),t("code",[s._v("webpack.config")]),s._v("中引入")]),s._v(" "),t("li",[t("code",[s._v("webpack.DllPlugin Webpack.DllReferencePlugin")])])]),s._v(" "),t("p",[s._v("④"),t("code",[s._v("happypack -> thread-loader")])]),s._v(" "),t("ul",[t("li",[s._v("大项目的时候开启多线程打包")]),s._v(" "),t("li",[s._v("影响前端发布速度的有两个方面，一个是构建，一个就是压缩，把这两个东西优化起来，可以减少很多发布的时间。")])]),s._v(" "),t("p",[s._v("⑤"),t("code",[s._v("thread-loader")]),s._v(" "),t("code",[s._v("thread-loader")]),s._v(" 会将您的 "),t("code",[s._v("loader")]),s._v(" 放置在一个 "),t("code",[s._v("worker")]),s._v(" 池里面运行，以达到多线程构建。\n把这个 "),t("code",[s._v("loader")]),s._v(" 放置在其他 "),t("code",[s._v("loader")]),s._v(" 之前（如下图 "),t("code",[s._v("example")]),s._v(" 的位置）， 放置在这个 "),t("code",[s._v("loader")]),s._v(" 之后的 "),t("code",[s._v("loader")]),s._v(" 就会在一个单独的 "),t("code",[s._v("worker")]),s._v(" 池("),t("code",[s._v("worker pool")]),s._v(")中运行。")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack.config.js")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v(".js$")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        include"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        use"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread-loader"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 你的高开销的loader放置在此 (e.g babel-loader)")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("每个 "),t("code",[s._v("worker")]),s._v(" 都是一个单独的有 "),t("code",[s._v("600ms")]),s._v(" 限制的 "),t("code",[s._v("node.js")]),s._v(" 进程。同时跨进程的数据交换也会被限制。请在高开销的"),t("code",[s._v("loader")]),s._v("中使用，否则效果不佳")]),s._v(" "),t("p",[s._v("⑥压缩加速——开启多线程压缩")]),s._v(" "),t("ul",[t("li",[s._v("不推荐使用 "),t("code",[s._v("webpack-paralle-uglify-plugin")]),s._v("，项目基本处于没人维护的阶段，"),t("code",[s._v("issue")]),s._v(" 没人处理，"),t("code",[s._v("pr")]),s._v("没人合并。\n"),t("code",[s._v("Webpack 4.0")]),s._v("以前："),t("code",[s._v("uglifyjs-webpack-plugin")]),s._v("，"),t("code",[s._v("parallel")]),s._v("参数")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  optimization"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    minimizer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UglifyJsPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        parallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("推荐使用 "),t("code",[s._v("terser-webpack-plugin")])])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  optimization"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    minimizer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TerserPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      parallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 多线程")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"优化-webpack-的打包体积"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化-webpack-的打包体积"}},[s._v("#")]),s._v(" 优化 Webpack 的打包体积")]),s._v(" "),t("ul",[t("li",[s._v("压缩代码")]),s._v(" "),t("li",[s._v("提取页面公共资源：")]),s._v(" "),t("li",[t("code",[s._v("Tree shaking")])]),s._v(" "),t("li",[t("code",[s._v("Scope hoisting")])]),s._v(" "),t("li",[s._v("图片压缩")]),s._v(" "),t("li",[s._v("动态"),t("code",[s._v("Polyfill")])])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("speed-measure-webpack-plugin")])]),s._v(" 简称 "),t("code",[s._v("SMP")]),s._v("，分析出 "),t("code",[s._v("Webpack")]),s._v(" 打包过程中 "),t("code",[s._v("Loader")]),s._v(" 和 "),t("code",[s._v("Plugin")]),s._v(" 的耗时，有助于找到构建过程中的性能瓶颈。 "),t("strong",[s._v("开发阶段")])]),s._v(" "),t("p",[s._v("开启多核压缩 插件： "),t("code",[s._v("terser-webpack-plugin")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" TerserPlugin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'terser-webpack-plugin'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    optimization"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        minimizer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TerserPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                parallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                terserOptions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    ecma"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h2",{attrs:{id:"gzip优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gzip优化"}},[s._v("#")]),s._v(" "),t("code",[s._v("Gzip")]),s._v("优化")]),s._v(" "),t("p",[s._v("这里不再赘述"),t("code",[s._v("Gzip")]),s._v("具体配置")]),s._v(" "),t("p",[s._v("具体讲讲"),t("code",[s._v("gzip")]),s._v("的压缩原理")]),s._v(" "),t("ol",[t("li",[t("strong",[t("code",[s._v("gzip")]),s._v("的压缩算法")])])]),s._v(" "),t("p",[t("code",[s._v("gzip")]),s._v("中间的文件体，使用的是"),t("code",[s._v("Deflate")]),s._v("算法，这是一种无损压缩解压算法。"),t("code",[s._v("Deflate")]),s._v("是"),t("code",[s._v("zip")]),s._v("压缩文件的默认算法，"),t("code",[s._v("7z")]),s._v("，"),t("code",[s._v("xz")]),s._v("等其他的压缩文件中都有用到，实际上"),t("code",[s._v("deflate")]),s._v("只是一种压缩数据流的算法. 任何需要流式压缩的地方都可以用。")]),s._v(" "),t("p",[t("code",[s._v("Deflate")]),s._v("算法进行压缩时，一般先用 "),t("strong",[t("code",[s._v("Lz77")]),s._v("算法压缩")]),s._v("，再使用 "),t("strong",[t("code",[s._v("Huffman")]),s._v("编码")]),s._v("。")]),s._v(" "),t("div",{staticClass:"custom-block theorem"},[t("p",{staticClass:"title"},[s._v("Lz77算法原理")]),t("p",[s._v("如果文件中有两块内容相同的话，我们可以用两者之间的距离，相同内容的长度这样一对信息，来替换后一块内容。由于两者之间的距离，相同内容的长度这一对信息的大小，小于被替换内容的大小，所以文件得到了压缩。")])]),t("p",[s._v("举个例子：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://www.`baidu`.com` `https://www.`taobao`.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("上面一段文本可以看到，前后有部分内容是相同的，我们可以用前文相同内容的距离和相同字符长度替换后文的内容。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://www.`baidu`.com` `(21,12)`taobao`(23,4)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("Deflate")]),s._v("采用的"),t("code",[s._v("Lz77")]),s._v("算法是经过改进的版本，首先"),t("mark",[t("strong",[s._v("三个字节以上")])]),s._v("的重复串才进行偏码，否则不进行编码。")]),s._v(" "),t("p",[s._v("其次匹配查找的时候用了哈希表，一个"),t("code",[s._v("head")]),s._v("数组记录最近匹配的位置和"),t("code",[s._v("prev")]),s._v("链表来记录哈希值冲突的之前的匹配位置。")]),s._v(" "),t("p",[s._v("而"),t("code",[s._v("Huffman")]),s._v("编码，只大概了解是通过字符出现概率，将高频字符用较短字节进行表示从而达到字符串的压缩。("),t("code",[s._v("http2")]),s._v("头信息压缩就用到了"),t("RouterLink",{attrs:{to:"/pages/2448f7/#http2头部压缩算法如何实现"}},[s._v("哈夫曼编码")]),s._v(")")],1),s._v(" "),t("p",[t("strong",[s._v("问题：但是为什么图片不适合用于"),t("code",[s._v("gzip")]),s._v("压缩")])]),s._v(" "),t("p",[t("code",[s._v("gzip")]),s._v("是一个压缩程序而并不是一个算法，经过"),t("code",[s._v("gzip")]),s._v("压缩后文件格式为"),t("code",[s._v(".gz")]),s._v("，我们对"),t("code",[s._v(".gz")]),s._v("文件进行分析。")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("node")]),s._v("的"),t("code",[s._v("fs")]),s._v("模块去读取一个"),t("code",[s._v("gz")]),s._v("压缩包可以看到如下一段"),t("code",[s._v("Buffer")]),s._v("内容：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" fs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readFile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vds.gz"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// <Buffer 1f 8b 08 00 00 00 00 00 00 0a  ... >")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("通常"),t("code",[s._v("gz")]),s._v("压缩包有"),t("strong",[s._v("文件头，文件体和文件尾")]),s._v("三个部分。")]),s._v(" "),t("p",[s._v("头尾专门用来存储一些文件相关信息，比如我们看到上面的"),t("code",[s._v("Buffer")]),s._v("数据，第一二个字节为"),t("code",[s._v("1f 8b")]),s._v("（"),t("code",[s._v("16")]),s._v("进制），通常第一二字节为"),t("code",[s._v("1f 8b")]),s._v("就可以初步判断这是一个"),t("code",[s._v("gz")]),s._v("压缩包，但是具体还是要看是否完全符合"),t("code",[s._v("gz")]),s._v("文件格式，第三个字节取值范围是"),t("code",[s._v("0")]),s._v("到"),t("code",[s._v("8")]),s._v("，目前只用"),t("code",[s._v("8")]),s._v("，表示使用的是"),t("code",[s._v("Deflate")]),s._v("压缩算法。还有一些比如修改时间，压缩执行的文件系统等信息也会在文件头。")]),s._v(" "),t("p",[s._v("而文件尾会标识出一些原始数据大小的相关信息，被压缩的数据则是放在中间的文件体。")]),s._v(" "),t("p",[t("strong",[s._v("而对于已经压缩过的图片使用"),t("code",[s._v("gzip")]),s._v("体积变大是因为中间的压缩体并没有怎么压缩，却添加了头尾的压缩相关信息")])]),s._v(" "),t("p",[t("strong",[s._v("派生："),t("code",[s._v("brotli")]),s._v("压缩")])]),s._v(" "),t("div",{staticClass:"custom-block theorem"},[t("p",{staticClass:"title"},[s._v("概念")]),t("p",[s._v("与常见的通用压缩算法不同，"),t("code",[s._v("Brotli")]),s._v("使用一个预定义的"),t("code",[s._v("120")]),s._v("千字节字典。该字典包含超过"),t("code",[s._v("13000")]),s._v("个常用单词、短语和其他子字符串，这些来自一个文本和"),t("code",[s._v("HTML")]),s._v("文档的大型语料库。预定义的算法可以提升较小文件的压缩密度。使用"),t("code",[s._v("brotli")]),s._v("取代"),t("code",[s._v("deflate")]),s._v("来对文本文件压缩通常可以增加"),t("code",[s._v("20%")]),s._v("的压缩密度，而压缩与解压缩速度则大致不变。")])]),t("p",[s._v("目前该压缩方式大部分浏览器（包括移动端）新版本支持良好，详细的支持情况可在"),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fcaniuse.com%2F%23search%3DBrotli",target:"_blank",rel:"noopener noreferrer"}},[s._v("caniuse"),t("OutboundLink")],1),s._v("查询到。")]),s._v(" "),t("p",[s._v("支持"),t("code",[s._v("Brotli")]),s._v("压缩算法的浏览器使用的内容编码类型为"),t("code",[s._v("br")]),s._v("，例如以下是"),t("code",[s._v("Chrome")]),s._v("浏览器请求头里"),t("code",[s._v("Accept-Encoding")]),s._v("的值：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Accept-Encoding: gzip, deflate, sdch, br\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果服务端支持"),t("code",[s._v("Brotli")]),s._v("算法，则会返回以下的响应头：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Content-Encoding: br\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Tips:"),t("code",[s._v("brotli")]),s._v(" 压缩只能在 "),t("code",[s._v("https")]),s._v(" 中生效，因为 在 "),t("code",[s._v("http")]),s._v(" 请求中 "),t("code",[s._v("request header")]),s._v(" 里的 "),t("code",[s._v("Accept-Encoding: gzip, deflate")]),s._v(" 是没有 "),t("code",[s._v("br")]),s._v(" 的。")])])}),[],!1,null,null,null);a.default=n.exports}}]);