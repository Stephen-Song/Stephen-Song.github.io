(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{455:function(t,s,a){"use strict";a.r(s);var n=a(26),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"情景题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#情景题"}},[t._v("#")]),t._v(" 情景题")]),t._v(" "),a("h2",{attrs:{id:"当在浏览器输入google-com回车之后会发生什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#当在浏览器输入google-com回车之后会发生什么"}},[t._v("#")]),t._v(" 当在浏览器输入"),a("code",[t._v("google.com")]),t._v("回车之后会发生什么"),a("badge",{attrs:{text:"本博客最重要的一个问题",type:"error"}})],1),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081153220.png",alt:""}})]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在回车之前，会执行一次当前页面的"),a("code",[t._v("beforeunload")]),t._v("事件，可以让页面退出之前执行一些数据清理工作，或者，有表单没有提交的情况提示用户是否确认离开")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("缓存判断")]),t._v(" 判断资源是否存在缓存中，若在缓存且没有失效，就直接使用，否则向服务器发起新请求")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("这里的缓存主要指的是")]),t._v(" "),a("ul",[a("li",[t._v("如果是"),a("code",[t._v("https")]),t._v("的话，有可能先找"),a("code",[t._v("Service Worker")]),t._v("，比如你设置了请求拦截，离线缓存的话")]),t._v(" "),a("li",[t._v("如果没有，再找浏览器的"),a("strong",[t._v("内存缓存")]),t._v("（"),a("code",[t._v("Memory Cache")]),t._v(")")]),t._v(" "),a("li",[t._v("如果还没有，再找"),a("strong",[t._v("硬盘缓存")]),t._v("（"),a("code",[t._v("Disk Cache")]),t._v("）（ 强缓存和协商缓存都属于硬盘缓存）")]),t._v(" "),a("li",[t._v("如果这三种都没有找到，请求还是"),a("code",[t._v("http2")]),t._v("的话，还可能会查找"),a("strong",[t._v("推送缓存")]),t._v("（"),a("code",[t._v("Push Cache")]),t._v(")，就是找"),a("code",[t._v("Session")]),t._v("（"),a("code",[t._v("Session")]),t._v("会话结束就会释放，所以存在时间很短）")])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("解析"),a("code",[t._v("URL")])]),t._v(" 对"),a("code",[t._v("URL")]),t._v("进行解析，分析所用的"),a("strong",[t._v("传输协议")]),t._v(" "),a("strong",[t._v("域名")]),t._v(" "),a("strong",[t._v("端口")]),t._v(" "),a("strong",[t._v("资源路径")]),t._v("，如果不合法，就传递给"),a("strong",[t._v("搜索引擎")]),t._v("，如果没问题，浏览器检查"),a("code",[t._v("URL")]),t._v("是否出现非法字符，若有则进行转义")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("DNS")]),t._v("解析")])]),t._v(" "),a("ul",[a("li",[t._v("首先在浏览器缓存中查找对应的"),a("code",[t._v("IP")]),t._v(" 地址，如果查到就直接返回，查不到就下一步")]),t._v(" "),a("li",[t._v("将请求发给本地"),a("code",[t._v("dns")]),t._v("服务器，在本地域名服务器查询，如果查到直接返回，差不到就下一步")]),t._v(" "),a("li",[t._v("本地"),a("code",[t._v("dns")]),t._v("服务器向根域名服务器发送请求，根域名服务器返回一个所查询域的顶级服务器地址")]),t._v(" "),a("li",[t._v("本地"),a("code",[t._v("dns")]),t._v("向顶级域名服务器发送请求，接收请求的服务器查询自己的缓存，如果有记录就返回查询结果，没有就返回下一级的权威域名服务器地址")]),t._v(" "),a("li",[t._v("本地"),a("code",[t._v("dns")]),t._v("向权威域名服务器请求，域名服务器返回对应结果")]),t._v(" "),a("li",[t._v("本地"),a("code",[t._v("dns")]),t._v("将结果保存在缓存中，便于下次使用")]),t._v(" "),a("li",[t._v("将结果返回给浏览器")])])])]),t._v(" "),a("ul",[a("li",[t._v("(用户向本地"),a("code",[t._v("dns")]),t._v("服务器发起请求是递归请求，本地"),a("code",[t._v("dns")]),t._v("向各级域名服务器发起的请求是迭代请求)")])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("服务器作用笔记")]),t._v(" "),a("ul",[a("li",[t._v("根域名服务器：离用户较近，当所要查询的主机也属于同一个本地"),a("code",[t._v("ISP")]),t._v("时，该本地域名服务器立即就能将所查询的主机名转换为它的"),a("code",[t._v("IP")]),t._v("地址，而不需要再去询问其他的域名服务器。")]),t._v(" "),a("li",[t._v("根域名服务器：最高层次、最重要的服务器，所有的根域名服务器都知道所有的顶级域名服务器的域名和"),a("code",[t._v("IP")]),t._v("地址。不管是哪一个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析，就首先求助于根域名服务器")]),t._v(" "),a("li",[t._v("顶级域名服务器: 负责管理在该顶级域名服务器注册的所有二级域名。当收到"),a("code",[t._v("DNS")]),t._v("查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当找的域名服务器的"),a("code",[t._v("IP")]),t._v("地址）。")]),t._v(" "),a("li",[t._v("权限域名服务器是负责一个区的域名服务器，用来保存该区中的所有主机的域名到"),a("code",[t._v("IP")]),t._v("地址的映射。当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的"),a("code",[t._v("DNS")]),t._v("客户，下一步应当找哪一个权限域名服务器。")])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("值得注意的是")]),t._v(" "),a("ul",[a("li",[t._v("如果没有配置"),a("code",[t._v("CDN")]),t._v("，就直接返回解析到的"),a("code",[t._v("IP")])]),t._v(" "),a("li",[t._v("如果有配置"),a("code",[t._v("CDN")]),t._v("，权威域名会返回一个"),a("RouterLink",{attrs:{to:"/pages/f15087/#cdn工作原理"}},[t._v("CName")]),t._v("别名记录，它指向"),a("code",[t._v("CDN")]),t._v("网络中的智能"),a("code",[t._v("DNS")]),t._v("负载均衡系统，然后负载均衡系统通过智能算法，将最佳"),a("code",[t._v("CDN")]),t._v("节点的"),a("code",[t._v("IP")]),t._v("返回")],1)])]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[a("p",[a("strong",[t._v("获取"),a("code",[t._v("MAC")]),t._v("地址")]),t._v(" 当浏览器得到"),a("code",[t._v("ip")]),t._v("地址时，数据传输还得知道"),a("code",[t._v("mac")]),t._v("地址，数据是从"),a("strong",[t._v("应用层")]),t._v("下发到"),a("strong",[t._v("传输层")]),t._v("，"),a("code",[t._v("tcp")]),t._v("会指定"),a("strong",[t._v("源端口号")]),t._v("和"),a("strong",[t._v("目的端口号")]),t._v("，然后下发给网络层，网络层将本地"),a("code",[t._v("ip")]),t._v("作为源地址，获取的"),a("code",[t._v("ip")]),t._v("作为目的"),a("code",[t._v("ip")]),t._v("，然后下发给数据链路层，数据链路层要加入通信双方的"),a("code",[t._v("mac")]),t._v("地址，本地"),a("code",[t._v("mac")]),t._v("作为源"),a("code",[t._v("mac")]),t._v("地址，目的"),a("code",[t._v("mac")]),t._v("地址分情况处理，通过"),a("code",[t._v("ip")]),t._v("地址与本地子网掩码相与，判断是否和请求主机处于同一个子网，如果在同一子网，用"),a("code",[t._v("ARP")]),t._v("协议获得目的主机的"),a("code",[t._v("mac")]),t._v("地址，如果不在，请求转发给网关，由他来转发，此时同样可以通过"),a("code",[t._v("arp")]),t._v("协议获得网关的"),a("code",[t._v("mac")]),t._v("地址，此时目的主机的"),a("code",[t._v("mac")]),t._v("地址为网关的地址")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("TCP")]),t._v("三次握手")]),t._v(" 下面是 "),a("code",[t._v("TCP")]),t._v(" 建立连接的三次握手的过程。")])])]),t._v(" "),a("ul",[a("li",[t._v("首先客户端向服务器发送一个 "),a("code",[t._v("SYN")]),t._v("连接请求报文段和一个随机序号，进入"),a("code",[t._v("SYN-SENT")]),t._v("状态")]),t._v(" "),a("li",[t._v("服务端接收到请求后向客户端发送一个 "),a("code",[t._v("SYN ACK")]),t._v("报文段，确认连接请求，并且也向客户端发送一个随机序号,进入"),a("code",[t._v("LISTEN")]),t._v("状态")]),t._v(" "),a("li",[t._v("客户端接收服务器的确认应答后，进入连接建立的状态，同时向服务器也发送一个"),a("code",[t._v("ACK")]),t._v("确认报文段,进入"),a("code",[t._v("ESTABLISH")]),t._v("状态")]),t._v(" "),a("li",[t._v("服务器端接收到确认后，也进入连接建立状态，此时双方的连接就建立起来了,也进入"),a("code",[t._v("ESTABLISH")]),t._v("状态\n"),a("ul",[a("li",[a("strong",[t._v("两次握手不行的简单原因")]),t._v("：服务器就没有办法知道自己的序号是否 已被确认，防止失效的连接请求报文段突然又传送到主机"),a("code",[t._v("B")]),t._v("。")])])])]),t._v(" "),a("ol",{attrs:{start:"7"}},[a("li",[a("strong",[a("code",[t._v("HTTPS")]),t._v("握手")]),t._v(" 通信还存在"),a("code",[t._v("TLS")]),t._v("的四次挥手")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("首先客户端向服务端发送"),a("strong",[t._v("协议的版本号")]),t._v("、"),a("strong",[t._v("一个随机数")]),t._v("和可以使用的"),a("strong",[t._v("加密方法")])])]),t._v(" "),a("li",[a("p",[t._v("服务器收到后确认加密方法，向客户端发送一个"),a("strong",[t._v("随机数")]),t._v("和"),a("strong",[t._v("自己的数字证书")])])]),t._v(" "),a("li",[a("p",[t._v("客户端收到后检查数字证书是否有效，有效的话再生成一个"),a("strong",[t._v("随机数")]),t._v("，使用证书的公钥对"),a("strong",[t._v("随机数加密")]),t._v(" 然后发给服务端，并且会提供一个"),a("strong",[t._v("前面所有内容的"),a("code",[t._v("hash")]),t._v("值给服务器检验")])])]),t._v(" "),a("li",[a("p",[t._v("服务器接收后用私钥对"),a("strong",[t._v("数据解密")]),t._v("，同时"),a("strong",[t._v("向客户端发送一个前面所有内容的"),a("code",[t._v("hash")]),t._v("值供客户端检验")]),t._v("，双方这时有三个随机数，按之前的加密方法，使用"),a("strong",[t._v("这三个随机数生成一把密钥")]),t._v("，以后双方传输数据时用这个密钥加密再传输")])])]),t._v(" "),a("ol",{attrs:{start:"8"}},[a("li",[a("p",[a("strong",[t._v("返回数据")]),t._v(" 当页面请求发到服务端，服务端会返回一个"),a("code",[t._v("html")]),t._v("文件作为响应，浏览器接到响应 对"),a("code",[t._v("html")]),t._v("进行解析，开始页面渲染")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("TCP")]),t._v("四次挥手")]),t._v(" 最后一步是"),a("code",[t._v("TCP")]),t._v(" 断开连接的四次挥手过程。")])])]),t._v(" "),a("ul",[a("li",[t._v("若客户端认为数据发送完成，则它需要向服务端发送连接释放请求，进入"),a("code",[t._v("FIN_WAIT1")]),t._v(" 状态。")]),t._v(" "),a("li",[t._v("服务端收到连接释放请求后，会告诉应用层要释放"),a("code",[t._v("TCP")]),t._v(" 链接。然后会发送 "),a("code",[t._v("ACK")]),t._v(" 包，并进入 "),a("code",[t._v("CLOSE_WAIT")]),t._v(" 状态，此时表明客户端到服务端的连接已经释放，不再接收客户端发的数据了。"),a("strong",[t._v("但是因为 "),a("code",[t._v("TCP")]),t._v("连接是双向的，所以服务端仍旧可以发送数据给客户端，")]),t._v(" 此时服务端处于"),a("code",[t._v("CLOSE_WAIT")]),t._v(",客户端收到确认报文后处于"),a("code",[t._v("FIN_WAIT2")]),t._v("状态")]),t._v(" "),a("li",[t._v("服务端如果此时还有没发完的数据会继续发送，完毕后会向客户端发送连接释放请求，然后服务端便进入 "),a("code",[t._v("LAST-ACK")]),t._v(" 状态")]),t._v(" "),a("li",[t._v("客户端收到释放请求后，向服务端发送确认应答，此时客户端进入 "),a("code",[t._v("TIME-WAIT")]),t._v("状态。该状态会持续 "),a("code",[t._v("2MSL")]),t._v("（"),a("mark",[t._v("最大段生存期，指报文段在网络中生存的时间，超时会被抛弃")]),t._v("） 时间，若该时间段内没有服务端的重发请求的话，就进入"),a("code",[t._v("CLOSED")]),t._v(" 状态。")]),t._v(" "),a("li",[t._v("当服务端收到确认应答后，也便进入 "),a("code",[t._v("CLOSED")]),t._v(" 状态。\n"),a("ul",[a("li",[t._v("四次挥手简单原因：服务端还没发完消息")]),t._v(" "),a("li",[t._v("等待"),a("code",[t._v("2MSL")]),t._v("简单原因是：防止发送给服务器的确认报文段丢失或者出错,从而导致服务器 端不能正常关闭。")])])])]),t._v(" "),a("ol",{attrs:{start:"10"}},[a("li",[a("strong",[t._v("解析响应数据")])])]),t._v(" "),a("p",[t._v("如果返回的状态码是"),a("code",[t._v("301")]),t._v("或"),a("code",[t._v("302")]),t._v("就需要"),a("code",[t._v("重定向")]),t._v("到其他"),a("code",[t._v("URL")]),t._v("，在重定向地址会在响应头的"),a("code",[t._v("Location")]),t._v("字段中，然后一切从头开始，否则然后根据情况选择关闭"),a("code",[t._v("TCP")]),t._v("连接或者保留重用")]),t._v(" "),a("p",[t._v("然后网络线程会通过"),a("code",[t._v("SafeBrowsing")]),t._v("来检查站点是不是恶意站点，如果是就展示警告页面，告诉你这个站点有安全问题，浏览器会阻止访问，当然也可以强行继续访问。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[a("code",[t._v("SafeBrowsing")])]),t._v(" 是谷歌内部的一套站点安全系统，通过检查该站点的数据来判断是不是安全，比如通过查看该站点的"),a("code",[t._v("IP")]),t._v("有没有在谷歌黑名单中，如果是"),a("code",[t._v("Chrome")]),t._v("浏览器的话")])]),t._v(" "),a("p",[t._v("响应成功返回状态码"),a("code",[t._v("2xx")]),t._v("，然后判断资源能不能缓存，如果可以就"),a("code",[t._v("先缓存")]),t._v("起来")]),t._v(" "),a("p",[t._v("然后对响应解码，比如"),a("code",[t._v("gzip压缩")]),t._v("，然后根据资源类型("),a("code",[t._v("Content-Type")]),t._v(")决定如何处理，如果浏览器判断是下载文件，那么请求会被提交给浏览器的"),a("code",[t._v("下载管理器")]),t._v("，同时"),a("code",[t._v("URL")]),t._v("请求流程就结束了")]),t._v(" "),a("p",[t._v("否则网络线程会通知"),a("code",[t._v("UI")]),t._v("线程，然后"),a("code",[t._v("UI")]),t._v("线程会创建一个渲染器进程来准备渲染页面")]),t._v(" "),a("p",[t._v("然后浏览器进程通过"),a("code",[t._v("IPC")]),t._v("管道将数据传给渲染器进程的主线程，准备"),a("code",[t._v("渲染流程")])]),t._v(" "),a("blockquote",[a("p",[t._v("默认情况下会为每一个标签页配置一个渲染进程，但是也有例外，比如从"),a("code",[t._v("A")]),t._v("页面里面打开一个新的页面"),a("code",[t._v("B")]),t._v("页面，而"),a("code",[t._v("A")]),t._v("页面和"),a("code",[t._v("B")]),t._v("页面又属于同一站点的话，"),a("code",[t._v("A")]),t._v("和"),a("code",[t._v("B")]),t._v("就共用一个渲染进程，其他情况就为"),a("code",[t._v("B")]),t._v("创建一个新的渲染进程")])]),t._v(" "),a("p",[t._v("渲染进程收到确认消息后，会和网络进程建立传输数据的管道，开始执行解析数据、下载资源等")]),t._v(" "),a("p",[a("strong",[t._v("为什么进入新页面，之前的页面不会立马消失，而是要加载一会才会更新的原因")])]),t._v(" "),a("ul",[a("li",[t._v("因为这时候的旧的文档还在网络进程中，渲染进程准备好了之后，渲染进程会向浏览器进程发出提交文档的消息")]),t._v(" "),a("li",[t._v("浏览器进程收到后会开始清理当前的旧页面的文档，然后发出确认消息给渲染进程，同时浏览器更新浏览器界面(安全状态、"),a("code",[t._v("URL")]),t._v("、前进后退历史状态)并更新页面（此时是空白页）")])]),t._v(" "),a("ol",{attrs:{start:"11"}},[a("li",[a("strong",[t._v("页面渲染")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081158120.png",alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("渲染进程将 "),a("code",[t._v("HTML")]),t._v(" 内容转换为能够读懂 "),a("code",[t._v("DOM")]),t._v(" 树结构。")])]),t._v(" "),a("li",[a("p",[t._v("渲染引擎将 "),a("code",[t._v("CSS")]),t._v(" 样式表转化为浏览器可以理解的 "),a("code",[t._v("styleSheets")]),t._v("，计算出 "),a("code",[t._v("DOM")]),t._v(" 节点的样式。")])]),t._v(" "),a("li",[a("p",[t._v("创建布局树，并计算元素的布局信息。")])]),t._v(" "),a("li",[a("p",[t._v("对布局树进行分层，并生成分层树。")])]),t._v(" "),a("li",[a("p",[t._v("为每个图层生成绘制列表，并将其提交到合成线程。合成线程将图层分图块，并栅格化将图块转换成位图。")])]),t._v(" "),a("li",[a("p",[t._v("合成线程发送绘制图块命令给浏览器进程。浏览器进程根据指令生成页面，并显示到显示器上")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("p",[t._v("其中的构建"),a("code",[t._v("dom")]),t._v("树的过程如下")]),t._v(" "),a("ul",[a("li",[t._v("转码（"),a("code",[t._v("Bytes -> Characters")]),t._v("）—— 读取接收到的 "),a("code",[t._v("HTML")]),t._v(" 二进制数据，按指定编码格式将字节转换为 "),a("code",[t._v("HTML")]),t._v(" 字符串")]),t._v(" "),a("li",[a("code",[t._v("Tokens")]),t._v(" 化（"),a("code",[t._v("Characters -> Tokens")]),t._v("）—— 解析 "),a("code",[t._v("HTML")]),t._v("，将 "),a("code",[t._v("HTML")]),t._v(" 字符串转换为结构清晰的 "),a("code",[t._v("Tokens")]),t._v("，每个 "),a("code",[t._v("Token")]),t._v(" 都有特殊的含义同时有自己的一套规则")]),t._v(" "),a("li",[t._v("构建 "),a("code",[t._v("Nodes")]),t._v("（"),a("code",[t._v("Tokens -> Nodes")]),t._v("）—— 每个 "),a("code",[t._v("Node")]),t._v(" 都添加特定的属性（或属性访问器）也叫词法分析：将"),a("code",[t._v("token")]),t._v("转换为对象并定义属性和规则，通过指针能够确定 "),a("code",[t._v("Node")]),t._v(" 的父、子、兄弟关系和所属 "),a("code",[t._v("treeScope")]),t._v("（例如："),a("code",[t._v("iframe")]),t._v(" 的 "),a("code",[t._v("treeScope")]),t._v(" 与外层页面的 "),a("code",[t._v("treeScope")]),t._v(" 不同）")]),t._v(" "),a("li",[t._v("构建 "),a("code",[t._v("DOM")]),t._v(" 树（"),a("code",[t._v("Nodes -> DOM Tree")]),t._v("）—— 最重要的工作是建立起每个结点的父子兄弟关系(解析器会维护一个解析栈，栈底为"),a("code",[t._v("document")]),t._v("，也就是"),a("code",[t._v("DOM")]),t._v("树的根节点,然后根据节点对象关系按顺序依次向解析栈添加，"),a("code",[t._v("形成DOM树")]),t._v(")")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202280936284.png",alt:""}})]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("DOM")]),t._v("树 和 渲染树 的区别：")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("DOM")]),t._v("树与"),a("code",[t._v("HTML")]),t._v("标签一一对应，包括"),a("code",[t._v("head")]),t._v("和隐藏元素")]),t._v(" "),a("li",[t._v("渲染树不包括"),a("code",[t._v("head")]),t._v("和隐藏元素，大段文本的每一个行都是独立节点，每一个节点都有对应的"),a("code",[t._v("css")]),t._v("属性")])]),t._v(" "),a("p",[t._v("样式计算")]),t._v(" "),a("p",[t._v("渲染引擎将 "),a("code",[t._v("CSS")]),t._v(" 样式表转化为浏览器可以理解的 "),a("code",[t._v("styleSheets")]),t._v("，计算出 "),a("code",[t._v("DOM")]),t._v(" 节点的样式。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("值得注意的是")]),t._v(" "),a("p",[a("code",[t._v("CSS")]),t._v("解析和"),a("code",[t._v("DOM")]),t._v("解析是可以同时进行的，但是"),a("code",[t._v("script")]),t._v("执行和"),a("code",[t._v("CSS")]),t._v("解析不能同时进行，"),a("code",[t._v("CSS")]),t._v("会阻塞"),a("code",[t._v("JS")]),t._v("执行")]),t._v(" "),a("p",[t._v("因为"),a("code",[t._v("JS")]),t._v("执行时可能在文档的解析过程中 获取样式信息，如果样式信息没有加载和解析完毕，"),a("code",[t._v("JS")]),t._v("就会得到错误的值，所以会延迟"),a("code",[t._v("JS")]),t._v("执行")])])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("CSS")]),t._v(" 样式来源主要有 "),a("code",[t._v("3")]),t._v(" 种，分别是通过 "),a("code",[t._v("link")]),t._v(" 引用的外部 "),a("code",[t._v("CSS")]),t._v(" 文件、"),a("code",[t._v("style")]),t._v("标签内的 "),a("code",[t._v("CSS")]),t._v("、元素的 "),a("code",[t._v("style")]),t._v(" 属性内嵌的 "),a("code",[t._v("CSS")]),t._v("。")])]),t._v(" "),a("p",[t._v("页面布局")]),t._v(" "),a("blockquote",[a("p",[t._v("布局过程，即"),a("code",[t._v("排除 script、meta 等功能化、非视觉节点")]),t._v("，排除 "),a("code",[t._v("display: none")]),t._v(" 的节点，计算元素的位置信息，确定元素的位置，构建一棵只包含可见元素布局树。如图")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081203608.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("生成分层树")])]),t._v(" "),a("blockquote",[a("p",[t._v("页面中有很多复杂的效果，如一些复杂的 "),a("code",[t._v("3D")]),t._v(" 变换、页面滚动，或者使用 "),a("code",[t._v("z-index")]),t._v(" 做 "),a("code",[t._v("z")]),t._v(" 轴排序等，为了更加方便地实现这些效果，渲染引擎还需要为特定的节点生成专用的图层，并生成一棵对应的图层树（"),a("code",[t._v("LayerTree")]),t._v("）")])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("具体")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("拥有层叠上下文属性的元素，比如：")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("html")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("z-index")]),t._v("不为"),a("code",[t._v("auto")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("position:fixed")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("opacity")]),t._v("小于"),a("code",[t._v("1")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("transform")]),t._v("不为"),a("code",[t._v("none")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("filter不为none")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("-webkit-overflow-scrolling：touch")])])]),t._v(" "),a("li",[a("p",[t._v("有"),a("code",[t._v("裁剪")]),t._v("的地方，比如内容溢出裁剪")])]),t._v(" "),a("li",[a("p",[t._v("不裁剪出现滚动条的话，"),a("code",[t._v("滚动条")]),t._v("也会被提升为单独的层")])])])]),t._v(" "),a("p",[a("strong",[t._v("栅格化")])]),t._v(" "),a("blockquote",[a("p",[t._v("合成线程会按照视口附近的图块来优先生成位图，实际生成位图的操作是由栅格化来执行的。所谓栅格化，是指将"),a("strong",[t._v("图块转换为位图")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202201081205799.png",alt:""}})]),t._v(" "),a("p",[t._v("通常一个页面可能很大，但是用户只能看到其中的一部分，我们把用户可以看到的这个部分叫做视口（"),a("code",[t._v("viewport")]),t._v("）。在有些情况下，有的图层可以很大，比如有的页面你使用滚动条要滚动好久才能滚动到底部，但是通过视口，用户只能看到页面的很小一部分，所以在这种情况下，要绘制出所有图层内容的话，就会产生太大的开销，而且也没有必要。")]),t._v(" "),a("p",[t._v("另外渲染引擎还维护了一个"),a("strong",[t._v("栅格化(光栅化)线程")]),t._v("，合成线程将分割好的图块发送给"),a("code",[t._v("栅格化线程")]),t._v("，然后分别栅格化每个图块，再将栅格化之后的图块存储在"),a("code",[t._v("GPU内存")]),t._v("中")]),t._v(" "),a("p",[t._v("合成器线程能够对不同的栅格化线程做优先处理，所以出现在视口内的图块会被"),a("strong",[t._v("优先栅格化")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202280945979.awebp",alt:""}})])])]),t._v(" "),a("ol",{attrs:{start:"12"}},[a("li",[a("strong",[t._v("合成和显示")]),t._v("：当图块都被栅格化完成后，合成线程会收集栅格化线程的"),a("code",[t._v("draw quads")]),t._v("图块信息，该信息记录了图块在内存中的位置信息和图块在页面中的位置信息")])]),t._v(" "),a("p",[t._v("根据这些信息，合成器线程生成一个合成器帧，然后通过"),a("code",[t._v("IPC")]),t._v("传给浏览器进程")]),t._v(" "),a("p",[t._v("浏览器进程里有个叫 "),a("code",[t._v("viz")]),t._v(" 的组件，用来接收这个合成器帧")]),t._v(" "),a("p",[t._v("然后浏览器进程再将合成器帧绘制到显存中，再通过 "),a("code",[t._v("GPU")]),t._v(" 渲染在屏幕上，这时候终于看到了页面内容")]),t._v(" "),a("p",[t._v("当屏幕内容发生变化，比如滚动了页面，合成器线程就会将栅格化好的层合成一个新的合成器帧，新的帧再传到显存，"),a("code",[t._v("GPU")]),t._v(" 再渲染到页面上")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("延伸")]),t._v(" "),a("p",[a("strong",[t._v("这里可以问到"),a("code",[t._v("transform")]),t._v("不用重排，不会导致卡顿的原因")])]),t._v(" "),a("p",[t._v("刚才的流程我们知道栅格化的整个流程是不占用主线程的，只在合成器线程和栅格线程中运行")]),t._v(" "),a("p",[t._v("这就意味着它不用"),a("code",[t._v("JS")]),t._v("抢主线程，刚才提到反复重绘和重排会导致掉帧，是因为"),a("code",[t._v("JS")]),t._v("阻塞了主线程，而通过"),a("code",[t._v("CSS")]),t._v("中的动画属性"),a("code",[t._v("transform")]),t._v("实现的动画不会经过布局和绘制，而是直接运行在合成器线程和栅格化线程中，所以不会受到主线程"),a("code",[t._v("JS")]),t._v("执行的影响")]),t._v(" "),a("p",[t._v("更重要的是"),a("strong",[t._v("通过"),a("code",[t._v("transform")]),t._v("实现的动画由于不需要经过布局和绘制，样式计算等操作")]),t._v("，所以节省了很多运算时间")])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("补充 两种合成")]),t._v(" "),a("h4",{attrs:{id:"显式合成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显式合成"}},[t._v("#")]),t._v(" 显式合成")]),t._v(" "),a("p",[t._v("下面是"),a("code",[t._v("显式合成")]),t._v("的情况:")]),t._v(" "),a("p",[t._v("一、 拥有"),a("strong",[t._v("层叠上下文")]),t._v("的节点。")]),t._v(" "),a("p",[t._v("层叠上下文也基本上是有一些特定的"),a("code",[t._v("CSS")]),t._v("属性创建的，一般有以下情况:")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("HTML")]),t._v("根元素本身就具有层叠上下文。")]),t._v(" "),a("li",[t._v("普通元素设置 "),a("strong",[a("code",[t._v("position")]),t._v("不为"),a("code",[t._v("static")])]),t._v(" 并且"),a("strong",[t._v("设置了"),a("code",[t._v("z-index")]),t._v("属性")]),t._v("，会产生层叠上下文。")]),t._v(" "),a("li",[t._v("元素的 "),a("strong",[a("code",[t._v("opacity")])]),t._v(" 值不是 "),a("code",[t._v("1")])]),t._v(" "),a("li",[t._v("元素的 "),a("strong",[a("code",[t._v("transform")])]),t._v(" 值不是 "),a("code",[t._v("none")])]),t._v(" "),a("li",[t._v("元素的 "),a("strong",[a("code",[t._v("filter")])]),t._v(" 值不是 "),a("code",[t._v("none")])]),t._v(" "),a("li",[t._v("元素的 "),a("strong",[a("code",[t._v("isolation")])]),t._v(" 值是"),a("code",[t._v("isolate")])]),t._v(" "),a("li",[a("strong",[a("code",[t._v("will-change")])]),t._v(" 指定的属性值为上面任意一个。")])]),t._v(" "),a("p",[t._v("二、需要"),a("strong",[t._v("剪裁")]),t._v("的地方。")]),t._v(" "),a("p",[t._v("比如一个"),a("code",[t._v("div")]),t._v("，你只给他设置 "),a("code",[t._v("100 * 100")]),t._v(" 像素的大小，而你在里面放了非常多的文字，那么超出的文字部分就需要被剪裁。当然如果出现了滚动条，那么滚动条会被单独提升为一个图层。")]),t._v(" "),a("h4",{attrs:{id:"隐式合成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#隐式合成"}},[t._v("#")]),t._v(" 隐式合成")]),t._v(" "),a("p",[t._v("接下来是"),a("code",[t._v("隐式合成")]),t._v("，简单来说就是"),a("code",[t._v("层叠等级低")]),t._v("的节点被提升为单独的图层之后，那么"),a("code",[t._v("所有层叠等级比它高")]),t._v("的节点"),a("strong",[t._v("都会")]),t._v("成为一个单独的图层。")]),t._v(" "),a("p",[t._v("这个隐式合成其实隐藏着巨大的风险，如果在一个大型应用中，当一个"),a("code",[t._v("z-index")]),t._v("比较低的元素被提升为单独图层之后，层叠在它上面的的元素统统都会被提升为单独的图层，可能会增加上千个图层，大大增加内存的压力，甚至直接让页面崩溃。这就是"),a("strong",[t._v("层爆炸")]),t._v("的原理。")]),t._v(" "),a("p",[t._v("值得注意的是，当需要"),a("code",[t._v("repaint")]),t._v("时，只需要"),a("code",[t._v("repaint")]),t._v("本身，而不会影响到其他的层。")])]),t._v(" "),a("ol",{attrs:{start:"13"}},[a("li",[a("strong",[a("code",[t._v("JS")]),t._v("引擎解析过程")]),t._v("：调用"),a("code",[t._v("JS")]),t._v("引擎执行"),a("code",[t._v("JS")]),t._v("代码（"),a("code",[t._v("JS")]),t._v("的解释阶段，预处理阶段，执行阶段生成执行上下文，"),a("code",[t._v("VO")]),t._v("，作用域链、回收机制等等）")])]),t._v(" "),a("ul",[a("li",[t._v("创建"),a("code",[t._v("window")]),t._v("对象："),a("code",[t._v("window")]),t._v("对象也叫全局执行环境，当页面产生时就被创建，所有的全局变量和函数都属于"),a("code",[t._v("window")]),t._v("的属性和方法，而"),a("code",[t._v("DOM Tree")]),t._v("也会映射在"),a("code",[t._v("window")]),t._v("的"),a("code",[t._v("doucment")]),t._v("对象上。当关闭网页或者关闭浏览器时，全局执行环境会被销毁。")]),t._v(" "),a("li",[t._v("加载文件：完成"),a("code",[t._v("js")]),t._v("引擎分析它的语法与词法是否合法，如果合法进入预编译")]),t._v(" "),a("li",[t._v("预编译：在预编译的过程中，浏览器会寻找全局变量声明，把它作为"),a("code",[t._v("window")]),t._v("的属性加入到"),a("code",[t._v("window")]),t._v("对象中，并给变量赋值为"),a("code",[t._v("'undefined'")]),t._v("；寻找全局函数声明，把它作为"),a("code",[t._v("window")]),t._v("的方法加入到"),a("code",[t._v("window")]),t._v("对象中，并将函数体赋值给他（"),a("strong",[t._v("匿名函数是不参与预编译的，因为它是变量")]),t._v("）。而变量提升作为不合理的地方在"),a("code",[t._v("ES6")]),t._v("中已经解决了，函数提升还存在。")]),t._v(" "),a("li",[t._v("解释执行：执行到变量就赋值，如果变量没有被定义，也就没有被预编译直接赋值，在"),a("code",[t._v("ES5")]),t._v("非严格模式下这个变量会成为"),a("code",[t._v("window")]),t._v("的一个属性，也就是成为全局变量。"),a("code",[t._v("string")]),t._v("、"),a("code",[t._v("int")]),t._v("这样的值就是直接把值放在变量的存储空间里，"),a("code",[t._v("object")]),t._v("对象就是把指针指向变量的存储空间。函数执行，就将函数的环境推入一个环境的栈中，执行完成后再弹出，控制权交还给之前的环境。"),a("code",[t._v("JS")]),t._v("作用域其实就是这样的执行流机制实现的。")])]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("补充:显示器显示图像的原理")]),t._v(" "),a("p",[t._v("无论是 "),a("code",[t._v("PC")]),t._v(" 还是手机屏幕，都有一个固定的刷新频率，一般是 "),a("code",[t._v("60 HZ")]),t._v("，即 "),a("code",[t._v("60")]),t._v(" 帧，也就是一秒更新 "),a("code",[t._v("60")]),t._v(" 张图片，一张图片停留的时间约为 "),a("code",[t._v("16.7 ms")]),t._v("。")]),t._v(" "),a("p",[t._v("而每次更新的图片都来自显卡的"),a("strong",[t._v("前缓冲区")]),t._v("。而显卡接收到浏览器进程传来的页面后，会合成相应的图像，并将图像保存到"),a("strong",[t._v("后缓冲区")]),t._v("，然后系统自动将"),a("code",[t._v("前缓冲区")]),t._v("和"),a("code",[t._v("后缓冲区")]),t._v("对换位置，如此循环更新。")]),t._v(" "),a("p",[t._v("这也就是当某个动画大量占用内存的时候，浏览器生成图像的时候会变慢，图像传送给显卡就会不及时，而显示器还是以不变的频率刷新，因此会出现卡顿，也就是明显的掉帧现象")])]),t._v(" "),a("h2",{attrs:{id:"扫码登陆流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扫码登陆流程"}},[t._v("#")]),t._v(" 扫码登陆流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202261059558.png",alt:"image-20220226105933315"}})]),t._v(" "),a("p",[a("strong",[t._v("问：假设扫码途中"),a("code",[t._v("QRCode")]),t._v("刷新了怎么办？")])]),t._v(" "),a("p",[t._v("可以在"),a("code",[t._v("PC")]),t._v("端新增状态，已扫码待确认，来阻止轮询超时重新获取二维码")]),t._v(" "),a("p",[a("strong",[t._v("问："),a("code",[t._v("PC")]),t._v("怎么根据二维码进行响应")])]),t._v(" "),a("p",[a("code",[t._v("PC")]),t._v("端可以通过获取二维码的状态来进行相应的响应：")]),t._v(" "),a("ul",[a("li",[t._v("二维码"),a("code",[t._v("未扫描")]),t._v("：无操作")]),t._v(" "),a("li",[t._v("二维码"),a("code",[t._v("已失效")]),t._v("：提示刷新二维码")]),t._v(" "),a("li",[t._v("二维码"),a("code",[t._v("已成功")]),t._v("：从服务端获取"),a("code",[t._v("PC token")])])]),t._v(" "),a("p",[a("strong",[t._v("问：可以用长轮询嘛 "),a("code",[t._v("ws")]),t._v("呢")])]),t._v(" "),a("p",[t._v("可以。长轮询是指客户端主动给服务端发送二维码状态的查询请求，服务端会按情况对请求进行阻塞，直至二维码信息更新或超时。当客户端接收到返回结果后，若二维码仍未被扫描，则会继续发送查询请求，直至状态变化（已失效或已成功）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202261108821.awebp",alt:"长轮询"}})]),t._v(" "),a("p",[a("code",[t._v("Websocket")]),t._v("是指前端在生成二维码后，会与后端建立连接，一旦后端发现二维码状态变化，可直接通过建立的连接主动推送信息给前端。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202261108891.awebp",alt:"Websocket"}})]),t._v(" "),a("h2",{attrs:{id:"为什么通常在发送数据埋点请求的时候使用的是-1x1-像素的透明-gif-图片"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么通常在发送数据埋点请求的时候使用的是-1x1-像素的透明-gif-图片"}},[t._v("#")]),t._v(" 为什么通常在发送数据埋点请求的时候使用的是 "),a("code",[t._v("1x1")]),t._v(" 像素的透明 "),a("code",[t._v("gif")]),t._v(" 图片"),a("badge",{attrs:{text:"重要",type:"warning"}})],1),t._v(" "),a("ul",[a("li",[t._v("能够完成整个 "),a("code",[t._v("HTTP")]),t._v(" 请求+响应（尽管不需要响应内容）")]),t._v(" "),a("li",[t._v("触发 "),a("code",[t._v("GET")]),t._v(" 请求之后不需要获取和处理数据、服务器也不需要发送数据")]),t._v(" "),a("li",[t._v("跨域友好")]),t._v(" "),a("li",[t._v("执行过程无阻塞")]),t._v(" "),a("li",[t._v("相比 "),a("code",[t._v("XMLHttpRequest")]),t._v(" 对象发送 "),a("code",[t._v("GET")]),t._v(" 请求，性能上更好")]),t._v(" "),a("li",[a("code",[t._v("GIF")]),t._v("的最低合法体积最小（最小的"),a("code",[t._v("BMP")]),t._v("文件需要"),a("code",[t._v("74")]),t._v("个字节，"),a("code",[t._v("PNG")]),t._v("需要"),a("code",[t._v("67")]),t._v("个字节，而合法的"),a("code",[t._v("GIF")]),t._v("，只需要"),a("code",[t._v("43")]),t._v("个字节）")])]),t._v(" "),a("p",[a("strong",[t._v("为什么不能用请求其他文件资源("),a("code",[t._v("js/css/ttf")]),t._v(")的方式进行上报呢")])]),t._v(" "),a("p",[t._v("创建资源节点后只有将对象注入到浏览器"),a("code",[t._v("DOM")]),t._v("树后，浏览器才会实际发送资源请求。而且载入"),a("code",[t._v("js/css")]),t._v("资源还会阻塞页面渲染，影响用户体验。")]),t._v(" "),a("p",[t._v("构造图片打点不仅不用插入"),a("code",[t._v("DOM")]),t._v("，只要在"),a("code",[t._v("js")]),t._v("中"),a("code",[t._v("new")]),t._v("出"),a("code",[t._v("Image")]),t._v("对象就能发起请求，而且还没有阻塞问题，在没有"),a("code",[t._v("js")]),t._v("的浏览器环境中也能通过"),a("code",[t._v("img")]),t._v("标签正常打点。")]),t._v(" "),a("p",[a("strong",[t._v("同样都是图片，上报时选用了"),a("code",[t._v("1x1")]),t._v("的透明"),a("code",[t._v("GIF")]),t._v("，而不是其他的"),a("code",[t._v("PNG/JEPG/BMP")]),t._v("文件")])]),t._v(" "),a("p",[t._v("首先，"),a("code",[t._v("1x1")]),t._v("像素是最小的合法图片。而且，因为是通过图片打点，所以图片最好是透明的，这样一来不会影响页面本身展示效果，二者表示图片透明只要使用一个二进制位标记图片是透明色即可，不用存储色彩空间数据，可以节约体积。因为需要透明色，所以可以直接排除"),a("code",[t._v("JEPG")]),t._v("。")]),t._v(" "),a("p",[t._v("同样的响应，"),a("code",[t._v("GIF")]),t._v("可以比"),a("code",[t._v("BMP")]),t._v("节约"),a("code",[t._v("41%")]),t._v("的流量，比"),a("code",[t._v("PNG")]),t._v("节约"),a("code",[t._v("35%")]),t._v("的流量。"),a("code",[t._v("GIF")]),t._v("才是最佳选择。")]),t._v(" "),a("ul",[a("li",[t._v("可以进行跨域")]),t._v(" "),a("li",[t._v("不会携带"),a("code",[t._v("cookie")])]),t._v(" "),a("li",[t._v("不需要等待服务器返回数据")])]),t._v(" "),a("h2",{attrs:{id:"简单描述一下-babel-的编译过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单描述一下-babel-的编译过程"}},[t._v("#")]),t._v(" 简单描述一下 "),a("code",[t._v("Babel")]),t._v(" 的编译过程"),a("badge",{attrs:{text:"特别重要",type:"error"}})],1),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("概念")]),t._v(" "),a("p",[a("code",[t._v("Babel")]),t._v(" 是一个 "),a("code",[t._v("JavaScript")]),t._v(" 编译器，是一个工具链，主要用于将采用 "),a("code",[t._v("ECMAScript 2015+")]),t._v(" 语法编写的代码转换为向后兼容的 "),a("code",[t._v("JavaScript")]),t._v(" 语法，以便能够运行在当前和旧版本的浏览器或其他环境中。")])]),t._v(" "),a("p",[a("code",[t._v("Babel")]),t._v(" 本质上就是在操作 "),a("code",[t._v("AST")]),t._v(" 来完成代码的转译。"),a("code",[t._v("AST")]),t._v("是抽象语法树（"),a("code",[t._v("Abstract Syntax Tree, AST")]),t._v("）")]),t._v(" "),a("p",[a("code",[t._v("Babel")]),t._v(" 的功能很纯粹，它只是一个编译器。大多数编译器的工作过程可以分为三部分：")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("解析（"),a("code",[t._v("Parse")]),t._v("）")]),t._v(" ：将源代码转换成更加抽象的表示方法（例如抽象语法树）。包括词法分析和语法分析。词法分析主要把字符流源代码（"),a("code",[t._v("Char Stream")]),t._v("）转换成令牌流（ "),a("code",[t._v("Token Stream")]),t._v("），语法分析主要是将令牌流转换成抽象语法树"),a("code",[t._v("（Abstract Syntax Tree，AST）")]),t._v("。")]),t._v(" "),a("li",[a("strong",[t._v("转换（"),a("code",[t._v("Transform")]),t._v("）")]),t._v(" ：通过 "),a("code",[t._v("Babel")]),t._v(" 的插件能力，对（抽象语法树）做一些特殊处理，将高版本语法的 "),a("code",[t._v("AST")]),t._v(" 转换成支持低版本语法的 "),a("code",[t._v("AST")]),t._v("。让它符合编译器的期望，当然在此过程中也可以对 "),a("code",[t._v("AST")]),t._v(" 的 "),a("code",[t._v("Node")]),t._v(" 节点进行优化操作，比如添加、更新以及移除节点等。")]),t._v(" "),a("li",[a("strong",[t._v("生成（"),a("code",[t._v("Generate")]),t._v("）")]),t._v(" ：将 "),a("code",[t._v("AST")]),t._v(" 转换成字符串形式的低版本代码，同时也能创建 "),a("code",[t._v("Source Map")]),t._v(" 映射。")])]),t._v(" "),a("p",[t._v("经过这三个阶段，代码就被 "),a("code",[t._v("Babel")]),t._v(" 转译成功了。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202051701131.awebp",alt:"img"}}),t._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/duochizhacai/generatePic/img/202202051701937.awebp",alt:"img"}})]),t._v(" "),a("h2",{attrs:{id:"列举一下有哪些捕获-监控错误的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列举一下有哪些捕获-监控错误的方式"}},[t._v("#")]),t._v(" 列举一下有哪些捕获/监控错误的方式"),a("badge",{attrs:{text:"特别重要",type:"error"}})],1),t._v(" "),a("p",[a("strong",[a("code",[t._v("try/catch")])])]),t._v(" "),a("blockquote",[a("p",[t._v("能捕获常规运行时错误，语法错误和异步错误不行")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 常规运行时错误，可以捕获 ✅")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("notdefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 语法错误，不能捕获 ❌")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" notdefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异步错误，不能捕获 ❌")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("notdefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("p",[a("strong",[a("code",[t._v("window.onerror")])])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("pure js")]),t._v("错误收集，"),a("code",[t._v("window.onerror")]),t._v("，当 "),a("code",[t._v("JS")]),t._v(" 运行时错误发生时，"),a("code",[t._v("window")]),t._v(" 会触发一个 "),a("code",[t._v("ErrorEvent")]),t._v(" 接口的 "),a("code",[t._v("error")]),t._v(" 事件。")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n* @param {String}  message    错误信息\n* @param {String}  source    出错文件\n* @param {Number}  lineno    行号\n* @param {Number}  colno    列号\n* @param {Object}  error  Error对象\n*/")]),t._v("\n\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("先验证下几个错误是否可以捕获。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 常规运行时错误，可以捕获 ✅")]),t._v("\n\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("notdefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 语法错误，不能捕获 ❌")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" notdefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异步错误，可以捕获 ✅")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("notdefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 资源错误，不能捕获 ❌")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("img src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://yun.tuia.cn/image/kkk.png"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br")])]),a("p",[a("strong",[a("code",[t._v("window.addEventListener")])])]),t._v(" "),a("blockquote",[a("p",[t._v("当一项资源（如图片或脚本）加载失败，加载资源的元素会触发一个 "),a("code",[t._v("Event")]),t._v(" 接口的 "),a("code",[t._v("error")]),t._v(" 事件，这些 "),a("code",[t._v("error")]),t._v(" 事件不会向上冒泡到 "),a("code",[t._v("window")]),t._v("，但能被捕获。而"),a("code",[t._v("window.onerror")]),t._v("不能监测捕获。")])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("// 图片、script、css加载错误，都能被捕获 ✅\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://yun.tuia.cn/image/kkk.png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://yun.tuia.cn/foundnull.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://yun.tuia.cn/foundnull.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  \n// new Image错误，不能捕获 ❌\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://yun.tuia.cn/image/lll.png'")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n// fetch错误，不能捕获 ❌\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://tuia.cn/test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br")])]),a("p",[a("code",[t._v("new Image")]),t._v("运用的比较少，可以单独自己处理自己的错误。")]),t._v(" "),a("p",[t._v("但通用的"),a("code",[t._v("fetch")]),t._v("怎么办呢，"),a("code",[t._v("fetch")]),t._v("返回"),a("code",[t._v("Promise")]),t._v("，但"),a("code",[t._v("Promise")]),t._v("的错误不能被捕获，怎么办呢？")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("Promise")]),t._v("错误")])]),t._v(" "),a("ol",[a("li",[t._v("普通"),a("code",[t._v("Promise")]),t._v("错误")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("try/catch")]),t._v("不能捕获"),a("code",[t._v("Promise")]),t._v("中的错误")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// try/catch 不能处理 JSON.parse 的错误，因为它在 Promise 中")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'in try catch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 需要使用catch方法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'in catch fn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("ol",[a("li",[a("code",[t._v("async")]),t._v("错误")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("try/catch")]),t._v("不能捕获"),a("code",[t._v("async")]),t._v("包裹的错误")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getJSON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'inner error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过try/catch处理")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("makeRequest")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 捕获不到")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getJSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'outer'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// try/catch不到")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'in try catch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 需要await，才能捕获到")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'in try catch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("code",[t._v("import chunk")]),t._v("错误")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("import")]),t._v("其实返回的也是一个"),a("code",[t._v("promise")]),t._v("，因此使用如下两种方式捕获错误")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise catch方法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/* webpackChunkName: "incentive" */')]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'in catch fn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// await 方法，try catch")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" module "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/* webpackChunkName: "incentive" */')]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'in try catch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("以上三种其实归结为"),a("code",[t._v("Promise")]),t._v("类型错误，可以通过"),a("code",[t._v("unhandledrejection")]),t._v("捕获")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 全局统一处理Promise")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unhandledrejection"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'捕获到异常：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://tuia.cn/test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("blockquote",[a("p",[t._v("不过捕捉不到行数，触发时间在被 "),a("code",[t._v("reject")]),t._v(" 但没有 "),a("code",[t._v("reject")]),t._v(" 处理的时候，可能发生在 "),a("code",[t._v("window")]),t._v(" 下，也可能在 "),a("code",[t._v("Worker")]),t._v(" 中")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("Vue")]),t._v("错误")])]),t._v(" "),a("blockquote",[a("p",[t._v("由于"),a("code",[t._v("Vue")]),t._v("会捕获所有"),a("code",[t._v("Vue")]),t._v("单文件组件或者"),a("code",[t._v("Vue.extend")]),t._v("继承的代码，所以在"),a("code",[t._v("Vue")]),t._v("里面出现的错误，并不会直接被"),a("code",[t._v("window.onerror")]),t._v("捕获，而是会抛给"),a("code",[t._v("Vue.config.errorHandler")]),t._v("。")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 全局捕获Vue错误，直接扔出给onerror处理\n */")]),t._v("\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("errorHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" err\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("strong",[a("code",[t._v("React")]),t._v("错误")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("react")]),t._v(" 通过"),a("code",[t._v("componentDidCatch")]),t._v("，声明一个错误边界的组件")])]),t._v(" "),a("div",{staticClass:"language-jsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ErrorBoundary")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hasError"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDerivedStateFromError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新 state 使下一次渲染能够显示降级后的 UI")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hasError"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidCatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" errorInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你同样可以将错误日志上报给服务器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("logErrorToMyService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" errorInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hasError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你可以自定义降级后的 UI 并渲染")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("Something went wrong.")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("App")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   \n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ErrorBoundary")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyWidget")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n    ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ErrorBoundary")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br")])]),a("p",[t._v("但"),a("code",[t._v("error boundaries")]),t._v("并不会捕捉以下错误："),a("code",[t._v("React")]),t._v("事件处理，异步代码，"),a("code",[t._v("error boundaries")]),t._v("自己抛出的错误")]),t._v(" "),a("h2",{attrs:{id:"前端容灾是什么-该怎么解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端容灾是什么-该怎么解决"}},[t._v("#")]),t._v(" 前端容灾是什么 该怎么解决")]),t._v(" "),a("p",[t._v("前端容灾指的因为各种原因后端接口挂了(比如服务器断电断网等等)，前端依然能保证页面信息能完整展示。")]),t._v(" "),a("p",[t._v("比如 "),a("code",[t._v("banner")]),t._v(" 或者列表之类的等等数据是从接口获取的，要是接口获取不到了，怎么办呢？")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("LocalStorage")])])]),t._v(" "),a("p",[t._v("在接口正常返回的时候把数据都存到 "),a("code",[t._v("LocalStorage")]),t._v(" ，可以把接口路径作为 "),a("code",[t._v("key")]),t._v("，返回的数据作为 "),a("code",[t._v("value")])]),t._v(" "),a("p",[t._v("然后之次再请求，只要请求失败，就读取 "),a("code",[t._v("LocalStorage")]),t._v("，把上次的数据拿出来展示，并上报错误信息，以获得缓冲时间")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("CDN")])])]),t._v(" "),a("p",[t._v("同时，每次更新都要备份一份静态数据放到"),a("code",[t._v("CDN")])]),t._v(" "),a("p",[t._v("在接口请求失败的时候，并且 "),a("code",[t._v("LocalStorage")]),t._v(" 也没有数据的情况下，就去 "),a("code",[t._v("CDN")]),t._v(" 摘取备份的静态数据")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("Service Worker")])])]),t._v(" "),a("p",[t._v("假如不只是接口数据，整个 "),a("code",[t._v("html")]),t._v(" 都想存起来，就可以使用 "),a("code",[t._v("Service Worker")]),t._v(" 做离线存储")]),t._v(" "),a("p",[t._v("利用 "),a("code",[t._v("Service Worker")]),t._v(" 的请求拦截，不管是存接口数据，还是存页面静态资源文件都可以")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拦截所有请求事件 缓存中有请求的数据就直接用缓存，否则去请求数据 ")]),t._v("\nself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fetch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找request中被缓存命中的response ")]),t._v("\n    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("respondWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("caches"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fetch source'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("做好这些，整个网站就完全可以离线运行了，但是问题也很明显，就是时效性较高的页面可能会有数据无法同步更新的问题（比如商家库存不足了显示不一致）")]),t._v(" "),a("p",[t._v("另外要注意的是要保证前端页面自身可发布更新，比如页面异常后，此时业务系统要发新版本进行修复和更新，要能确保新版本的资源可以全量替换旧版本的线上资源")]),t._v(" "),a("h2",{attrs:{id:"前端工程化的理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端工程化的理解"}},[t._v("#")]),t._v(" 前端工程化的理解")]),t._v(" "),a("p",[a("strong",[t._v("模块化")])]),t._v(" "),a("p",[t._v("将一个大的文件，拆分成多个相互依赖的小文件，按一个个模块来划分")]),t._v(" "),a("p",[a("strong",[t._v("组件化")])]),t._v(" "),a("p",[t._v("页面上所有的东西都可以看成组件，页面是个大型组件，可以拆成若干个中型组件，然后中型组件还可以再拆，拆成若干个小型组件")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("组件化≠模块化")]),t._v("。模块化只是在文件层面上，对代码和资源的拆分；组件化是在设计层面上，对于"),a("code",[t._v("UI")]),t._v("的拆分")]),t._v(" "),a("li",[t._v("目前市场上的组件化的框架，主要的有"),a("code",[t._v("Vue")]),t._v("，"),a("code",[t._v("React")]),t._v("，"),a("code",[t._v("Angular2")])])]),t._v(" "),a("p",[a("strong",[t._v("规范化")])]),t._v(" "),a("p",[t._v("在项目规划初期制定的好坏对于后期的开发有一定影响。包括的规范有")]),t._v(" "),a("ul",[a("li",[t._v("目录结构的制定")]),t._v(" "),a("li",[t._v("编码规范 "),a("code",[t._v("editorconfig")]),t._v("、"),a("code",[t._v("eslint")]),t._v("配置，"),a("code",[t._v("git husky")]),t._v("在"),a("code",[t._v("git commit")]),t._v(" 后自动通过规范化修复")]),t._v(" "),a("li",[t._v("前后端接口规范")]),t._v(" "),a("li",[t._v("文档规范")]),t._v(" "),a("li",[t._v("组件管理")]),t._v(" "),a("li",[a("code",[t._v("Git")]),t._v("分支管理")]),t._v(" "),a("li",[a("code",[t._v("Commit")]),t._v("描述规范 "),a("code",[t._v("commitizen")]),t._v("使用统一风格的"),a("code",[t._v("commit")]),t._v("语句")]),t._v(" "),a("li",[t._v("定期"),a("code",[t._v("codeReview")])]),t._v(" "),a("li",[t._v("视觉图标规范")])]),t._v(" "),a("p",[a("strong",[t._v("自动化")])]),t._v(" "),a("p",[t._v("也就是简单重复的工作交给机器来做，自动化也就是有很多自动化工具代替我们来完成，例如持续集成、自动化构建、自动化部署、自动化测试等等")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("p",[a("code",[t._v("CI")]),t._v("是什么")]),t._v(" "),a("ul",[a("li",[t._v("持续集成：当代码仓库代码发生变更，就会自动对代码进行测试和构建，反馈运行结果。")])]),t._v(" "),a("p",[a("code",[t._v("CD")]),t._v("是什么")]),t._v(" "),a("ul",[a("li",[t._v("持续交付：持续交付是在持续集成的基础上，可以将集成后的代码依次部署到测试环境、予发布环境、生产环境等中")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);